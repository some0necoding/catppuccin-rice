"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[653],{6820:(e,t,a)=>{a.r(t),a.d(t,{default:()=>G});var r=a(77094),n=a.n(r),i=a(97464),o=a.n(i),s=a(96486),l=a.n(s),d=a(17126),c=a(67294),u=a(480),p=a(81954),y=a(24405),m=a(3779),g=a(24211),v=a(89837),f=a(4615),b=a(81491),k=a(97880),M=a(63143),h=a(5366),w=a(3992),I=a(28020),S=a(60709);const E=[{frequency:"day",interval:1},{frequency:"week",interval:1},{frequency:"month",interval:1},{frequency:"year",interval:1}];var F=a(3815),C=a(52275),P=a(31945),Z=a(96525),q=a(88359),L=a(74194),R=a(3386),x=a(78140),D=a(28992),T=a(9342),B=a(89728),_=a(72495),A=a(54368),O=a(64369),X=a(93289),K=a(16953),U=a(58032);function W(e){window.__c={n:"TimeInput"};const t=(0,u.O7)(),{device:a}=t,r=(0,h.useIntl)(),[i,o]=(0,c.useState)(e.value),[s,l]=(0,c.useState)(void 0),p=t=>{const a=(0,K.parseTime)(t,r),n=d.ou.fromFormat(a??"","T");return n.isValid?(l(void 0),e.onUpdate({hour:n.hour,minute:n.minute})):(l("invalid"),e.onError&&e.onError()),n},m=e=>{const t=e.target.value;o(t),p(t)},g=()=>{const e=p(i);e.isValid&&o(e.toLocaleString(d.ou.TIME_SIMPLE))},v=(0,y.yK)((e=>({input:{textAlign:"right"},error:{boxShadow:e.outlineRedInputBoxShadow}})),[]);return n()(U.Z,{renderTooltip:()=>function(e){if("invalid"===e)return n()(h.FormattedMessage,{defaultMessage:"Invalid time",id:"timeInput.invalid",description:"User has entered an invalid time."})}(s),forceVisibleState:void 0!==s,placement:U.Z.Placement.Bottom,render:()=>n()(L.Z,{type:"text",onChange:m,onSubmit:g,onBlur:g,value:i,size:1,style:{...e.style,...s?v.error:{},fontSize:a.isMobile?16:14},inputStyle:v.input})})}var z=a(29572),V=a(49509),H=a(61784),j=a(64921);function N(e){window.__c={n:"WeekdaySelector"};const{weekdays:t,onChange:a}=e,r=e.minimumSelection??0,i=(0,h.useIntl)(),s=(0,y.yK)((e=>({wrapper:{display:"flex",alignItems:"center",justifyContent:"space-between",textAlign:"center"},selectedDay:{...Y,background:e.blueButtonBackground,color:e.regularInvertedTextColor},unselectedDay:{...Y,background:e.accentColors.gray[50],color:e.mediumTextColor},selectedDayHover:{background:e.blueButtonHoveredBackground},unselectedDayHover:{background:e.accentColors.gray[100]},selectedDayPressed:{background:e.blueButtonPressedBackground},unselectedDayPressed:{background:e.accentColors.gray[200]}})),[]);return n()(R.Z,{capture:!0},void 0,n()("div",{style:{...s.wrapper,...e.style}},void 0,V.Z.map(((n,l)=>c.createElement(j.Z,o()({key:n},e,{onClick:()=>{const e=t.includes(n)?t.length>r?t.filter((e=>e!==n)):t:[...t,n];a(e)},style:t.includes(n)?s.selectedDay:s.unselectedDay,hoveredStyle:t.includes(n)?s.selectedDayHover:s.unselectedDayHover,pressedStyle:t.includes(n)?s.selectedDayPressed:s.unselectedDayPressed}),(0,H.er)(i,l+1))))))}const Y={borderRadius:"50%",marginLeft:3,marginRight:3,height:25,width:25,fontSize:14,paddingTop:2};const G=(0,c.forwardRef)((function(e,t){const a=(0,u.O7)(),{device:r}=a,i=(0,y.Fg)(),s=(0,h.useIntl)(),[K,U]=(0,c.useState)(void 0),[V,H]=(0,c.useState)({id:(0,f.ZP)(),start_date:d.ou.local().set({hour:0,minute:0,second:0,millisecond:0}).toMillis(),timezone:(0,v.Sv)(),hour:0,minute:0,frequency:"day",interval:1}),[j,Y]=(0,c.useState)(!0),G=e.templateStore,ne=(0,p.VK)((()=>F.Mz.fromBlockStore(G)),[G]),ie=(0,p.VK)((()=>void 0===G.getAutomationId()||(null==ne?void 0:ne.isReady())),[G,ne]),oe=(0,p.VK)((()=>(null==ne?void 0:ne.isActive())??!1),[ne]),se=(0,p.VK)((()=>null==ne?void 0:ne.getRecurrence()),[ne]);void 0===K&&ie&&(void 0!==se?(H({...se,hour:se.hour??0,minute:se.minute??0,start_date:(0,b.convertDateFromUtcRepresentation)(se.start_date)}),U(!0)):U(!1));const le=e=>{const t="week"!==e||void 0!==V.weekdays&&0!==V.weekdays.length?V.weekdays:[(a=V.start_date,(0,k.Yd)(b.RRULE_WEEKDAYS_MAP)[d.ou.fromMillis(a).weekday-1])];var a;H({...V,weekdays:t,frequency:e}),U(!0)},de=()=>{w.addRecurrence({environment:a,blockStore:e.templateStore,recurrence:V})},ce=r.isMobile?P.Z.PopupType.SlideUp:P.Z.PopupType.Popup,ue=function(){const{isMobile:e}=(0,u.Fy)();return(0,y.yK)((t=>({iconStyle:{fill:t.regularIconColor,width:e?18:16},customFrequencySelectButton:{color:t.mediumTextColor,fill:t.lightIconColor,fontWeight:500,fontSize:12},weekdayWrapper:{padding:10},inputLabel:{display:"flex",alignItems:"center",...e?{padding:"10px 14px",fontSize:16,background:t.cardBackground}:{paddingLeft:8}},intervalFrequencyLabel:{color:t.lightTextColor},intervalInputWrapper:{width:70,marginLeft:10,marginRight:10},intervalInput:{textAlign:"right"},timeInputWrapper:{width:90,marginLeft:10,marginRight:10},inputSection:{...J,alignItems:"center",justifyContent:"flex-start",padding:8},chevron:{width:e?14:10,fill:t.lightIconColor,marginLeft:4}})),[e])}(),pe=r.isMobile?"number":"text",ye=E.map((e=>({key:e.frequency,action:()=>{le(e.frequency)},render:t=>c.createElement(C.Z,o()({},t,{title:$(e.frequency)}))}))),me=n()(R.Z,{capture:!0,onLeft:l().identity,onRight:l().identity,onSelectAll:l().identity,onRedo:l().identity,onUndo:l().identity,onCut:l().identity,onCopy:l().identity,onPaste:l().identity,onKeypress:l().identity,onDelete:l().identity,onBackspace:l().identity,onTab:l().identity},void 0,n()(L.Z,{value:V.interval.toString(),style:ue.intervalInputWrapper,inputStyle:ue.intervalInput,type:pe,maxlength:3,onChange:e=>{const t=parseInt(e.target.value);(0,M.hj)(t)&&t>0&&t<=b.MAX_RECURRENCE_INTERVAL&&H({...V,interval:t})},onBlur:e=>{e.target.value=V.interval.toString()}}));return c.createElement(Z.Z,o()({},e,{popupType:ce,ref:t,stopClickPropagation:!0,renderOrigin:t=>c.createElement(q.Z,o()({},t,{icon:m.Z.repeat(ue.iconStyle),title:n()(h.FormattedMessage,{defaultMessage:"Repeat",id:"database.templatePickerItem.actionMenu.repeat"}),focused:e.focused,showExtensionArrow:r.isMobile,right:ie&&re({isActive:oe,recurrence:se,intl:s})})),render:t=>n()(R.Z,{capture:!0,onEnter:l().identity},void 0,c.createElement(x.Z,function(e,t,a,r){return t?{menuType:S.og.Modal,title:n()(h.FormattedMessage,{defaultMessage:"Repeat",id:"database.templatePickerItem.mobileRepeatModal.title"}),left:n()(h.FormattedMessage,{defaultMessage:"Cancel",id:"database.templatePickerItem.customRecurrence.cancel",description:"Close repeat menu without saving"}),right:Q,rightDisabled:!a,onClickRight:()=>{a&&(r(),e.close())},onClickLeft:()=>{e.close()}}:{menuType:S.og.Popup}}(t,r.isMobile,j,de),K?c.createElement(c.Fragment,null,n()(_.Z,{style:J},void 0,n()(A.Z,{innerButtonStyle:{...!r.isMobile&&ue.customFrequencySelectButton},selectedTitle:ee(V.frequency),renderMenuSections:r=>[{key:"repeatOptionsSection",render:e=>c.createElement(_.Z,e),items:[...te({parent:r,updateFrequencyFn:e=>{le(e)}}),ae({environment:a,parent:r,templateStore:e.templateStore,onClose:()=>{U(!1),t.close()}})]}]}),!r.isMobile&&n()(B.Z,{isBlue:j,isLightGray:!j,onClick:e=>{de(),t.close()},disabled:!j},void 0,Q)),n()(_.Z,{style:ue.inputSection,shouldShowBottomDivider:!0},void 0,n()(O.Z,{style:ue.inputLabel},void 0,function(e,t,a){switch(t){case"day":return n()(h.FormattedMessage,{defaultMessage:"Every {interval} <label>days</label>",id:"database.templatePickerItem.recurrenceInterval.everyXdays",description:"Configure to repeat every X days.",values:{label:e=>n()("label",{style:a},void 0,e),interval:e}});case"week":return n()(h.FormattedMessage,{defaultMessage:"Every {interval} <label>weeks</label>",id:"database.templatePickerItem.recurrenceInterval.everyXweeks",description:"Configure to repeat every X weeks.",values:{label:e=>n()("label",{style:a},void 0,e),interval:e}});case"month":return n()(h.FormattedMessage,{defaultMessage:"Every {interval} <label>months</label>",id:"database.templatePickerItem.recurrenceInterval.everyXmonths",description:"Configure to repeat every X months.",values:{label:e=>n()("label",{style:a},void 0,e),interval:e}});case"year":return n()(h.FormattedMessage,{defaultMessage:"Every {interval} <label>years</label>",id:"database.templatePickerItem.recurrenceInterval.everyXyears",description:"Configure to repeat every X years.",values:{label:e=>n()("label",{style:a},void 0,e),interval:e}});default:(0,k.t1)(t)}}(me,V.frequency,ue.intervalFrequencyLabel))),"week"===V.frequency&&n()(_.Z,{},void 0,n()(N,{style:ue.weekdayWrapper,focused:!0,weekdays:V.weekdays||[],minimumSelection:1,onChange:e=>{H({...V,weekdays:e})}})),n()(_.Z,{topBorder:!0},void 0,n()(P.Z,{popupType:ce,renderOrigin:e=>c.createElement(q.Z,o()({},e,{title:n()(h.FormattedMessage,{defaultMessage:"Starts",id:"database.templatePickerItem.repeatMenu.starts",description:"Day to start the repeat at the earliest"}),focused:!1,showExtensionArrow:r.isMobile,right:d.ou.fromMillis(V.start_date).setLocale((0,g.E2)(s)).toLocaleString({weekday:"short",month:"short",day:"numeric",year:"numeric"})})),render:e=>n()("div",{style:{padding:"18px 14px 14px"}},void 0,n()(X.Z,{firstDayOfWeek:I.AK.state,value:Math.max(V.start_date,Date.now()),onChange:t=>{H({...V,start_date:t}),e.close()},disabledDays:{before:new Date}}))})),n()(_.Z,{style:ue.inputSection,shouldShowBottomDivider:!0},void 0,n()(O.Z,{style:ue.inputLabel},void 0,n()(h.FormattedMessage,{defaultMessage:"Create at",id:"database.templatePickerItem.repeatMenu.createAt",description:"Label for the time input of when a repeating event will happen."}),n()(R.Z,{capture:!0,onLeft:l().identity,onRight:l().identity,onSelectAll:l().identity,onRedo:l().identity,onUndo:l().identity,onCut:l().identity,onCopy:l().identity,onPaste:l().identity,onKeypress:l().identity,onDelete:l().identity,onBackspace:l().identity,onTab:l().identity},void 0,n()(W,{value:d.ou.local().set({hour:V.hour,minute:V.minute}).toLocaleString(d.ou.TIME_SIMPLE),style:ue.timeInputWrapper,onUpdate:e=>{H({...V,...e}),Y(!0)},onError:()=>{Y(!1)}})),n()(z.Z,{renderOrigin:e=>c.createElement(B.Z,e,(0,v.er)(V.timezone),m.Z.chevronDown(ue.chevron)),onSelect:e=>{H({...V,timezone:e})}})))):n()(T.Z,{type:T.i.Vertical,sections:[{key:"repeatOptionsSection",render:e=>c.createElement(_.Z,e),items:[...ye,ae({environment:a,parent:t,templateStore:e.templateStore})]}],initialFocus:void 0}),K&&function(e,t,a){window.__c={n:"renderNextRecurrenceLabel"};const r=(0,b.rruleFromRecurrence)(t).after(new Date((0,b.convertDateToUtcRepresentation)())),i=d.ou.fromJSDate(r).toUTC().setLocale((0,g.E2)(e)).toLocaleString(d.ou.DATETIME_SHORT);return n()(_.Z,{topBorder:!0},void 0,n()(D.Z,{caption:n()("span",{style:{color:a.lightTextColor}},void 0,n()(h.FormattedMessage,{defaultMessage:"Next: {dates}",id:"database.templatePickerItem.recurrenceConfigMenuLabel.next",description:"When repeat will happen next.",values:{dates:i}}))}))}(s,V,i)))}))})),J={display:"flex",alignItems:"center",justifyContent:"space-between",padding:"4px"};const Q=n()(h.FormattedMessage,{defaultMessage:"Save",id:"database.templatePickerItem.customRecurrence.save",description:"Save the custom repeat settings"});function $(e){switch(e){case"day":return n()(h.FormattedMessage,{defaultMessage:"Every day",id:"database.templatePickerItem.quickOptionMenuItem.day"});case"week":return n()(h.FormattedMessage,{defaultMessage:"Every week",id:"database.templatePickerItem.quickOptionMenuItem.week"});case"month":return n()(h.FormattedMessage,{defaultMessage:"Every month",id:"database.templatePickerItem.quickOptionMenuItem.month"});case"year":return n()(h.FormattedMessage,{defaultMessage:"Every year",id:"database.templatePickerItem.quickOptionMenuItem.year"});default:(0,k.t1)(e)}}function ee(e){switch(e){case"day":return n()(h.FormattedMessage,{defaultMessage:"Repeat daily",id:"database.templatePickerItem.recurrenceFrequency.daily",description:"Configure to repeat by day."});case"week":return n()(h.FormattedMessage,{defaultMessage:"Repeat weekly",id:"database.templatePickerItem.recurrenceFrequency.weekly",description:"Configure to repeat by week."});case"month":return n()(h.FormattedMessage,{defaultMessage:"Repeat monthly",id:"database.templatePickerItem.recurrenceFrequency.monthly",description:"Configure to repeat by month."});case"year":return n()(h.FormattedMessage,{defaultMessage:"Repeat yearly",id:"database.templatePickerItem.recurrenceFrequency.yearly",description:"Configure to repeat by year."});default:(0,k.t1)(e)}}function te(e){let{parent:t,updateFrequencyFn:a}=e;return E.map((e=>({key:e.frequency,action:()=>{a(e.frequency),t.close()},render:t=>c.createElement(C.Z,o()({},t,{title:ee(e.frequency)}))})))}function ae(e){let{environment:t,parent:a,templateStore:r,onClose:i}=e;return{key:"disable",action:()=>{w.disableRecurrence({environment:t,blockStore:r}),a.close(),i&&i()},render:e=>c.createElement(C.Z,o()({},e,{title:n()(h.FormattedMessage,{defaultMessage:"Off",id:"database.templatePickerItem.quickOptionMenuItem.off",description:"Turn off automatically repeating a task."})}))}}function re(e){let{isActive:t,recurrence:a,intl:r}=e;return t?a?c.createElement(c.Fragment,null,function(e,t){return(0,b.rruleFromRecurrence)({...e,weekdays:void 0,hour:0,minute:0}).toText((e=>{switch(e){case"every":return t.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.every",defaultMessage:"every",description:"Interval to repeat, e.g. Every X days/weeks/months/years"});case"day":return t.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.day",defaultMessage:"day",description:"Frequency to repeat, e.g. Every day"});case"days":return t.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.days",defaultMessage:"days",description:"Frequency to repeat plural, e.g. Every X days"});case"week":return t.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.week",defaultMessage:"week",description:"Frequency to repeat, e.g. Every week"});case"weeks":return t.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.weeks",defaultMessage:"weeks",description:"Frequency to repeat, e.g. Every X weeks"});case"month":return t.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.month",defaultMessage:"month",description:"Frequency to repeat, e.g. Every month"});case"months":return t.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.months",defaultMessage:"months",description:"Frequency to repeat, e.g. Every X months"});case"year":return t.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.year",defaultMessage:"year",description:"Frequency to repeat, e.g. Every year"});case"years":return t.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.years",defaultMessage:"years",description:"Frequency to repeat, e.g. Every X years"});default:return e.toString()}}))}(a,r)):void 0:n()(h.FormattedMessage,{defaultMessage:"Off",id:"database.templatePickerItem.recurrenceConfigMenuLabel.off",description:"Indicate there is no repeat configured."})}}}]);