"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[7983],{80567:(e,t,a)=>{a.d(t,{a:()=>n});var r=a(19234),i=a(54642);async function n(e,t){const a=(0,r.gq)(t);if("skip"===a)return{valid:!0};if("insufficient_data"===a)return{valid:!1};const n=await i.resolveAddress(e,{address:{line1:t.addressLine1,city:t.city,zip:t.zipCode,state:t.state,country:t.country}});return"failed"===n.type?{valid:!1}:n.data}},65544:(e,t,a)=>{a.d(t,{W:()=>p,n:()=>c});var r=a(19234),i=a(62216),n=a(21115),o=a(27242),s=a(78291),d=a(8711),l=a(54642);async function p(e){const t=o.Z.state,a=s.default.state.data;if(!t.open||!a)return;if(t.vatApplicable&&t.temporaryVatCode&&!i.Ww())return void o.Z.update((e=>({...e,taxAmount:void 0,calculatingTax:!1})));const d=t.temporaryAddress;if("insufficient_data"===(0,r.gq)(d))return;let p;if(o.Z.update((e=>({...e,calculatingTax:!0}))),t.type===o.U.TargetSpace)p=t.totalUpgradeCost||0;else{const{planAmount:e,promoInfo:r,creditAmount:i,accountBalance:o}=(0,n.uN)({state:t,promo:t.appliedPromo,data:a});p=Math.max(0,e-r.amount-i+o)}const c=await l.calculateTax(e,{address:d,price:p,vatId:t.vatApplicable?t.temporaryVatCode:void 0});if("failed"===c.type)o.Z.update((e=>({...e,taxAmount:void 0,calculatingTax:!1})));else{const e=c.data;e.valid?o.Z.update((t=>({...t,taxAmount:e.taxAmount,calculatingTax:!1}))):o.Z.update((e=>({...e,taxAmount:void 0,calculatingTax:!1})))}}async function c(e){const{environment:t,priceForTaxCalculation:a,address:r}=e,i=d.Z.state,n=await l.calculateTax(t,{address:r,price:a,vatId:void 0});if("failed"===n.type);else{const e=n.data;e.valid&&i.open&&d.Z.update((t=>({...t,tax:Math.max(0,e.taxAmount)})))}}},93039:(e,t,a)=>{a.d(t,{J:()=>x});var r=a(97464),i=a.n(r),n=a(77094),o=a.n(n),s=a(67294),d=a(480),l=a(24405),p=a(31942),c=a(59054),u=a(97880),m=a(5366),g=a(50906),y=a(54642),h=a(80366),f=a(60709),b=a(27242),v=a(52275),S=a(74194),M=a(78140),C=a(9342),w=a(44532),T=a(72495);function x(e){window.__c={n:"SpaceSubscriptionAddressForm"};const t=(0,l.yK)((e=>({container:(0,h.s)(e),cityZipRow:{display:"flex"},verticalDivider:{display:"flex",borderLeft:"1px solid",borderLeftColor:e.groupedFormBorder},zipRow:{display:"flex",flex:2},stateRow:{display:"flex",flex:3}})),[]),a=(0,m.useIntl)(),r=(0,d.O7)();return o()("div",{},void 0,o()("div",{style:t.container},void 0,o()(Z,{placeholder:a.formatMessage({id:"spaceSubscriptionPaymentForm.billingInformation.fullName",defaultMessage:"Full name"}),address:e.address,updateAddress:e.updateAddress,addressKey:"name",environment:r}),e.shouldShowBusinessName&&o()(Z,{placeholder:a.formatMessage({id:"spaceSubscriptionPaymentForm.billingInformation.businessName",defaultMessage:"Business name (optional)"}),address:e.address,updateAddress:e.updateAddress,addressKey:"businessName",environment:r}),o()(U,{updateAddress:e.updateAddress,address:e.address}),e.address&&s.createElement(s.Fragment,null,o()(Z,{placeholder:a.formatMessage({id:"spaceSubscriptionPaymentForm.billingInformation.address",defaultMessage:"Address"}),address:e.address,addressKey:"addressLine1",updateAddress:e.updateAddress,environment:r}),o()(Z,{placeholder:a.formatMessage({id:"spaceSubscriptionPaymentForm.billingInformation.city",defaultMessage:"City"}),addressKey:"city",address:e.address,updateAddress:e.updateAddress,environment:r}),o()("div",{style:t.cityZipRow},void 0,o()("div",{style:t.stateRow},void 0,o()(Z,{placeholder:a.formatMessage({id:"spaceSubscriptionPaymentForm.billingInformation.state",defaultMessage:"State / Province"}),address:e.address,addressKey:"state",updateAddress:e.updateAddress,environment:r})),o()("div",{style:t.verticalDivider}),o()("div",{style:t.zipRow},void 0,o()(Z,{placeholder:a.formatMessage({id:"spaceSubscriptionPaymentForm.billingInformation.zipCode",defaultMessage:"Zip code"}),address:e.address,addressKey:"zipCode",updateAddress:e.updateAddress,environment:r}))))))}function U(e){window.__c={n:"CountryDropdown"};const t=(0,d.O7)(),[a,r]=(0,s.useState)(!1),n=(0,m.useIntl)(),x=(0,l.yK)((()=>({input:{background:"none",boxShadow:"none",padding:8,fontSize:14}})),[]),[U,Z]=s.useState(""),[F]=(0,c.r5)((async()=>{const e=await y.getAvailableCountries(t,{});return"success"===e.type?e.data.countries:"failed"===e.type?[]:void(0,u.t1)(e)}),[t]),A=F.value;if(!A)return null;const P=(0,p.ZP)(U,A,(e=>e.name)).map(((a,n)=>({key:n,render:e=>s.createElement(v.Z,i()({},e,{title:a.name})),action:()=>{a.countryCode!==e.address.country&&e.updateAddress({addressLine1:"",addressLine2:"",zipCode:"",city:"",state:"",country:a.countryCode});const i=b.Z.state;i.open&&b.Z.setState({...i,vatApplicable:Boolean(a.vatApplicable)}),Z(a.name),r(!1),g.trackSubscriptionUpgradeModalAddressFormUpdated(t,{addressType:"country",addressUpdate:a.name})}})));return o()(h.c,{},void 0,o()(w.ZP,{popupType:w.ZP.PopupType.Popup,alignmentToOrigin:w.ZP.Alignment.End,placementToOrigin:w.ZP.Placement.Right,originGap:0,open:a,origin:o()(S.Z,{value:U,focus:a,placeholder:n.formatMessage({id:"spaceSubscriptionPaymentForm.billingInformation.country",defaultMessage:"Country or region"}),style:x.input,onChange:t=>{Z(t.target.value),e.updateAddress({country:void 0})},onFocus:()=>{r(!0)}}),onDismiss:()=>{r(!1)},render:()=>o()(M.Z,{menuType:f.og.Popup,width:"100%"},void 0,o()(C.Z,{type:C.i.Vertical,initialFocus:U.length>0?0:void 0,sections:[{key:0,showNoResultMessage:!0,render:e=>s.createElement(T.Z,i()({},e,{title:o()(m.FormattedMessage,{id:"spaceSubscriptionBillingInfoForm.countryDropdown.title",defaultMessage:"Select a country or region"})})),items:P}]}))}))}function Z(e){window.__c={n:"InputField"};const t=(0,l.yK)((()=>({input:{background:"none",boxShadow:"none",padding:8,fontSize:14}})),[]);return o()(h.c,{},void 0,o()(S.Z,{value:e.address[e.addressKey],style:t.input,placeholder:e.placeholder,onBlur:(a=e.updateAddress,r=e.addressKey,i=e.environment,e=>{g.trackSubscriptionUpgradeModalAddressFormUpdated(i,{addressType:r,addressUpdate:e.target.value}),a({[r]:e.target.value})}),onChange:t=>e.updateAddress({[e.addressKey]:t.target.value})}));var a,r,i}},10644:(e,t,a)=>{a.d(t,{Z:()=>p});var r=a(77094),i=a.n(r),n=(a(67294),a(83355)),o=a(5366),s=a(64369),d=a(27386);class l extends n.Z{renderComponent(){return i()(d.Z,{},void 0,i()(s.Z,{isSmall:!0,style:{textAlign:"center"}},void 0,i()(o.FormattedMessage,{id:"spaceSubscriptionPlans.offlineMessage",defaultMessage:"Please go online to manage your plan."})))}}l.displayName="SpaceSubscriptionPlansOfflineMessage";const p=l},7449:(e,t,a)=>{a.r(t),a.d(t,{default:()=>je});var r=a(97464),i=a.n(r),n=a(77094),o=a.n(n),s=a(86664),d=a(67294),l=a(83355),p=a(41892),c=a(8848),u=a(88108),m=a(65917),g=a(3779),y=a(90850),h=a(3791),f=a(47425),b=a(97880),v=a(82990),S=a(5366),M=a(80567),C=a(50906),w=a(54642),T=a(47307),x=a(92625),U=a(64964),Z=a(21325),F=a(65544),A=a(95477),P=a(60709),k=a(33665),I=a(38755),B=a(16100),O=a(62216),_=a(21115),z=a(34859),E=a(79315),N=a(88632),L=a(10161),W=a(73796),D=a(45407),R=a(92083),H=a(27242),K=a(42922),V=a(52275),Y=a(31945),q=a(36488),G=a(78140),j=a(9342),$=a(22346),Q=a(63296),J=a(18647),X=a(72495),ee=a(64369),te=a(42402),ae=a(46978),re=a(96486),ie=a(480),ne=a(81954),oe=a(24405),se=a(80366),de=a(8323),le=a(74194),pe=a(58032),ce=a(93039);function ue(e){window.__c={n:"SpaceSubscriptionBillingInfoForm"};const t=(0,ie.O7)(),[a]=(0,d.useState)((()=>(0,re.debounce)((async()=>{await F.W(t)}),3e3))),r=(0,ne.VK)((()=>(0,de.mq)()),[]),[i]=(0,ne.AF)(H.Z);if(!i.open)return null;const n=i.temporaryAddress,s=i.type===H.U.TargetSpace;return o()("div",{},void 0,o()(me,{storeState:e.storeState,paymentMethods:e.paymentMethods}),o()("div",{style:{marginTop:20}},void 0,o()(ce.J,{address:n,updateAddress:async e=>{H.Z.setAddressField(e),await a()},shouldShowBusinessName:r})),!i.vatApplicable&&o()("div",{style:{marginBottom:20}}),o()(ge,{onUpdate:async()=>{await a()},disabled:s,tooltip:s?o()(S.FormattedMessage,{id:"spaceSubscriptionPaymentForm.billingInformation.disabledVatTooltip",defaultMessage:"You can add a VAT/GST number in the billing tab after upgrading.",description:"Tooltip explaining that VAT input is disabled in the claim and upgrade flow, indicating that it can be added after the claim has completed."}):void 0}))}function me(e){window.__c={n:"CardElementInput"};const t=(0,oe.yK)((t=>({container:{...ye(t),padding:"5px 5px 5px 10px"},header:{...he(t),paddingTop:20},wrapper:{..."credit_card"!==e.storeState.temporaryPaymentMethod?{display:"none"}:void 0}})),[e.storeState.temporaryPaymentMethod]),a=(0,oe.Fg)(),[r]=(0,ne.AF)(H.Z);if(!r.open)return null;const i=1===e.paymentMethods.length&&"credit_card"===e.paymentMethods[0];return o()("div",{style:t.wrapper},void 0,o()("label",{style:t.header},void 0,o()(S.FormattedMessage,{id:"spaceSubscriptionPaymentForm.paymentInformation.header",defaultMessage:"Payment details"}),i?o()("div",{style:{display:"flex",gap:5}},void 0,o()("div",{},void 0,g.Z.visa({width:23})),o()("div",{},void 0,g.Z.mastercard({width:23})),o()("div",{},void 0,g.Z.amex({width:23})),o()("div",{},void 0,g.Z.dinersclub({width:23}))):null),o()("div",{style:t.container},void 0,o()(s.CardElement,{options:{disabled:"disabled"===r.payButtonState,style:{base:{iconColor:a.blueColor,color:a.regularTextColor,fontFamily:v.Z.baseFontFamily.sans,fontSmoothing:"antialiased",fontSize:"14px","::placeholder":{color:a.lightTextColor},lineHeight:"2em"},complete:{iconColor:a.blueColor},invalid:{color:c.ZP.red,iconColor:c.ZP.red}},hidePostalCode:!0}})))}function ge(e){window.__c={n:"VATCodeInput"};const t=(0,oe.yK)((e=>({container:{...ye(e),borderBottom:"none"},header:{...he(e),paddingTop:20},input:{background:"none",boxShadow:"none",padding:8},subtitle:{color:e.mediumTextColor,fontSize:v.Z.fontSize.UISmall.desktop,marginTop:5,marginBottom:10}})),[]),a=(0,S.useIntl)(),[r,n]=(0,ne.AF)(H.Z);return r.open&&r.vatApplicable?o()("div",{},void 0,o()("label",{style:t.header},void 0,o()(S.FormattedMessage,{id:"spaceSubscriptionPaymentForm.vatCountryCode.header",defaultMessage:"VAT (optional)"})),o()(pe.Z,{placement:pe.Z.Placement.Top,alignment:pe.Z.Alignment.End,render:s=>d.createElement("div",i()({},s,{style:t.container}),o()(se.c,{},void 0,o()(le.Z,{value:r.temporaryVatCode,style:t.input,disabled:e.disabled,placeholder:a.formatMessage({id:"spaceSubscriptionPaymentForm.vatCountryCode.placeholder",defaultMessage:"VAT/GST number"}),onChange:t=>{n({...r,temporaryVatCode:t.target.value}),e.onUpdate(t.target.value)}}))),disableTooltip:!e.tooltip,renderTooltip:()=>e.tooltip}),o()("div",{style:t.subtitle},void 0,o()(S.FormattedMessage,{id:"spaceSubscriptionBilling.vatCountryCode.subtitle",defaultMessage:"Please include your country code"}))):null}function ye(e){return{backgroundColor:e.cardContentBackground,borderWidth:1,borderStyle:"solid",borderColor:e.groupedFormBorder,borderRadius:3}}function he(e){return{display:"flex",alignItems:"center",marginBottom:6,fontSize:12,fontWeight:v.Z.fontWeight.semibold,color:e.mediumTextColor,justifyContent:"space-between"}}var fe=a(78291),be=a(64921);function ve(e){window.__c={n:"SegmentedItemView"};const{isFirst:t,isLast:a,isSelected:r,item:i,children:n,colors:s,onClick:d}=e,l=(0,oe.yK)((e=>{const i=(null==s?void 0:s.selectedOutline)??e.blueColor,n=(null==s?void 0:s.unselectedOutline)??e.accentColors.gray[100];return{SegmentedItem:{alignItems:"center",background:r?null==s?void 0:s.selectedBackground:void 0,borderBottomLeftRadius:t?3:0,borderBottomRightRadius:a?3:0,borderColor:r?i:n,borderStyle:"solid",borderTopLeftRadius:t?3:0,borderTopRightRadius:a?3:0,borderWidth:1,cursor:"pointer",display:"flex",flexBasis:"50%",marginLeft:t?0:-1,padding:0,userSelect:"none",zIndex:r?10:0},Inner:{borderBottomLeftRadius:t?2:0,borderBottomRightRadius:a?2:0,borderColor:r?i:"transparent",borderStyle:"solid",borderTopLeftRadius:t?2:0,borderTopRightRadius:a?2:0,borderWidth:1,display:"flex",flexDirection:"column",height:"100%",justifyContent:"center",padding:"16px 20px",textAlign:"center",width:"100%"}}}),[null==s?void 0:s.selectedBackground,null==s?void 0:s.selectedOutline,null==s?void 0:s.unselectedOutline,t,a,r]);return o()(be.Z,{ariaLabel:i.ariaLabel,ariaPressed:r,onClick:()=>{d&&d(i.key)},style:l.SegmentedItem},void 0,o()("div",{style:l.Inner},void 0,n))}function Se(e){window.__c={n:"SegmentedButton"};const{items:t=[],value:a,onChange:r,colors:i}=e,n=(0,oe.yK)((e=>({SegmentedButton:{background:e.cardContentBackground,display:"flex",width:"100%"}})),[]);return 0===t.length?null:o()("div",{style:n.SegmentedButton},void 0,t.map(((e,n)=>o()(ve,{isFirst:0===n,isLast:n===t.length-1,isSelected:e.key===a,item:e,colors:i,onClick:r},e.key,e.render()))))}function Me(){return(0,oe.yK)((e=>({discountText:{color:e.invoiceGreen,fontSize:12},icon:{width:16,height:16},mainTextSelected:{fontWeight:v.Z.fontWeight.medium,color:e.regularTextColor,fontSize:14},mainTextUnselected:{color:e.mediumTextColor,fontSize:14},priceText:{fontSize:12,color:e.mediumTextColor,marginTop:2},row:{display:"flex",alignItems:"center",justifyContent:"center",gap:4,lineHeight:"14px"},section:{marginBottom:20},sectionHeader:{display:"flex",alignItems:"center",marginBottom:11,fontSize:11,fontWeight:v.Z.fontWeight.semibold,color:e.mediumTextColor}})),[])}function Ce(e){window.__c={n:"Section"};const{header:t,children:a}=e,r=Me();return o()("div",{style:r.section},void 0,o()("div",{style:r.sectionHeader},void 0,t),a)}function we(e){const{isSelected:t,billingInterval:a,subscriptionTier:r,intl:i}=e,n=Me(),s=t?n.mainTextSelected:n.mainTextUnselected;let l;switch(a){case"month":l=o()(S.FormattedMessage,{id:"spaceSubscriptionSettings.orderOptions.billingPeriodSection.monthly",description:"Users can select this option to be billed once a month",defaultMessage:"Monthly"});break;case"year":l=o()(S.FormattedMessage,{id:"spaceSubscriptionSettings.orderOptions.billingPeriodSection.yearly",description:"Users can select this option to be billed once a year",defaultMessage:"Yearly"});break;default:throw new Error(`Unsupported billing interval: ${a}`)}return d.createElement(d.Fragment,null,o()("div",{style:n.row},void 0,o()("div",{style:s},void 0,l),"year"===a?o()("div",{style:n.discountText},void 0,o()(S.FormattedMessage,{id:"spaceSubscriptionSettings.orderOptions.billingPeriodSection.yearlyDiscount",description:"Shows the amount users will save if they select the yearly billing option. The amount is a percentage like 20%",defaultMessage:"{percent}% off",values:{percent:20}})):null),o()("div",{style:n.priceText},void 0,o()(S.FormattedMessage,{id:"spaceSubscriptionSettings.orderOptions.billingPeriodSection.memberPrice",description:"The price users will pay per month for their subscription. The price is formatted like $10",defaultMessage:"{memberPrice} / member / month",values:{memberPrice:(0,_._B)({subscriptionTier:r,intl:i})[a]}})))}function Te(e){window.__c={n:"NoThanksOption"};const{isSelected:t}=e,a=Me(),r=t?a.mainTextSelected:a.mainTextUnselected;return o()("div",{style:r},void 0,o()(S.FormattedMessage,{id:"spaceSubscriptionSettings.orderOptions.addOnsSection.noThanks",description:"Users can select this option to not add any add-ons to their subscription",defaultMessage:"No thanks"}))}function xe(e){const{isSelected:t,billingInterval:a,intl:r}=e,i=Me(),n=t?i.mainTextSelected:i.mainTextUnselected;return d.createElement(d.Fragment,null,o()("div",{style:i.row},void 0,g.Z.sparkles(i.icon),o()("div",{style:n},void 0,o()(S.FormattedMessage,{id:"spaceSubscriptionSettings.orderOptions.addOnsSection.notionAi",description:"Users can select this option to add Notion AI to their subscription",defaultMessage:"Notion AI"}))),o()("div",{style:i.priceText},void 0,o()(S.FormattedMessage,{id:"spaceSubscriptionSettings.orderOptions.addOnsSection.aiMonthlyPrice",description:"Indicates the price of Notion AI per month",defaultMessage:"+{memberPrice} / member / month",values:{memberPrice:(0,_.v3)({addOnFeature:"ai",billingInterval:a,quantity:1,getMonthlyPrice:!0,intl:r}).formattedAmount}})))}function Ue(e){const t=(0,S.useIntl)(),a=(0,ie.O7)(),[r,i,n,s]=(0,ne.VK)((()=>{var e;const t=H.Z.state,a=(null===(e=fe.default.state.data)||void 0===e?void 0:e.addOns)??[];return[t.subscriptionTier,t.temporaryBillingInterval,t.addOnFeature,(0,h.de)(a)]}),[]),l=(0,d.useMemo)((()=>[{key:"month",render:()=>o()(we,{isSelected:"month"===i,billingInterval:"month",subscriptionTier:r,intl:t})},{key:"year",render:()=>o()(we,{isSelected:"year"===i,billingInterval:"year",subscriptionTier:r,intl:t})}]),[i,r,t]),p=(0,d.useMemo)((()=>[{key:"none",render:()=>o()(Te,{isSelected:!n})},{key:"ai",render:()=>o()(xe,{isSelected:"ai"===n,billingInterval:i??"month",intl:t})}]),[n,i,t]);return d.createElement(d.Fragment,null,o()(Ce,{header:o()(S.FormattedMessage,{id:"spaceSubscriptionSettings.orderOptions.billingPeriodSection.header",description:"Title of the billing period section on the subscription upgrade modal",defaultMessage:"Billing period"})},void 0,o()(Se,{items:l,value:i,onChange:e=>{C.trackSubscriptionUpgradeModalBillingIntervalUpdated(a,{billingInterval:e}),H.Z.update((t=>({...t,temporaryBillingInterval:e})))}})),s?null:o()(Ce,{header:o()(S.FormattedMessage,{id:"spaceSubscriptionSettings.orderOptions.addOnsSection.header",description:"Title of the add-ons section on the subscription upgrade modal",defaultMessage:"Add-ons"})},void 0,o()(Se,{items:p,value:n??"none",onChange:e=>{const t=[];let r;switch(e){case"ai":r="ai",t.push("ai");break;default:r=void 0}C.trackSubscriptionUpgradeModalAddOnFeaturesUpdated(a,{addOnFeatures:t}),H.Z.update((e=>({...e,addOnFeature:r})))}})))}var Ze=a(32056),Fe=a(61519),Ae=a(43568),Pe=a(74523),ke=a(24006);function Ie(e){window.__c={n:"ApplyCreditsToggle"};const[t,a]=(0,ne.AF)(H.Z),r=(0,oe.yK)(Be,[]),i=(0,ie.O7)(),n=(0,S.useIntl)();return!t.open||e.data.availableCredit<=0||t.type!==H.U.CurrentSpace?null:o()("div",{style:r.toggle,onClick:()=>{!function(e){const{data:t,state:a,setModalState:r,environment:i}=e,n=void 0===a.temporaryUseCreditCents||a.temporaryUseCreditCents===t.availableCredit?0:t.availableCredit;r({...a,temporaryUseCreditCents:n}),C.trackCreditsInputToggled(i,{credits:n})}({environment:i,data:e.data,state:t,setModalState:a})}},void 0,o()("div",{style:{marginRight:8}},void 0,o()(S.FormattedMessage,{id:"applyCreditToggle.applyCredit.amount",defaultMessage:"Apply {creditAmount} credit",description:"Whether to apply credit to this subscription. The amount is formatted with currency",values:{creditAmount:(0,Ze.Dx)({amount:e.data.availableCredit,currency:"dollar",intl:n})}})),o()(ke.Z,{on:(0,_.Ry)(t,e.data)===e.data.availableCredit}))}function Be(e){return{toggle:{cursor:"pointer",fontSize:14,color:e.regularTextColor,display:"flex",justifyContent:"space-between",marginTop:14,marginBottom:7}}}var Oe=a(68785),_e=a(1063);function ze(e){window.__c={n:"SpaceSubscriptionOrderSummary"};const{state:t,data:a,promo:r}=e,i=(0,oe.yK)((e=>({container:{display:"flex",flexDirection:"column",gap:16},header:{fontSize:16,color:e.regularTextColor,fontWeight:v.Z.fontWeight.semibold,marginBottom:11},couponLink:{fontSize:12}})),[]),n=!t.onlyShowAddOn,s=void 0!==t.addOnFeature;return o()("div",{style:i.container},void 0,o()("label",{style:i.header},void 0,o()(S.FormattedMessage,{id:"spaceSubscriptionUpgradeModal.orderSummary.header",defaultMessage:"Order summary"})),n?o()(We,{state:t,data:a,isAddOnFeature:!1}):null,s?o()(We,{state:t,data:a,isAddOnFeature:!0}):null,_.Fu(t.subscriptionTier)&&o()(_e.X,{tier:t.subscriptionTier}),0!==a.availableCredit&&o()(Ie,{data:a}),o()(Fe.Z,{size:1}),o()(Ne,{state:t,data:a,promo:r,style:{marginBottom:8}}),o()(Ee,{state:t,data:a,promo:r}))}function Ee(e){window.__c={n:"OrderTotal"};const{state:t,data:a,promo:r}=e,{payAmount:i}=_.uN({state:t,promo:r,data:a}),n=(0,oe.yK)((e=>({name:{fontSize:16,color:e.regularTextColor},price:{fontSize:20,lineHeight:"20px"}})),[]);return o()(Le,{lineItem:{price:i,type:"standard",name:o()(S.FormattedMessage,{id:"spaceSubscriptionUpgradeOrderSummary.totalForToday",defaultMessage:"Total for today"})},nameStyle:n.name,priceStyle:n.price})}function Ne(e){window.__c={n:"OrderBreakdown"};const{state:t,data:a,promo:r,style:i}=e,{lineItems:n}=_.uN({state:t,promo:r,data:a}),s=n.map((e=>o()(Le,{lineItem:e},`${e.name}:${e.price}:${e.type}`)));return o()("div",{style:i},void 0,s)}function Le(e){window.__c={n:"LineItem"};const{lineItem:t,nameStyle:a,priceStyle:r,showZeroPrice:i}=e,n=(0,oe.yK)((e=>({container:{marginTop:24},itemContainer:{display:"flex",justifyContent:"space-between",alignItems:"baseline",lineHeight:1.7},name:{fontSize:14,color:e.mediumTextColor,...a||void 0},price:{fontSize:14,color:"promotion"===t.type?"#53A83F":e.regularTextColor,...r||void 0},caption:{fontSize:12,color:e.mediumTextColor},captionContainer:{display:"flex",flexDirection:"column"}})),[t,a,r]),s=(0,S.useIntl)(),d=t.price??0,l=void 0!==t.price&&i,p=d>0||l?(0,Ze.Dx)({amount:d,currency:"dollar",intl:s}):"—";return o()("div",{style:n.itemContainer},void 0,o()("div",{style:n.captionContainer},void 0,o()("span",{style:n.name},void 0,t.name),t.subtitle&&o()("span",{style:n.caption},void 0,t.subtitle)),"calculating"===t.type?o()(Oe.Z,{}):o()("span",{style:n.price},void 0,p))}function We(e){window.__c={n:"SpaceSubscriptionGrossOrder"};const{state:t,data:a,isAddOnFeature:r}=e,i=(0,S.useIntl)(),n=function(e,t){const{subscriptionTier:a}=e;if(t)return o()(S.FormattedMessage,{id:"spaceSubscriptionUpgradeModal.orderSummary.ai.addOn",defaultMessage:"Notion AI",description:"Line item shown when summarizing plan upgrade"});if((0,f.QM)(a)||(0,f.iJ)(a))return;switch(a){case"personal":return o()(S.FormattedMessage,{id:"spaceSubscriptionUpgradeModal.orderSummary.singlePlayerPlusPlan",defaultMessage:"Plus plan with a 1-member limit",description:"Line item shown when summarizing plan upgrade"});case"plus":case"team":return o()(S.FormattedMessage,{id:"spaceSubscriptionUpgradeModal.orderSummary.plusPlan",defaultMessage:"Plus plan",description:"Line item shown when summarizing plan upgrade"});case"business":return o()(S.FormattedMessage,{id:"spaceSubscriptionUpgradeModal.orderSummary.businessPlan",defaultMessage:"Business plan",description:"Summarizes the business plan type a user is trying to upgrade to."});case"enterprise":return o()(S.FormattedMessage,{id:"spaceSubscriptionUpgradeModal.orderSummary.enterprisePlan",defaultMessage:"Enterprise plan"});default:(0,b.t1)(a)}}(t,r),s=function(e,t,a,r){const{subscriptionTier:i,addOnFeature:n}=e,s=_.GD(e),d=_.su(t);let l;if(r&&void 0!==n)l=_.v3({addOnFeature:n,billingInterval:s,quantity:1,getMonthlyPrice:!0,intl:a}).formattedAmount;else{if((0,f.QM)(i)||(0,f.iJ)(i))return null;l=_._B({subscriptionTier:i,intl:a})[s]}switch(s){case"year":return o()(S.FormattedMessage,{id:"spaceSubscriptionUpgradeModal.orderSummary.planSubtitle.billedYearly",defaultMessage:"{price} / member / month × {numberOfMembers, plural, one {# member} other {# members}}{br}Billed yearly",values:{br:o()("br",{}),price:l,numberOfMembers:d}});case"month":return o()(S.FormattedMessage,{id:"spaceSubscriptionUpgradeModal.orderSummary.planSubtitle.billedMonthly",defaultMessage:"{price} / member / month × {numberOfMembers, plural, one {# member} other {# members}}{br}Billed monthly",values:{br:o()("br",{}),price:l,numberOfMembers:d}});default:(0,b.t1)(s)}}(t,a,i,r),d=_.su(a),{planAmount:l}=_.ZT({state:t,memberCount:d,isAddOnFeature:r}),p=(0,oe.yK)((e=>({container:{display:"flex",justifyContent:"space-between"},item:{},title:{fontSize:14,fontWeight:v.Z.fontWeight.medium,marginBottom:4},subtitle:{color:e.mediumTextColor,fontSize:12},price:{fontSize:14}})),[]);return o()("div",{style:p.container},void 0,o()("div",{style:p.item},void 0,o()("div",{style:p.title},void 0,n),o()("div",{style:p.subtitle},void 0,s)),o()("div",{style:p.price},void 0,(0,Ze.Dx)({amount:l,currency:"dollar",intl:i})))}function De(e){window.__c={n:"SpaceSubscriptionOrderSummaryForClaimAndUpgrade"};const{state:t}=e,a=(0,oe.yK)((e=>({container:{display:"flex",flexDirection:"column"},header:{fontSize:16,color:e.regularTextColor,fontWeight:v.Z.fontWeight.semibold,marginBottom:10},couponLink:{fontSize:12},helpButton:{marginLeft:0,marginTop:-4,marginBottom:12},helpButtonInner:{fontSize:12}})),[]),r=t.taxAmount,i=t.calculatingTax,n=void 0!==t.totalUpgradeCost?Math.max(0,t.totalUpgradeCost+(r&&!i?r:0)):void 0;return o()("div",{style:a.container},void 0,o()("label",{style:a.header},void 0,o()(S.FormattedMessage,{id:"spaceSubscriptionUpgradeModal.orderSummary.header",defaultMessage:"Order summary"})),void 0!==t.totalUpgradeCost?d.createElement(d.Fragment,null,o()(He,{totalCostForUpgrade:t.totalUpgradeCost,memberCount:t.targetSpace.memberCount}),o()(Pe.Z,{style:a.helpButton,buttonStyle:a.helpButtonInner,title:o()(S.FormattedMessage,{id:"invoice.details.helpButton.label",defaultMessage:"Learn more about prorated charges"}),href:(0,k.UY)("guides.billingAndPayment"),analyticsFrom:"invoices"}),o()(Re,{state:t}),o()(Fe.Z,{size:14}),o()(Le,{showZeroPrice:!0,lineItem:{price:n,type:"standard",name:o()(S.FormattedMessage,{id:"spaceSubscriptionUpgradeOrderSummary.orderTotal",defaultMessage:"Total"})},priceStyle:{fontSize:20}})):o()(Ke,{}))}function Re(e){return d.createElement(d.Fragment,null,o()(Le,{showZeroPrice:!0,lineItem:{type:"standard",name:o()(S.FormattedMessage,{id:"subscriptionHelpers.lineItems.subTotal",defaultMessage:"Subtotal"}),price:e.state.totalUpgradeCost}}),o()(Le,{lineItem:{type:e.state.calculatingTax?"calculating":"standard",name:o()(S.FormattedMessage,{id:"subscriptionHelpers.lineItems.tax.title",defaultMessage:"Tax"}),price:e.state.taxAmount,subtitle:e.state.taxAmount||0===e.state.taxAmount?void 0:o()(S.FormattedMessage,{id:"subscriptionHelpers.lineItems.tax.subtitle",defaultMessage:"if applicable"})}}))}function He(e){window.__c={n:"SpaceUpgradeCostOrder"};const{totalCostForUpgrade:t,memberCount:a}=e,r=(0,S.useIntl)(),i=(0,oe.yK)((e=>({container:{display:"flex",justifyContent:"space-between",marginBottom:6},item:{},title:{fontSize:14},subtitle:{color:e.mediumTextColor,fontSize:12},price:{fontSize:14,color:e.regularTextColor}})),[]);return o()("div",{style:i.container},void 0,o()("div",{style:i.item},void 0,o()("div",{style:i.title},void 0,o()(S.FormattedMessage,{id:"spaceSubscriptionUpgradeModal.orderSummary.proratedChanges",defaultMessage:"Prorated charges",description:"Explains that the price listed here is for prorated charges."})),o()("div",{style:i.subtitle},void 0,o()(S.FormattedMessage,{id:"spaceSubscriptionUpgradeModal.orderSummary.proratedChangesCaption",defaultMessage:"All charges due to claim and upgrade the workspace ({memberCount, plural, one {{memberCount} member} other {{memberCount} members}}).",description:"Explains that prorated charges will be due to upgrade the workspace.",values:{memberCount:a}}))),o()("div",{style:i.price},void 0,(0,Ze.Dx)({amount:t,currency:"dollar",intl:r})))}function Ke(){return d.createElement(d.Fragment,null,o()(Ae.Z,{paragraphs:[{lineHeight:18,lineMargin:4,sectionWidths:[100],repeat:1,sectionMargin:0},{lineHeight:14,lineMargin:4,sectionWidths:[100,40],repeat:1,sectionMargin:-2}]}),o()("div",{style:{display:"block",height:27}}),o()(Ae.Z,{paragraphs:[{lineHeight:16,lineMargin:1,sectionWidths:[100],repeat:2,sectionMargin:4}]}),o()(Ae.Z,{paragraphs:[{lineHeight:14,lineMargin:0,sectionWidths:[30],repeat:1,sectionMargin:4}]}),o()(Fe.Z,{size:14}),o()(Ae.Z,{paragraphs:[{lineHeight:24,lineMargin:4,sectionWidths:[100],repeat:1,sectionMargin:1}]}))}var Ve=a(32617),Ye=a(10644);const qe=(0,S.defineMessages)({loading:{defaultMessage:"Claiming and upgrading workspace...",id:"spaceSubscriptionUpgradeModal.upgradeTargetSpace.loading",description:"Loading state describing how we're in the process of claiming and upgrading the space."}});class Ge extends l.Z{constructor(){super(...arguments),this.storeTypes={paymentOptionAvailabilityStore:D.Z},this.renderModalSummary=e=>e.type===H.U.TargetSpace?o()(De,{state:e}):o()(ze,{state:e,data:this.props.data,promo:e.appliedPromo}),this.renderModal=()=>{const e=H.Z.state;if(!e.open)return;if(!N.Z.state.online)return o()(Ye.Z,{});const t={closeButton:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:21,right:20,width:22,height:22,padding:0,borderRadius:"50%",border:"none",background:"light"===this.theme.mode?c.FN.light.gray[75]:c.FN.dark.gray[500],zIndex:10},closeButtonIcon:{width:12,height:12,fill:"light"===this.theme.mode?c.FN.light.gray[400]:c.FN.dark.gray[800]}},a=(0,O.C0)()&&!e.onlyShowAddOn&&e.type===H.U.CurrentSpace,r=this.getVisiblePaymentMethods();return d.createElement(d.Fragment,null,o()("div",{style:{flex:1,maxWidth:"60%",backgroundColor:this.theme.modalBackground,display:"flex",flexDirection:"column",position:"relative",borderRadius:"12px 0 0 12px"}},void 0,o()(J.Z,{type:z.Z.Y,showScrollToBottomIndicator:!0},void 0,o()("div",{style:{padding:"36px 42px 50px 42px",display:"flex",flexDirection:"column"}},void 0,this.renderPlanHeader(e),a?o()(Ue,{}):this.renderBillingIntervalSection(e),this.renderPaymentMethodSection(e),o()(ue,{storeState:e,paymentMethods:r})))),o()("div",{style:{flex:1,maxWidth:"40%",backgroundColor:this.theme.sidebarSecondaryBackground,borderLeft:`1px solid ${this.theme.lightDividerColor}`,padding:"20px 29px 50px 27px",display:"flex",flexDirection:"column"}},void 0,o()(J.Z,{type:z.Z.Y},void 0,this.renderModalSummary(e),this.renderControls(e))),o()("button",{style:t.closeButton,onClick:()=>{H.Z.setState({open:!1})}},void 0,g.Z.close(t.closeButtonIcon)))},this.validateAddress=async e=>{const t=e.temporaryAddress,a=await M.a(this.environment,t);return a.valid&&a.validatedAddresses&&H.Z.setState({...e,temporaryAddress:{...e.temporaryAddress,...a.validatedAddresses[0]}}),"CA"===t.country?{valid:!0}:(a.valid||(t.country?H.Z.setState({...e,error:this.props.intl.formatMessage({id:"spaceSubscriptionUpgradeModal.billingAddress.invalidError",defaultMessage:"Your address is invalid. Please update your address so we can process your payment."})}):H.Z.setState({...e,error:this.props.intl.formatMessage({id:"spaceSubscriptionUpgradeModal.billingAddress.missingCountryError",defaultMessage:"Invalid country. Please select the country from the dropdown menu."})}),C.trackUpgradeSubscriptionFailed(this.environment,{error:void 0,error_type:"address"})),a)},this.handleModalClose=()=>{H.Z.reset(),C.trackSubscriptionUpgradeModalDismissed(this.environment)},this.refreshTax=async()=>{await this.maybeSetUpgradeCost(),await F.W(this.environment)},this.maybeSetUpgradeCost=async()=>{H.Z.state.open&&H.Z.state.type===H.U.TargetSpace&&await this.maybeSetCostForSpaceUpgradeToEnterprise()},this.showClaimAndUpgradeToast=e=>{U.oV({label:o()(S.FormattedMessage,{id:"identityProvisioningSettings.claimWorkspaces.claimModal.selfServe.toast",defaultMessage:"Successfully claimed “{spaceName}“",description:"Message in toast to indicate a workspace claim has been successfully processed.",values:{spaceName:e}})})}}didMount(){if(this.maybeSetUpgradeCost(),!H.Z.state.open)return;const{currentUserStore:e}=E.default.state,t=null!=e&&e.isDefined()?e.getModel():void 0;if(t){const e=t.getDisplayName(this.props.intl);var a;if(H.Z.setState({...H.Z.state,temporaryAddress:{...H.Z.state.temporaryAddress,name:e}}),"subscribed_admin"===this.props.data.type||"unsubscribed_admin"===this.props.data.type)H.Z.setState({...H.Z.state,appliedPromo:null===(a=this.props.data.customerData)||void 0===a?void 0:a.stripe.promo})}["local","development","staging"].includes(A.Z.env)&&(0,u.exposeDebugValue)("useTestClock",(()=>{H.Z.setUseTestClock(!0)}))}didUpdate(e){if(this.props.stripe&&!e.stripe){const e=this.props.stripe.paymentRequest({country:"US",currency:"usd",total:{label:this.props.intl.formatMessage({id:"spaceSubscriptionUpgradeModal.applePay.total.label",defaultMessage:"Notion - You will be charged on a recurring basis"}),amount:0}});e.canMakePayment().then((t=>{t&&(this.stores.paymentOptionAvailabilityStore.setState({...this.stores.paymentOptionAvailabilityStore.state,supportsApplePay:t.applePay,paymentRequest:e}),this.stores.paymentOptionAvailabilityStore.addPaymentOption("native_payment_platform"))})),e.on("token",(async e=>{const t=H.Z.state;if(!t.open)return;const{valid:a}=await this.validateAddress(t);a?this.handleUpgradeForCurrentSpace(e.token.id,e.complete):e.complete("fail")}))}}renderComponent(){return o()($.Z,{open:H.Z.state.open,preventHideChildrenWhileOpening:!0,innerStyle:this.getModalStyle(),render:()=>o()(q.Z,{capture:!0,allowEsc:!0,render:()=>this.renderModal()}),onDismiss:this.handleModalClose})}renderPlanHeader(e){var t,a;const{onlyShowAddOn:r}=e;let i=e.subscriptionTier;i===f.$M&&(i="plus");const n=null===(t=Ve.LU[i])||void 0===t||null===(a=t.imageByMode)||void 0===a?void 0:a[this.theme.mode];let s;return s=r?o()("img",{src:p.Z.images.pricing.aiLogoPng,style:{width:45}}):void 0!==n?o()("img",{src:n,style:{width:40}}):g.Z.notionLogoStroked({width:34,height:34,marginBottom:14}),d.createElement(d.Fragment,null,s,o()("div",{style:{...this.getPrimaryTextStyle(),marginTop:24,marginBottom:6}},void 0,this.getPlanTitle(e)),o()("div",{style:this.getSecondaryTextStyle(e)},void 0,this.getOneLiner(e)))}getOneLiner(e){const{onlyShowAddOn:t,addOnFeature:a}=e,r=E.default.state.currentSpaceStore;if(!r)return null;const i=(0,I.rn)(this.environment,r);if(t&&a)switch(a){case"ai":return o()(S.FormattedMessage,{id:"addOnUpgrade.confirmation.description.admins",defaultMessage:"Go unlimited with Notion AI for all members in {spaceName}.",description:"Shown when a customer has run out of Notion AI and needs to upgrade.",values:{spaceName:i}});default:(0,b.t1)(a)}switch(e.subscriptionTier){case"personal":return o()(S.FormattedMessage,{id:"subscriptionUpgradeModal.oneLiner.personal",defaultMessage:"For power users who want to do even more."});case"plus":case"team":case"business":return o()(S.FormattedMessage,{id:"subscriptionUpgradeModal.oneLiner.team",defaultMessage:"Write, plan, and work together in one spot."});case"enterprise":return o()(S.FormattedMessage,{id:"subscriptionUpgradeModal.oneLiner.enterprise",defaultMessage:"Controls and support to run your company."});default:(0,b.t1)(void 0)}}getPlanTitle(e){const{onlyShowAddOn:t,addOnFeature:a,subscriptionTier:r}=e;if(e.open&&e.type===H.U.TargetSpace)return o()(S.FormattedMessage,{id:"subscriptionUpgradeModal.targetSpace.title.enterprise",defaultMessage:"Claim & Upgrade to Enterprise",description:"Title for billing page for the workspace claim and upgrade flow"});if(t&&a)switch(a){case"ai":return o()(S.FormattedMessage,{id:"subscriptionUpgradeModal.ai.addOn.title",defaultMessage:"Get more Notion AI",description:"Title for ai add-on upgrade flow"});default:(0,b.t1)(a)}return(0,f.QM)(r)||(0,f.iJ)(r)?null:{personal:o()(S.FormattedMessage,{id:"subscriptionUpgradeModal.title.personal",defaultMessage:"Upgrade to Personal Pro"}),plus:o()(S.FormattedMessage,{id:"subscriptionUpgradeModal.title.plus",defaultMessage:"Upgrade to Plus",description:"Shown when a user is going to upgrade to a plus plan type."}),team:o()(S.FormattedMessage,{id:"subscriptionUpgradeModal.title.plus",defaultMessage:"Upgrade to Plus",description:"Shown when a user is going to upgrade to a plus plan type."}),business:o()(S.FormattedMessage,{id:"subscriptionUpgradeModal.upgradeToBusinessDialog.businessPlan",defaultMessage:"Upgrade to Business",description:"Shown when a user is going to upgrade to a business plan type."}),enterprise:o()(S.FormattedMessage,{id:"subscriptionUpgradeModal.title.enterprise",defaultMessage:"Upgrade to Enterprise"}),team_free:o()(S.FormattedMessage,{id:"subscriptionUpgradeModal.title.teamFree",defaultMessage:"Upgrade to Team Trial"})}[r]}renderControls(e){return d.createElement(d.Fragment,null,this.renderUpgradeButton(e),this.renderAddOnTermsOfService(e),this.renderErrorMessage(e),this.renderContactSales(e))}renderAddOnTermsOfService(e){const{addOnFeature:t,onlyShowAddOn:a}=e,r={color:this.theme.mediumTextColor,fontSize:12,paddingTop:16,lineHeight:v.Z.lineHeight.UISmall.desktop};return o()("div",{style:r},void 0,o()(S.FormattedMessage,"ai"===t?a?{id:"subscriptionUpgradeModal.confirmation.aiOnly",defaultMessage:"By clicking “Upgrade now” you agree to the <aiTerms>Notion AI Product Specific Terms</aiTerms>.{br}{br}Performance subject to fair use policies.{br}<fairUsePolicies>Learn more</fairUsePolicies>.",description:"Shown as a warning in the confirmation modal before a user subscribes to an add-on so they understand how it affects their subscription.",values:{br:o()("br",{}),fairUsePolicies:e=>o()(te.Z,{href:(0,k.UY)("ai.fairUsePolicies")},void 0,e),aiTerms:e=>o()(te.Z,{href:(0,k.UY)("ai.terms")},void 0,e)}}:{id:"subscriptionUpgradeModal.confirmation.planWithAi",defaultMessage:"By clicking “Upgrade now” you agree to the <terms>Notion Terms and Conditions</terms> and <aiTerms>Notion AI Product Specific Terms</aiTerms>.{br}{br}Performance subject to fair use policies.{br}<fairUsePolicies>Learn more</fairUsePolicies>.",description:"Shown as a warning in the confirmation modal before a user subscribes to an add-on so they understand how it affects their subscription.",values:{br:o()("br",{}),terms:e=>o()(te.Z,{href:(0,k.UY)("terms")},void 0,e),fairUsePolicies:e=>o()(te.Z,{href:(0,k.UY)("ai.fairUsePolicies")},void 0,e),aiTerms:e=>o()(te.Z,{href:(0,k.UY)("ai.terms")},void 0,e)}}:{id:"subscriptionUpgradeModal.confirmation.planOnly",defaultMessage:"By clicking “Upgrade now” you agree to the <terms>Notion Terms and Conditions</terms>.",description:"Shown as a warning in the confirmation modal before a user upgrades their plan so they understand how it affects their subscription.",values:{terms:e=>o()(te.Z,{href:(0,k.UY)("terms")},void 0,e)}}))}renderContactSales(e){if(!(0,f.Rs)(e.subscriptionTier))return;const t=L.default.getEligibleGroup({experimentId:"in_app_contact_sales_cta_billing",defaultGroup:"control"}),a=o()(S.FormattedMessage,"on"===t?{defaultMessage:"Request a demo",id:"helpButton.salesChat.menuItemDemoVariant",description:"Title for help menu item prompting the user to request a demo from the sales team."}:{id:"spaceSubscriptionSettings.upgradeModal.contactSales",defaultMessage:"Contact sales",description:"Shown below the upgrade button in case users want to do a trial of the subscription before purchasing."});return d.createElement(d.Fragment,null,o()(Q.Z,{style:{width:"100%",height:40,marginTop:10},onClick:()=>{const{currentUserStore:t}=E.default.state,a=null!=t&&t.isDefined()?null==t?void 0:t.getModel():void 0;W.Z.setState({open:!0,email:a&&a.getEmail(),name:a&&a.getDisplayName(this.props.intl),question:this.getQuestion(e.subscriptionTier)}),C.trackEnterpriseSalesContactOpened(this.environment)}},void 0,g.Z.chat({height:18,width:20,marginRight:6}),o()("span",{style:{fontWeight:v.Z.fontWeight.medium}},void 0,a)),o()("p",{style:{color:this.theme.mediumTextColor,fontSize:12,lineHeight:v.Z.lineHeight.UISmall.desktop}},void 0,o()(S.FormattedMessage,{id:"spaceSubscriptionSettings.upgradeModal.sales.questions",defaultMessage:"Questions? Contact our sales team for more information."})))}getQuestion(e){return(0,f.wP)(e)?"setup_enterprise_trial":(0,f.NG)(e)?"setup_business_trial":void 0}renderErrorMessage(e){const t=e.error;if(t)return o()(ee.Z,{isMultiline:!0,style:{marginTop:8,color:c.ZP.red}},void 0,t)}renderUpgradeButton(e){const t=e.temporaryPaymentMethod,a={width:"100%",height:40,marginTop:24,fontSize:16};return this.stores.paymentOptionAvailabilityStore.state.supportsApplePay&&"native_payment_platform"===t?o()("button",{style:{...a,WebkitAppearance:"-apple-pay-button"},onClick:()=>this.handleUpgradeClick(e)}):o()(K.Z,{disabled:"disabled"===e.payButtonState,style:a,onClick:()=>this.handleUpgradeClick(e)},void 0,this.getUpgradeButtonText(e))}getUpgradeButtonText(e){return e.open&&e.type===H.U.TargetSpace?o()(S.FormattedMessage,{id:"subscriptionUpgradeModal.targetSpace.button.enterprise",defaultMessage:"Claim & Upgrade to Enterprise",description:"Button on billing page to pay and complete the claiming and upgrade flow"}):e.useTestClock?d.createElement(d.Fragment,null,"Upgrade with test clock"):o()(S.FormattedMessage,{id:"subscriptionUpgradeModal.upgradeButton.upgradeNow",defaultMessage:"Upgrade now",description:"Button on upgrade modal to confirm"})}renderBillingIntervalSection(e){if(e.addOnFeature)return H.Z.setState({...e,temporaryBillingInterval:"month"}),null;const t=e.appliedPromo,{yearlyUnitPrice:a,monthlyUnitPrice:r}=e.type===H.U.TargetSpace?_.ZT({state:e,memberCount:e.targetSpace.memberCount,isAddOnFeature:void 0!==e.addOnFeature}):_.uN({state:e,promo:t,data:this.props.data}),n=_.GD(e),s=1-a/(12*r),l=_.x7(e,s,this.props.intl),p=l.find((e=>e.id===n))||l[0],c=o()(S.FormattedMessage,{id:"spaceSubscriptionSettings.upgradeModal.billingIntervalSection.header",defaultMessage:"Billing interval"});return o()("div",{style:this.getSectionStyle()},void 0,o()("div",{style:this.getSubheaderStyle()},void 0,o()("div",{},void 0,c)),o()(Y.Z,{popupType:Y.Z.PopupType.Popup,placementToOrigin:Y.Z.Placement.Bottom,sameWidthAsOrigin:!0,renderOrigin:e=>d.createElement(Q.Z,i()({},e,{isLarge:!0,style:{marginBottom:4,width:"100%",justifyContent:"space-between"}}),p.title,g.Z.chevronDown({width:10,marginLeft:4,fill:this.theme.lightIconColor})),render:e=>{const t={menuType:P.og.Popup,width:"100%"},a=l.map((t=>({key:t.id,action:t=>{const a=l[t.index].id;H.Z.update((e=>({...e,temporaryBillingInterval:a}))),C.trackSubscriptionUpgradeModalBillingIntervalUpdated(this.environment,{billingInterval:a}),this.refreshTax(),e.close()},render:e=>d.createElement(V.Z,i()({},e,{title:t.title}))})));return d.createElement(G.Z,t,o()("div",{style:{width:"100%"}},void 0,o()(j.Z,{type:j.i.Vertical,sections:[{key:"billing interval section",render:e=>d.createElement(X.Z,e),items:a}],initialFocus:void 0})))}}))}getVisiblePaymentMethods(){return H.Z.state.open&&H.Z.state.type===H.U.TargetSpace?this.stores.paymentOptionAvailabilityStore.state.availablePaymentMethods.filter((e=>"credit_card"===e)):this.stores.paymentOptionAvailabilityStore.state.availablePaymentMethods}renderPaymentMethodSection(e){const t=e.temporaryPaymentMethod,a=o()(S.FormattedMessage,{id:"spaceSubscriptionSettings.upgradeModal.paymentMethodSection.header",defaultMessage:"Payment method"}),r=this.getVisiblePaymentMethods();if(r.length<2)return null;const i=_.zt(r);return o()("div",{},void 0,o()("div",{style:this.getSubheaderStyle()},void 0,o()("div",{},void 0,a)),i.map((e=>{let{type:a,title:r,caption:i}=e;return o()(d.Fragment,{},a,this.renderRadioButton({title:r,caption:i,isSelected:t===a,onClick:()=>{H.Z.update((e=>({...e,temporaryPaymentMethod:a}))),C.trackSubscriptionUpgradeModalPaymentMethodUpdated(this.environment,{paymentMethod:a})},unavailable:!1}))})))}renderRadioButton(e){const{title:t,caption:a,isSelected:r,onClick:i,unavailable:n}=e,s=n?.4:1;return o()("div",{style:{cursor:"pointer",opacity:s},onClick:i},void 0,o()("div",{style:{display:"flex",alignItems:"center",fontSize:12}},void 0,o()(ae.Z,{isSelected:r}),t),o()("div",{style:{color:this.theme.mediumTextColor,fontSize:12,marginLeft:24,marginTop:2,marginBottom:8}},void 0,a))}async handleUpgradeClick(e){const t=e.temporaryPaymentMethod;C.trackUpgradeSubscriptionClick(this.environment,{paymentMethod:t});const a=this.stores.paymentOptionAvailabilityStore.state.paymentRequest;if("native_payment_platform"===t&&a)return void a.show();H.Z.update((e=>({...e,payButtonState:"disabled"})));const{valid:r}=await this.validateAddress(e);r&&await this.handleNonNativeUpgrade(e);const i=H.Z.state;i.open&&H.Z.setState({...i,payButtonState:"enabled"})}async handleNonNativeUpgrade(e){if("invoice"===e.temporaryPaymentMethod)return await this.handleUpgradeForCurrentSpace(void 0,void 0);const{stripe:t,elements:a}=this.props;if(!a||!t)return void m.log({level:"error",from:"SpaceSubscriptionUpgradeModal",type:"StripeError",error:{miscDataString:"Stripe elements not initialized when user tried to upgrade"}});const r=a.getElement(s.CardElement);if(!r)return void m.log({level:"error",from:"SpaceSubscriptionUpgradeModal",type:"StripeError",error:{miscDataString:"Stripe Card Element could not be found"}});const i=await t.createToken(r);if(!i.error&&i.token){const t=i.token.id;e.type===H.U.TargetSpace?await this.handleClaimAndUpgrade(t):await this.handleUpgradeForCurrentSpace(t,void 0)}else i.error?(C.trackUpgradeSubscriptionFailed(this.environment,{error:i.error.message,error_type:"credit_card"}),H.Z.setState({...e,error:B.translateStripeError(this.environment,this.props.intl,i.error)})):(C.trackUpgradeSubscriptionFailed(this.environment,{error:"could not create token",error_type:"credit_card"}),H.Z.setState({...e,error:this.props.intl.formatMessage({id:"spaceSubscriptionUpgradeModal.creditCard.genericError",defaultMessage:"Your card could not be processed. Please try again."})}))}async handleClaimAndUpgrade(e){const t=H.Z.state;if(!t.open)return;if(t.type!==H.U.TargetSpace)return;const a="year"===_.GD(t)?"enterprise_yearly_240":"enterprise_monthly_25",r=t.temporaryAddress;x.j({message:qe.loading});const i=t.targetSpace.id,n=await w.claimAndUpgradeSpace(this.environment,{requestingSpaceId:this.props.spaceStore.id,targetSpaceId:i,targetPlan:a,stripeToken:e,customerName:r.name,businessName:r.businessName,addressLine1:r.addressLine1,addressCity:r.city,addressZip:r.zipCode,addressState:r.state,addressCountry:r.country,vatId:t.vatApplicable?t.temporaryVatCode:void 0});var o;(x.x(),"success"===n.type)?(H.Z.closeWithSuccess(),this.showClaimAndUpgradeToast(t.targetSpace.name),C.trackSpaceClaimUpgradeCompleted(this.environment,{previousOwners:t.targetSpace.admins.map((e=>e.id)),newOwners:this.environment.currentUser.id?[this.environment.currentUser.id]:[],targetSpaceId:i,verifiedDomain:t.targetSpace.creatorEmailDomain,memberCount:t.targetSpace.memberCount,costForUpgrade:t.totalUpgradeCost,currentPlan:null===(o=_.XX(this.props.data))||void 0===o?void 0:o.plan,targetPlan:a})):(T.showError(n),this.handleModalClose())}async handleUpgradeForCurrentSpace(e,t){const a=H.Z.state;if(!a.open)return void(t&&t("fail"));if(a.type===H.U.TargetSpace)return void(t&&t("fail"));const r=a.temporaryPaymentMethod,{spaceStore:i,data:n}=this.props,o=_.GD(a),s=_.Ry(a,n),d=_.Md(a,n),l=(0,_.vr)(a,o),p=a.appliedPromo,c=a.temporaryAddress;await Z.Mg({environment:this.environment,spaceStore:i,plan:l,stripeToken:e,billingEmail:d,creditAmount:s,coupon:p&&"coupon"===p.source?p.code:void 0,customerName:c.name,businessName:c.businessName,addressLine1:c.addressLine1,addressCity:c.city,addressZip:c.zipCode,addressState:c.state,addressCountry:c.country,vatId:a.vatApplicable?a.temporaryVatCode:void 0,promoCodeId:p&&"promo_code"===p.source?p.code:void 0,from:"subscription_upgrade_modal",addOns:(0,h.aG)({addOnFeature:a.addOnFeature,addOnTier:"base",addOnBillingInterval:o,addOnPricingModel:"standard",addOnPricingVariant:(0,h._h)(o),isCancellation:!1}),useTestClock:a.useTestClock})?(C.trackSubscriptionUpgradeModalUpgradeAccepted(this.environment,{paymentMethod:r}),t&&t("success"),p&&(0,y.$r)(this.environment.currentUser.id),this.handleModalClose(),R.Z.setState({...R.Z.state,currentTab:"billing",defaultSubtab:void 0})):(C.trackUpgradeSubscriptionFailedPayment(this.environment),t&&t("fail"))}async maybeSetCostForSpaceUpgradeToEnterprise(){const e=this.props.spaceStore.id,t=H.Z.state;if(!t.open)return;if(t.type!==H.U.TargetSpace)return;H.Z.setState({...H.Z.state,totalUpgradeCost:void 0});const a=t.targetSpace.isActorInSpace?t.targetSpace.memberCount:t.targetSpace.memberCount+1,r=await w.getCostForSpaceUpgrade(this.environment,{targetSpaceId:t.targetSpace.id,requestingSpaceId:e,subscriptionTier:"enterprise",billingInterval:_.GD(t),memberCount:a});if("failed"===r.type)T.showError(r),H.Z.setState({open:!1});else{const e=r.data?Math.max(r.data.totalCost,0):void 0;H.Z.setState({...H.Z.state,totalUpgradeCost:e})}}getPrimaryTextStyle(){return{fontWeight:v.Z.fontWeight.bold,fontSize:20,lineHeight:1.1,marginBottom:2}}getSecondaryTextStyle(e){return{fontWeight:v.Z.fontWeight.regular,fontSize:16,lineHeight:1.4,marginBottom:22,width:e.onlyShowAddOn?"70%":void 0,color:this.theme.mediumTextColor}}getModalStyle(){return{background:this.theme.popoverBackground,borderRadius:12,width:750,maxHeight:760,display:"flex"}}getSectionStyle(){return{marginBottom:20}}getSubheaderStyle(){return{display:"flex",alignItems:"center",marginBottom:6,fontSize:12,fontWeight:v.Z.fontWeight.semibold,color:this.theme.mediumTextColor}}}Ge.displayName="SpaceSubscriptionUpgradeModal";const je=(0,B.injectStripe)((0,S.injectIntl)(Ge))},1063:(e,t,a)=>{a.d(t,{X:()=>c});var r=a(77094),i=a.n(r),n=(a(67294),a(480)),o=a(24405),s=a(5366),d=a(50906),l=a(8323),p=a(42402);function c(e){window.__c={n:"StartupCouponInlineTextLink"};const t=(0,n.O7)(),a=(0,o.yK)((()=>({couponLink:{fontSize:12}})),[]);return i()(p.Z,{href:"https://notionup.typeform.com/to/qYXezfBW",external:!0,style:a.couponLink,onClick:()=>{const a=(0,l.zt)();d.trackCouponTypeformClicked(t,{tier:e.tier,currentTier:a})}},void 0,i()("div",{},void 0,i()(s.FormattedMessage,{id:"startupCouponInlineLink.text",defaultMessage:"Are you a startup?",description:"Shown in our billing/upgrade settings to ask if a user's workspace belongs to a startup."})))}},80366:(e,t,a)=>{a.d(t,{s:()=>o,c:()=>s});var r=a(77094),i=a.n(r),n=(a(67294),a(24405));function o(e){return{backgroundColor:e.groupedFormBackground,borderWidth:1,borderStyle:"solid",borderColor:e.groupedFormBorder,borderRadius:3,borderBottomWidth:0}}function s(e){window.__c={n:"FormGroup"};const t=(0,n.yK)((t=>({group:{display:"flex",borderBottomColor:t.groupedFormBorder,borderBottomWidth:1,borderBottomStyle:"solid",alignItems:"center",flex:1,...e.style}})),[e.style]);return i()("div",{style:t.group},void 0,e.children)}},16100:(e,t,a)=>{a.r(t),a.d(t,{injectStripe:()=>c,getStripe:()=>u,translateStripeError:()=>m});var r=a(77094),i=a.n(r),n=a(86664),o=a(97894),s=a(67294),d=a(50906),l=a(95477);let p=null;function c(e){return t=>{const[a]=s.useState(u);return i()(n.Elements,{stripe:a},void 0,i()(n.ElementsConsumer,{},void 0,(a=>{let{stripe:r,elements:i}=a;const n={...t,stripe:r,elements:i};return s.createElement(e,n)})))}}async function u(){return p||(o.loadStripe.setLoadParameters({advancedFraudSignals:!1}),p=(0,o.loadStripe)(l.Z.stripe.key)),p}function m(e,t,a){if(!a.code)return a.message||"";switch(d.trackStripeErrorMessage(e,{error:a.code,stripe_decline_code:a.decline_code}),a.code){case"invalid_expiry_year_past":return t.formatMessage({id:"stripeHelpers.invalidExpiryYear.error.message",defaultMessage:"Your card's expiration year is in the past."});case"invalid_cvc":return t.formatMessage({id:"stripeHelpers.invalidCVC.error.message",defaultMessage:"Your card's security code is invalid."});case"invalid_number":return t.formatMessage({id:"stripeHelpers.invalidNumber.error.message",defaultMessage:"Your card number is not a valid credit card number."});case"card_declined":return function(e,t){switch(t){case"expired_card":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.expiredCard",defaultMessage:"Your card was declined because it is an expired card.",description:"Shown as an error message if a user's card was declined."});case"incorrect_number":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.incorrectNumber",defaultMessage:"Your card was declined because you input an incorrect number.",description:"Shown as an error message if a user's card was declined."});case"insufficient_funds":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.declinedFunds",defaultMessage:"Your card was declined because of insufficient funds.",description:"Shown as an error message if a user's card was declined."});case"invalid_cvc":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.invalidCvc",defaultMessage:"Your card was declined because you input an invalid CVC number",description:"Shown as an error message if a user's card was declined."});case"invalid_amount":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.invalidAmount",defaultMessage:"Your card was declined because payment amount exceeds the amount that's allowed.",description:"Shown as an error message if a user's card was declined."});default:return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message",defaultMessage:"Your card was declined.",description:"Shown as an error message if a user's card was declined."})}}(t,a.decline_code);default:return a.message||""}}},45407:(e,t,a)=>{a.d(t,{Z:()=>s});var r=a(96486),i=a.n(r),n=a(49085);class o extends n.Z{getInitialState(){return{availablePaymentMethods:["credit_card"],paymentRequest:void 0,supportsApplePay:!1}}isPaymentOptionAvailable(e){return this.state.availablePaymentMethods.includes(e)}addPaymentOption(e){const t=i().uniq([...this.state.availablePaymentMethods,e]);this.setState({...this.state,availablePaymentMethods:t})}}const s=o},19234:(e,t,a)=>{a.d(t,{gq:()=>r});a(96486);function r(e){return e.country&&(t=e.country,!["US","CA"].includes(t))?"skip":e.addressLine1&&e.zipCode||e.addressLine1&&e.city&&e.state||e.zipCode?"should_resolve":"insufficient_data";var t}}}]);