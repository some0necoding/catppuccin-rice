"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[6807],{48298:(e,t,s)=>{s.d(t,{kn:()=>p,kj:()=>g,Tr:()=>h});var i=s(58129),r=s(90468),o=s(19889),n=s(50906),a=s(54642),l=s(10279),d=s(9953),u=s(30149),m=s(3815),c=s(98905);const p=async e=>{const{environment:t,store:s,accessRequestStore:i,forActor:r,status:a,from:m}=e,c=t.currentUser.id;if("approved"===a){const e={type:"existingUser",value:r,spaceRole:"read_and_write"};if(!(await l.n_({environment:t,store:s,inviteTargets:[e],inviteRole:"read_and_write",isOnboarding:!1,invite:{inviteOrigin:"membership_request"}})).success)return}u.createAndCommit({userAction:"GrantAccessActivityAction.handleGrantAccess",environment:t,perform:e=>{d.sW({store:i,transaction:e,data:{granted_time:Date.now(),granted_by_table:o.KJ,granted_by_id:c,resolved_time:Date.now(),resolved_by_table:o.KJ,resolved_by_id:c,status:a}})}}),n.trackResolveMembershipRequest(t,{status:a,request_id:i.id,from:m,for_actor_id:r.id,space_role:s.getRole()})};async function g(e){if(c.Z.reset(),!e.canAdmin)return;const{environment:t,spaceId:s}=e,i=await a.getUnreadAccessRequestCount(t,{parentTable:r.bx,parentId:s,size:1});"success"===i.type&&c.Z.setState({spaceId:s,count:i.data.count})}function h(e,t){const s=new Map;for(const r of t){const t=(0,m.Kv)(e,{table:i.J8,id:r}),n=t.getValue();if(!n)continue;if(n.for_actor_table!==o.KJ||n.created_by_table!==o.KJ)continue;const a=(0,m.Kv)(e,{table:n.for_actor_table,id:n.for_actor_id}).getValue();if(!a)continue;const l=(0,m.Kv)(e,{table:n.created_by_table,id:n.created_by_id}).getValue();if(l)if(s.has(n.for_actor_id)){const e=s.get(n.for_actor_id);if(!e)continue;n.created_time>e.latestRequestTime?s.set(n.for_actor_id,{...e,createdByActorsWithReason:[{actor:l,reason:n.message},...e.createdByActorsWithReason],accessRequest:n,accessRequestStore:t,latestRequestTime:n.created_time}):s.set(n.for_actor_id,{...e,createdByActorsWithReason:[...e.createdByActorsWithReason,{actor:l,reason:n.message}]})}else s.set(n.for_actor_id,{forActor:a,createdByActorsWithReason:[{actor:l,reason:n.message}],accessRequest:n,accessRequestStore:t,latestRequestTime:n.created_time})}return Array.from(s.values())}},95209:(e,t,s)=>{s.d(t,{zK:()=>I,Mr:()=>C,eH:()=>Z,qg:()=>P,kL:()=>F,PV:()=>R,Vu:()=>_,M5:()=>G,jC:()=>x,XC:()=>q,jL:()=>B});var i=s(96486),r=s.n(i),o=s(33728),n=s(27006),a=s(29477),l=s(21202),d=s(90468),u=s(47425),m=s(97880),c=s(10279),p=s(31299),g=s(79817),h=s(75472),v=s(65598),b=s(23537),f=s(79315),S=s(85834),y=s(29677),M=s(50906),w=s(54642),T=s(57688),k=s(93678);const I=async e=>{const{environment:t,store:s,sudoModeStore:i,permissionsInviteStore:r,onInviteStart:a,contextualInviteStore:u,inviteOrigin:p}=e,{tokenQuery:g}=r.state;if((0,o.oH)(g.trim())&&(r.state.isInviteTargetsEmpty||!(0,y.ow)(r.state))){const e={type:"newUser",value:{email:g.trim()},source:"email"};h.Nd({target:e,permissionsInviteStore:r})||r.setState({...r.state,inviteTargets:[...r.state.inviteTargets,e],isInviteTargetsEmpty:!1,tokenQuery:""})}if(!r.state.isInviteTargetsEmpty&&r.state.inviteTargets.length>0){null==a||a();const e=r.state;if((0,y.ow)(e)){if(e.table===l.iU){if(!(0,v.NZ)(s))throw new Error("Table mismatch.");const{inviteTargets:o,flowId:n,emailMessage:a}=e;r.reset();return(await c.n_({environment:t,store:s,sudoModeStore:i,inviteTargets:o,inviteRole:void 0,isOnboarding:!1,invite:{inviteFlowId:n,inviteMessage:a,inviteOrigin:p}})).success}if(e.table===d.bx){if(!(0,v.Mm)(s))throw new Error("Table mismatch.");const{inviteTargets:o,inviteRole:n,flowId:a}=e;r.reset();return(await c.n_({environment:t,store:s,sudoModeStore:i,inviteTargets:o,inviteRole:n,isOnboarding:!1,invite:{inviteFlowId:a,inviteOrigin:p}})).success}(0,m.t1)(e)}else{const{inviteRole:o,flowId:a,emailMessage:l}=e;r.reset();const d=function(e,t){const s=new Set;var i;(0,v.Y)(e)?null===(i=e.getPermissionItems())||void 0===i||i.forEach((e=>{(0,n.jg)(e)&&s.add(e.user_id)})):e.getPermissionItems().forEach((e=>{(0,n.jg)(e)&&s.add(e.user_id)}));return t.filter((e=>"existingUser"!==e.type||!s.has(e.value.id)))}(s,e.inviteTargets);if((0,n.iC)(o)){const e=await c.n_({environment:t,store:s,sudoModeStore:i,inviteTargets:d,inviteRole:o,isOnboarding:!1,invite:{inviteFlowId:a,inviteMessage:l,inviteOrigin:p}});return e.success&&(null==u||u.setState({...null==u?void 0:u.state,invitedEmailToUserIdMap:e.invitedUsers})),e.success}if((0,v.Y)(s)&&(0,y.Db)(e))return await c.GQ({environment:t,store:s,inviteTargets:e.inviteTargets,inviteRole:o,createNewTeamFlowId:a})}}return!0};const C=e=>{e.permissionsInviteStore.setState({...e.permissionsInviteStore.state,modalOpen:!1,flowId:void 0})},Z=e=>{const{permissionsInviteStore:t,contextualInviteStore:s}=e;if(!s)return;const i=[];t.state.inviteTargets.forEach((e=>{if("newUser"===e.type)i.push({email:e.value.email,isGuest:!0});else if("existingUser"===e.type){const t={...e.value,email:e.value.email,isGuest:"none"===e.spaceRole||"not_in_space"===e.spaceRole};i.push(t)}})),s.setState({...s.state,invitedUsers:i})},P=async e=>{const{environment:t,store:s,sudoModeStore:i,permissionsInviteStore:r,contextualInviteStore:o,onInviteClick:n,onInviteComplete:a,inviteOrigin:l,intl:d}=e,{currentSpaceStore:u}=f.default.state;if((0,b.$)(t)&&(null==o?void 0:o.state.selection)===S.uq.workspace_member&&u){if(!(await T.HD({environment:t,flowId:r.state.flowId||"",trackCreateTeamComplete:!1})))return;Z({permissionsInviteStore:r,contextualInviteStore:o}),await(0,g.j_)({environment:t,spaceStore:u,contextualInviteStore:o,from:"share_menu",intl:d})}else Z({permissionsInviteStore:r,contextualInviteStore:o});let m=!1;try{m=await I({environment:t,store:s,sudoModeStore:i,permissionsInviteStore:r,contextualInviteStore:o,onInviteStart:()=>{null==n||n()},inviteOrigin:l})}catch(c){}finally{null==a||a(m)}},F=async e=>{const{environment:t,permissionsInviteStore:s,from:i}=e;await h.Aw({environment:t,permissionsInviteStoreState:s.state,from:i})||s.reset()},R=e=>{const{permissionsInviteStore:t,targetToRemove:s,defaultRoleForNonBot:i}=e;if(!t.state.isInviteTargetsEmpty)if((0,y.ow)(t.state))if((0,y.ow)(t.state)){const e=t.state.inviteTargets.filter((e=>e!==s));0===e.length?t.setState({...t.state,inviteTargets:[],inviteRole:i,isInviteTargetsEmpty:!0}):t.setState({...t.state,inviteTargets:e})}else(0,m.t1)(t.state);else{const e=t.state.inviteTargets.filter((e=>e!==s));0===e.length?t.setState({...t.state,inviteTargets:[],inviteRole:i,isInviteTargetsEmpty:!0}):t.setState({...t.state,inviteTargets:e})}},_=e=>{const{environment:t,onUpgradeButtonClick:s,upgradeButtonName:i}=e;k.y(t,{from:i,for:u.$M}),null==s||s()};async function G(e,t){const s=new Set(t),i=Array.from(s).map((async t=>{const s=await w.findUser(e,{email:t});if("success"===s.type){const e=s.data;if(e.value){return{type:"existingUser",value:e.value.value}}}return{type:"newUser",value:{email:t},source:"email"}}));return await Promise.all(i)}const x=async e=>{const t="invitee",{environment:s,permissionsInviteStore:i,event:r}=e;if(!i.state.isInviteTargetsEmpty&&(0,y.ow)(i.state)){const e=r.target.value;i.setState({...i.state,inputFocus:t,tokenQuery:e})}else{const e=r.target.value,{extractedEmails:n,newInputValue:a}=(0,o.zI)(e),l=(await G(s,n)).filter((e=>!h.Nd({target:e,permissionsInviteStore:i}))),d=[...i.state.inviteTargets,...l];d.length>0?i.setState({...i.state,inviteTargets:d,isInviteTargetsEmpty:!1,inputFocus:t,tokenQuery:a}):i.setState({...i.state,inviteTargets:[],isInviteTargetsEmpty:!0,inputFocus:t,tokenQuery:a})}},q=e=>{const{environment:t,newRole:s,permissionsInviteStore:i}=e,{state:r}=i;M.trackInviteChangeRole(t,{...h.a_(t,r),invite_updated_role:s}),!r.isInviteTargetsEmpty&&(0,y.ow)(r)||i.setState({...r,inviteRole:s})},B=async e=>{const{query:t,environment:s,sectionLimit:i,intl:o,membersOnly:n}=e,{currentSpaceStore:l}=f.default.state;if(!l)return{inviteUsers:[],inviteBots:[],inviteGroups:[]};const{userLimit:d,botLimit:u,groupLimit:m,importContactLimit:c}=i,[g,h,v,{user:b,email:S},y]=await Promise.all([d>0?p.Yu({environment:s,query:t,membersOnly:n}):[],u>0?p.RF({environment:s,query:t}):[],m>0?p.$w({query:t,intl:o}):[],p.yy(s,t),c>0?Promise.race([w.searchContacts(s,{spaceId:l.id,limit:c,query:t}),(0,a.Xb)(1500,void 0)]):void 0]),M=g.slice(0,d).map((e=>({type:"existingUser",value:e}))),T=h.slice(0,u).map((e=>({type:"bot",value:e}))),k=v.slice(0,m).map((e=>({type:"group",value:e})));b&&M.unshift({type:"existingUser",value:b}),S&&M.unshift({type:"newUser",value:{email:S},source:"email"});let I=[];return y&&"success"===y.type&&(I=y.data.contacts.map((e=>({type:"newUser",value:{email:e.email,name:e.name,avatar_url:e.profile_photo},source:e.type})))),{inviteUsers:r().uniqBy(M,(e=>e.value.email)),inviteBots:T,inviteGroups:k,importedContacts:I}}},21752:(e,t,s)=>{s.d(t,{K:()=>g,Z:()=>h});var i=s(77094),r=s.n(i),o=(s(67294),s(81954)),n=s(97880),a=s(5366),l=s(3815),d=s(86125),u=s(88198),m=s(70301),c=s(64369),p=s(45653);function g(e){return"membership_admin"===e?"membership_admin":"editor"===e||"admin"===e?"admin":"none"===e||"guest"===e?"guest":"team_level_guest"===e?"team_level_guest":void("member"!==e&&"read_and_write"!==e&&"no_access"!==e&&"not_in_space"!==e&&e&&(0,n.t1)(e))}const h=function(e){window.__c={n:"CellMemberAvatar"};const t=(0,a.useIntl)(),{actorStore:s,avatar:i,containerStyle:n,id:g,spaceRole:h,avatarBadge:v,isLarge:b}=e,f="admin"===h||"membership_admin"===h,S="guest"===h||"team_level_guest"===h,y=(0,o.VK)((()=>s?s.getDisplayName(t):null==i?void 0:i.name),[s,i,t]),M=(0,o.VK)((()=>s?s.getDetail():null==i?void 0:i.email),[s,i]),w=(0,o.VK)((()=>s&&s instanceof l.Qx?null==s?void 0:s.getModel():void 0),[s]);return r()("div",{style:{display:"flex",alignItems:"center",maxWidth:b?"unset":300,marginLeft:b?2:0,...n}},void 0,r()("div",{style:{position:"relative",...!b&&{height:28,width:28}}},void 0,s instanceof l.Qx?r()(m.Z,{botModel:w,size:b?32:28}):r()(p.Z,!s&&i?{avatar:i,size:b?32:28}:{userStore:s,size:b?32:28}),v),r()("div",{style:{minWidth:0,marginLeft:b?10:6,marginRight:b?10:6}},void 0,r()("div",{id:g,style:{display:"flex",gap:4}},void 0,r()(c.Z,{className:"notranslate"},void 0,y),f&&r()(d.Z,{role:h}),S&&r()(u.b,{labelType:h})),r()(c.Z,{isSmall:!0,style:{display:"flex"}},void 0,r()(c.Z,{isSmall:!0},void 0,M))))}},85215:(e,t,s)=>{s.d(t,{l:()=>h});var i=s(97464),r=s.n(i),o=s(77094),n=s.n(o),a=s(67294),l=s(81954),d=s(5366),u=s(16639),m=s(79315),c=s(52275),p=s(12793),g=s(31278);function h(e){window.__c={n:"GroupMenuItem"};const{group:t,menuListItemProps:s}=e,i=(0,l.VK)((()=>{const e=m.default.state.currentSpaceStore;if(e&&t.icon)return{pointer:{table:e.table,id:e.id},icon:t.icon}}),[t]),o=(0,d.useIntl)(),h=(0,u.kF)({intl:o,group:t});return a.createElement(c.Z,r()({},s,{icon:i?n()(g.Z,{disabled:!0,size:22,icon:i,isEmptyPage:!1,title:h}):n()(p.Z,{size:22}),title:h}))}},64131:(e,t,s)=>{s.d(t,{Z:()=>B});var i=s(77094),r=s.n(i),o=s(97464),n=s.n(o),a=s(67294),l=s(480),d=s(81954),u=s(24405),m=s(8848),c=s(3779),p=s(70203),g=s(82990),h=s(5366),v=s(50906),b=s(98724),f=s(60709),S=s(98742),y=s(89086),M=s(52689),w=s(63334),T=s(24666),k=s(41216),I=s(64921),C=s(31945),Z=s(56940),P=s(58261),F=s(78140),R=s(9342),_=s(40721),G=s(72495),x=s(58032);const q=a.Fragment;const B=function(e){window.__c={n:"HighlightSelectionButton"};const{disabled:t,style:s}=e,i=(0,d.qz)(e.ignoreSelectionAreaStore,w.Z),o=(0,l.O7)(),B=(0,h.useIntl)(),A=(0,u.Fg)(),U=(0,a.useCallback)((()=>{b.aS({environment:o,annotation:["h",M.Z.state.color]}),v.trackRichTextMenuClick(o,{action:"h",color:M.Z.state.color})}),[o]),E=(0,a.useCallback)((e=>{v.trackRichTextMenuClick(o,{action:"h"})}),[o]),L=(0,a.useCallback)((()=>{T.default.emit()}),[]),D=(0,a.useCallback)((e=>{b.mX({environment:o,annotationType:"h"}),"default"!==e&&(M.Z.setHighlightColor(e),U())}),[o,U]),O=(0,a.useCallback)(((e,t,s,i)=>({key:t||e,action:()=>{s(),D(e),i.close()},render:s=>a.createElement(k.Z,n()({},s,{color:e,overrideDisplayName:t}))})),[D]),V=(0,d.VK)((()=>{const e=(0,y.Ld)("h");return e?p.zI(e):"default"}),[]),K=(0,u.yK)((e=>({colorIcon:{display:"inline-flex",alignItems:"center",justifyContent:"center",height:18,textAlign:"center",fontSize:15,borderRadius:2,...!o.device.isMobile&&{width:18,fontWeight:g.Z.fontWeight.medium,marginBottom:2},...(0,m.A_)(V,e)}})),[o.device.isMobile,V]);return r()(C.Z,{popupType:o.device.isMobile?C.Z.PopupType.SlideUp:C.Z.PopupType.Popup,originGap:4,onClose:L,onClick:E,renderOrigin:e=>r()(x.Z,{renderTooltip:()=>r()(q,{},void 0,r()("div",{},void 0,r()(h.FormattedMessage,{defaultMessage:"Text color",id:"highlightSelectionButton.textColor.tooltip"})),r()("div",{},void 0,r()(P.Z,{style:{color:A.mediumInvertedTextColor},name:"toggleHighlight"}))),render:i=>a.createElement(I.Z,n()({style:{display:"flex",alignItems:"center",paddingLeft:7,paddingRight:6,whiteSpace:"nowrap",...s},disabled:t,disabledFeedback:t},(0,S.Z)(e,i)),r()("div",{style:K.colorIcon},void 0,o.device.isMobile?r()(h.FormattedMessage,{defaultMessage:"Color",id:"highlightSelectionButton.mobileColorIcon.label"}):"A"),c.Z.chevronDown({width:10,marginLeft:o.device.isMobile?4:3,fill:"dark"===A.mode?m.ZP.white:A.lightIconColor}))}),render:e=>{let t;return t=o.device.isMobile?{menuType:f.og.Modal,title:r()(h.FormattedMessage,{defaultMessage:"Text color",id:"highlightSelectionButton.mobileTextColor.label"}),right:r()(_.CancelMenuText,{}),onClickRight:()=>{e.close()}}:{menuType:f.og.Popup},a.createElement(F.Z,t,r()(Z.Z,{capture:o.device.isMobile,store:i,ignoreBlockSelection:!1,restoreSelection:!0,focusOffscreenInput:!1,render:t=>{const s=m.CY.map((s=>O(s,void 0,t,e))),i=[O("default",B.formatMessage({defaultMessage:"Default background",id:"highlightSelectionButton.defaultBackground.label"}),t,e),...m._K.map((s=>O(s,void 0,t,e)))],o=M.Z.state.color;return r()(R.Z,{type:R.i.Vertical,sections:[{key:0,items:[{key:0,action:()=>{t(),D(o),e.close()},render:e=>a.createElement(k.Z,n()({},e,{color:o,shortcuts:["toggleHighlight"]}))}],render:e=>a.createElement(G.Z,n()({},e,{title:r()(h.FormattedMessage,{defaultMessage:"Last used",id:"highlightSelectionButton.lastUsedSection.label"}),isTitleUppercase:!0}))},{key:1,items:s,render:e=>a.createElement(G.Z,n()({},e,{title:r()(h.FormattedMessage,{defaultMessage:"Color",id:"highlightSelectionButton.colorSection.label"}),isTitleUppercase:!0}))},{key:2,items:i,render:e=>a.createElement(G.Z,n()({},e,{title:r()(h.FormattedMessage,{defaultMessage:"Background",id:"highlightSelectionButton.backgroundSection.label"}),isTitleUppercase:!0}))}],initialFocus:void 0})}}))}})}},82945:(e,t,s)=>{s.d(t,{Z:()=>S});var i=s(97464),r=s.n(i),o=s(77094),n=s.n(o),a=s(67294),l=s(83355),d=s(3779),u=s(5366),m=s(50906),c=s(7476),p=s(77505),g=s(24666),h=s(64921),v=s(58261),b=s(58032);class f extends l.Z{constructor(){super(...arguments),this.handleClick=e=>{let t;const s=g.default.state;"empty"!==s.mode&&(t=p.UQ(),c.WD({environment:this.environment,blockStore:this.props.blockStore,multiSelection:s.multiSelection})),m.trackRichTextMenuClick(this.environment,{action:"comment",from:t?"simple_table_cell":void 0})}}renderComponent(){const{device:e}=this.environment,t=e.isMobile;return n()(b.Z,{renderTooltip:()=>n()(a.Fragment,{},void 0,n()("div",{},void 0,n()(u.FormattedMessage,{defaultMessage:"Comment on selected text",id:"inlineCommentButton.tooltip"})),n()("div",{},void 0,n()(v.Z,{style:{color:this.theme.mediumInvertedTextColor},name:"comment"}))),render:e=>a.createElement(h.Z,r()({style:{display:"flex",alignItems:"center",padding:"0 10px",whiteSpace:"nowrap",...this.props.style},disabled:this.props.disabled,disabledFeedback:this.props.disabled,onClick:this.handleClick},e),d.Z.speechBubbleThin({width:t?18:16,height:t?18:16,marginTop:t?0:1,marginRight:4}),!t&&n()(u.FormattedMessage,{defaultMessage:"Comment",id:"inlineCommentButton.commentLabel"}))})}}f.displayName="InlineCommentButton";const S=f},24145:(e,t,s)=>{s.d(t,{Z:()=>f});var i=s(97464),r=s.n(i),o=s(77094),n=s.n(o),a=s(67294),l=s(480),d=s(81954),u=s(5366),m=s(75472),c=s(65598),p=s(26781),g=s(25464),h=s(58032),v=s(91487),b=s(47082);const f=function(e){const{origin:t,permissionsInviteStore:s,store:i,handleClickRemoveToken:o,handleInputChange:f,handleInputSubmit:S,defaultRoleForNonBot:y,isTeamsEnabled:M,right:w,focus:T,handleFocus:k}=e,I="share_menu"===t||"add_members"===t,C="add_members"===t,[Z,P]=(0,d.AF)(s),F=(0,l.O7)(),{device:R}=F,_=(0,u.useIntl)(),{tokenQuery:G}=Z,x=(0,p.i)(i),q=Z.inviteTargets.map((e=>{const t="newUser"===e.type?e.value.email:`${e.type}-${e.value.id}`,s=(0,m.OA)(e),i="newUser"===e.type||"existingUser"===e.type?e.value.email:void 0,l=s?x:void 0,d={key:t,target:e,onClickRemove:o,role:Z.inviteRole,shouldWrap:I,showInfoIcon:Boolean(l)};return I&&i?n()(h.Z,{placement:g.u.Top,disableTooltip:C,renderTooltip:()=>s?l||n()(u.FormattedMessage,{defaultMessage:"{email} will be invited as a guest",id:"ContextualInvite.permissions_invites.guest.tooltip",description:"Tooltip for inviting a guest",values:{email:i}}):i,render:s=>a.createElement("span",r()({},s,{key:t}),a.createElement(v.Z,r()({},d,{backgroundColor:(0,m.gQ)(e)})))}):a.createElement(v.Z,d)}));return a.createElement(b.Z,r()({focus:R.isMobile?void 0:T,focusInitial:R.isMobile,focusAfterAnimation:!0,onClick:()=>{R.isMobile||null==k||k()},format:b.Z.Format.Share,value:G,onChange:f,type:"email",tokens:q,disabled:!1,autoComplete:"off",placeholder:I?M?_.formatMessage({defaultMessage:"Add people, groups, or emails…",id:"ContexualInvites.inviteUserModal.searchInput.placeholderWithTeams",description:"Placeholder text for the search input in the invite user modal"}):_.formatMessage({defaultMessage:"Add emails or people",id:"ContexualInvites.inviteUserModal.searchInput.placeholderWithoutBots",description:"Placeholder text for the search input in the invite user modal"}):(0,c.Mm)(i)?_.formatMessage({id:"inviteUserModal.searchInput.placeholder",defaultMessage:"Search name or emails"}):_.formatMessage({id:"permissionsInvite.searchInput.placeholder",defaultMessage:"Search emails, names, or groups"}),onRemoveLastToken:()=>{const e={...Z};e.inviteTargets=e.inviteTargets.slice(0,-1),0===e.inviteTargets.length&&(e.isInviteTargetsEmpty=!0,e.inviteRole=y),P(Z)},right:w,inputAndTokenWrapRightStyle:{paddingTop:F.device.isMobile?0:Z.isInviteTargetsEmpty?5:6,paddingBottom:F.device.isMobile||I?0:4},onEmptySubmit:()=>S(),dontShowBorderBottom:R.isAndroid,showBorder:I},I&&{style:{borderRadius:3,paddingTop:Z.isInviteTargetsEmpty?3:0,paddingBottom:0,...T&&{background:"none"}}}))}},43579:(e,t,s)=>{s.d(t,{Z:()=>A});var i=s(97464),r=s.n(i),o=s(77094),n=s.n(o),a=s(67294),l=s(480),d=s(81954),u=s(24405),m=s(66897),c=s(33728),p=s(3779),g=s(5366),h=s(82990),v=s(7928),b=s(50906),f=s(95209),S=s(4708),y=s(75472),M=s(65598),w=s(21115),T=s(29677),k=s(78291),I=s(52275),C=s(9342),Z=s(43765),P=s(77137),F=s(72495),R=s(58032),_=s(85215),G=s(69507),x=s(97680);const q=(0,g.defineMessages)({invited_page:{id:"PermissionsInviteSearchRequest.userTooltip.invited_page",defaultMessage:"{userNameAndEmail} is invited to this page already",description:"A label that shows the user is invited to the page already"},invited_space:{id:"PermissionsInviteSearchRequest.userTooltip.invited_space",defaultMessage:"{userNameAndEmail} is invited to this workspace already",description:"A label that shows the user is invited to the workspace already"},invited_team:{id:"PermissionsInviteSearchRequest.userTooltip.invited_team",defaultMessage:"{userNameAndEmail} is invited to this team already",description:"A label that shows the user is invited to the team already"},not_in_space:{id:"PermissionsInviteSearchRequest.userTooltip.admin",defaultMessage:"Click to invite {userNameAndEmail}",description:"A tooltip explains that the user has not been invited, therefore they have no access to the workspace"}});function B(e,t){return e.filter(((e,s)=>s<t))}const A=function(e){window.__c={n:"PermissionsInviteSearchRequest"};const{store:t,shouldShowBots:s,shouldShowGroups:i,sectionRenderLimit:o,membersOnly:A,hideUserTypeToken:U,disableInvitedUsers:E}=e,[L,D,O]=(0,d.AF)(e.permissionsInviteStore),V=(0,l.O7)(),{device:K}=V,N=(0,g.useIntl)(),{tokenQuery:W}=L,z=(0,a.useMemo)((()=>y.ZK({environment:{device:K}})),[K]),H=(0,u.yK)((e=>({roleBadge:{...z},invitedBadge:{...z,backgroundColor:e.defaultBadgeBackground}})),[z]),Q=(0,d.VK)((()=>(0,S._6)(V)?"invitee-popup-closed":"invitee"),[V]),j={request:W,performRequest:e=>f.jL({query:e,sectionLimit:{userLimit:10,botLimit:s?10:0,groupLimit:i?10:0,importContactLimit:0},membersOnly:A,environment:V,intl:N}),render:(e,s,l)=>{if(e)return n()(G.l,{loading:!l},void 0,n()(Z.Z,{title:n()(g.FormattedMessage,{id:"inviteUserModal.searchInput.errorMessage",defaultMessage:"Something went wrong"})}));const d=s&&{...s,importedContacts:(0,y.Bu)(s.inviteUsers,s.importedContacts)},u=d&&(null==W?void 0:W.length)>0,{inviteUsers:f,inviteGroups:S,importedContacts:P=[]}=u?d:(0,y.NN)({currentInviteActors:d,permissionsInviteStore:O,targetStore:t}),A=[...B(f,o),...B(P,10)].map(((e,s)=>{const i="newUser"===e.type?e.value.email:e.value.id,o=function(e){if("existingUser"!==e.type)return;const{data:t}=k.default.state,s=(t?w.CM(t):[]).find((t=>t.userId===e.value.id));return s?s.role:"not_in_space"}(e),l=Boolean(u&&(0,y.cm)({permissionsInviteStore:O,userTarget:e,targetStore:t}));return{key:i,render:s=>{const{tooltip:i,userTypeToken:d}=function(e){const{userTarget:t,targetStore:s,isInvited:i,userSpaceRole:r,styles:o,intl:a}=e,l="newUser"!==t.type&&t.value.name?`${t.value.name} (${t.value.email})`:t.value.email,d=r&&"not_in_space"!==r;if(i)return{tooltip:(0,M.Mm)(s)?a.formatMessage(q.invited_space,{userNameAndEmail:l}):(0,M.NZ)(s)?a.formatMessage(q.invited_page,{userNameAndEmail:l}):a.formatMessage(q.invited_team,{userNameAndEmail:l}),userTypeToken:n()("div",{style:{...o.invitedBadge}},void 0,n()(g.FormattedMessage,{id:"inviteUserModal.userRole.invitedBadge.label",defaultMessage:"Invited",description:"A label that shows the user is invited already"}))};if(d){const e=y.Ji({role:r,intl:a,nameOrEmail:l});return{tooltip:e.tooltip,userTypeToken:n()("div",{style:{...o.roleBadge}},void 0,e.userRoleBadge)}}return{tooltip:a.formatMessage(q.not_in_space,{userNameAndEmail:l}),userTypeToken:void 0}}({userTarget:e,targetStore:t,userSpaceRole:o,isInvited:l,styles:H,intl:N});return"existingUser"===e.type?a.createElement(x.Z,r()({},s,{actor:(0,m.dp)(e.value),right:U?void 0:d,tooltip:i,tooltipPlacement:R.Z.Placement.Left,disabled:E&&l})):n()(R.Z,{placement:R.Z.Placement.Left,alignment:R.Z.Alignment.Start,textWrap:!0,render:t=>a.createElement(I.Z,r()({},s,t,{icon:p.Z.mailRound({width:24,height:24}),right:d,title:e.value.email.trim(),disabled:E&&l})),disableTooltip:!i,renderTooltip:()=>i})},action:()=>{if(l)return;if(!L.isInviteTargetsEmpty&&(0,T.ow)(L))return;const t={...e,..."existingUser"===e.type&&{spaceRole:o}};b.trackInviteSelectTarget(V,{...y.a_(V,L),invite_token_query:W,selected_user_token:e,selected_user_token_rank:s}),O.setState({...L,inviteTargets:[...L.inviteTargets,t],isInviteTargetsEmpty:!1,tokenQuery:"",inputFocus:Q})}}})),D=B(S,o).map((e=>{const{value:t}=e;return{key:t.id,render:e=>n()(_.l,{group:t,menuListItemProps:e}),action:()=>{!L.isInviteTargetsEmpty&&(0,T.ow)(L)||O.setState({...L,inviteTargets:[...L.inviteTargets,e],isInviteTargetsEmpty:!1,tokenQuery:"",inputFocus:Q})}}})),K=[],z=L.isInviteTargetsEmpty||!(0,T.ow)(L);if(A.length>0&&z&&K.push({key:"user results",render:e=>a.createElement(G.l,r()({},e,{loading:!l})),items:A}),i&&D.length>0&&z&&K.push({key:"group results",render:e=>a.createElement(F.Z,r()({},e,{title:n()(g.FormattedMessage,{id:"inviteUserModal.searchDropdown.selectGroupTitle",defaultMessage:"Select a group"}),loading:!l})),items:D}),0===K.length&&z){const e=(0,c.H3)(L.tokenQuery);if((0,c.oH)(e)){const i={type:"newUser",value:{email:e},source:"email"},r=(0,y.Nd)({target:i,permissionsInviteStore:O});if(!r)return;if(r)return n()(G.l,{loading:!l},void 0,n()(Z.Z,{title:n()(g.FormattedMessage,{id:"inviteUserModal.userAlreadyInvitedMessage",defaultMessage:"Already inviting {user}.",values:{user:n()("span",{style:{fontWeight:h.Z.fontWeight.bold}},void 0,(0,y.DF)({intl:N,target:r}))}})}));const o=(s&&s.inviteUsers||[]).find((t=>"existingUser"===t.type&&t.value.email===e));if(o&&"existingUser"===o.type&&(0,y.Zp)({store:t,target:o}))return n()(G.l,{loading:!l},void 0,n()(Z.Z,{title:n()(g.FormattedMessage,{id:"inviteUserModal.userAlreadyHasPermissionMessage",defaultMessage:"{user} already has permission.",values:{user:n()("span",{style:{fontWeight:h.Z.fontWeight.bold}},void 0,(0,v.Nz)(N,o.value))}})}))}else{if(!L.tokenQuery)return n()(G.l,{loading:!l},void 0,n()(Z.Z,{title:n()(g.FormattedMessage,{id:"inviteUserModal.searchPersonDropdown.noSearchResultsMessage",defaultMessage:"Type or paste in emails above, separated by commas."})}));K.push({key:"user results",render:e=>a.createElement(G.l,r()({},e,{loading:!l,title:n()(g.FormattedMessage,{id:"inviteUserModal.searchDropdown.addPeople",description:"Header in invite menu, asking user to add a people's email.",defaultMessage:"Keep typing to invite email"})})),items:[{key:L.tokenQuery,render:e=>a.createElement(I.Z,r()({icon:p.Z.mailRound({width:24,height:24}),title:L.tokenQuery},e)),action:()=>{}}]})}}return n()(C.Z,{type:C.i.Vertical,initialFocus:W.length>0?0:void 0,sections:K})}};return a.createElement(P.Z,j)}},40464:(e,t,s)=>{s.d(t,{Z:()=>f});var i=s(77094),r=s.n(i),o=s(97464),n=s.n(o),a=s(67294),l=s(480),d=s(81954),u=s(24405),m=s(8848),c=s(50906),p=s(98724),g=s(89086),h=s(24666),v=s(64921),b=s(58032);const f=function(e){window.__c={n:"SelectionAnnotationButton"};const{disabled:t,type:s,tooltipLabel:i,children:o,style:f,onClick:S}=e,y=(0,l.O7)(),M=(0,a.useCallback)((e=>{p.aS({environment:y,annotation:[s]}),S&&S(),c.trackRichTextMenuClick(y,{action:s})}),[y,s,S]),w=(0,d.VK)((()=>t||"editing"!==h.default.state.mode),[t]),T=(0,d.VK)((()=>Boolean((0,g.Ld)(s))),[s]),k=(0,u.yK)((e=>({button:{display:"flex",alignItems:"center",padding:"0 8px",color:T?m.ZP.blue:e.regularTextColor,...f}})),[T,f]);return r()(b.Z,{renderTooltip:()=>i,render:e=>a.createElement(v.Z,n()({style:k.button,disabled:w,disabledFeedback:w,onClick:M},e),o)})}},32404:(e,t,s)=>{s.d(t,{Z:()=>S});var i=s(97464),r=s.n(i),o=s(77094),n=s.n(o),a=s(67294),l=s(83355),d=s(70203),u=s(5366),m=s(36280),c=s(89086),p=s(66949),g=s(24666),h=s(64921),v=s(58261),b=s(58032);class f extends l.Z{constructor(){super(...arguments),this.renderMenuTooltip=()=>{const e=this.getThemeColors();return n()(a.Fragment,{},void 0,n()("div",{},void 0,n()(u.FormattedMessage,{id:"richTextMenu.equationButton.tooltip",defaultMessage:"Create equation"})),n()("div",{},void 0,n()(v.Z,{style:e.keyboardShortcut,name:"openEquationMenu"})))},this.handleButtonPopupClick=e=>{const{onClick:t}=this.props;m.qn({environment:this.environment,analyticsFrom:"rich_text_menu"}),t&&t(e)},this.isSelected=()=>(0,c.Ld)(d.GK.Equation),this.isDisabled=()=>{const{disabled:e}=this.props;if(e)return!0;if("editing"!==g.default.state.mode&&!p.Z.isOpen())return!0;const t={[d.GK.User]:d.GK.User,[d.GK.Page]:d.GK.Page,[d.GK.Comment]:d.GK.Comment,[d.GK.Bot]:d.GK.Bot,[d.GK.Date]:d.GK.Date,[d.GK.ExternalObjectInstance]:d.GK.ExternalObjectInstance,[d.GK.TemporaryPage]:d.GK.TemporaryPage,[d.GK.TemplateVariable]:d.GK.TemplateVariable,[d.GK.FormulaPageProperty]:d.GK.FormulaPageProperty,[d.GK.FormulaUserProperty]:d.GK.FormulaUserProperty,[d.GK.FormulaContextValue]:d.GK.FormulaContextValue,[d.GK.Group]:d.GK.Group};for(const s of Object.values(t))if((0,c.J6)(s))return!0;return!1},this.styles={equationButton:{display:"flex",alignItems:"center",borderRadius:0,paddingLeft:7,paddingRight:8}}}renderComponent(){const{style:e,children:t}=this.props,s=this.getThemeColors(),i=this.isDisabled();return n()(b.Z,{renderTooltip:this.renderMenuTooltip,render:o=>a.createElement(h.Z,r()({style:{...this.styles.equationButton,...s.equationButton,...e},disabled:i,disabledFeedback:i,onClick:this.handleButtonPopupClick},o),t)})}getThemeColors(){return{equationButton:{color:this.isSelected()?this.theme.blueColor:this.theme.regularTextColor},keyboardShortcut:{color:this.theme.mediumInvertedTextColor}}}}f.displayName="SelectionEquationButton";const S=(0,u.injectIntl)(f)},73383:(e,t,s)=>{s.d(t,{Z:()=>y});var i=s(97464),r=s.n(i),o=s(77094),n=s.n(o),a=s(67294),l=s(83355),d=s(70203),u=s(5366),m=s(50906),c=s(45990),p=s(89086),g=s(23178),h=s(24666),v=s(64921),b=s(58261),f=s(58032);class S extends l.Z{constructor(){super(...arguments),this.handleButtonPopupClick=()=>{c.dz({type:"focusOnly",focus:!0}),m.trackRichTextMenuClick(this.environment,{action:d.GK.Link})}}renderComponent(){const e=(0,p.Ld)(d.GK.Link),t=this.isDisabled();return n()(f.Z,{renderTooltip:()=>n()(a.Fragment,{},void 0,n()("div",{},void 0,n()(u.FormattedMessage,{defaultMessage:"Add link",id:"selectionLinkButton.addLink.tooltip",description:"Prompt for the user to add a URL to link to from the selected text."})),n()("div",{},void 0,n()(b.Z,{style:{color:this.theme.mediumInvertedTextColor},name:"openLinkMenu"}))),render:s=>a.createElement(v.Z,r()({style:{display:"flex",alignItems:"center",borderRadius:0,paddingLeft:7,paddingRight:8,...e&&{color:this.theme.blueColor},whiteSpace:"nowrap",...this.props.style},disabled:t,disabledFeedback:t},s,{onClick:this.handleButtonPopupClick}),this.props.children)})}isDisabled(){return!!this.props.disabled||("editing"!==h.default.state.mode&&!g.Z.state.open||!!((0,p.J6)(d.GK.User)||(0,p.J6)(d.GK.Bot)||(0,p.J6)(d.GK.Date)||(0,p.J6)(d.GK.Page)))}}S.displayName="SelectionLinkButton";const y=(0,u.injectIntl)(S)},19091:(e,t,s)=>{s.d(t,{Z:()=>ds});var i=s(97464),r=s.n(i),o=s(77094),n=s.n(o),a=s(96486),l=s.n(a),d=s(67294),u=s(83355),m=s(8848),c=s(31942),p=s(3779),g=s(27006),h=s(90468),v=s(19889),b=s(2438),f=s(47425),S=s(97880),y=s(82990),M=s(7928),w=s(5366),T=s(48298),k=s(50906),I=s(54642),C=s(43132),Z=s(47307),P=s(92625),F=s(10279),R=s(29974),_=s(15010),G=s(64964),x=s(21325),q=s(30149);const B=(0,w.defineMessages)({removingGuest:{id:"convertGuestToMember.removeGuest.updatingMessage",defaultMessage:"Updating…",description:"The message shown while waiting to remvoe a guest"},convertingGuest:{id:"convertGuestToMember.convertingGuest.updatingMessage",defaultMessage:"Updating…",description:"The message shown while waiting to converting a guest to a member"}});async function A(e){const{environment:t,store:s,role:i,guestUserStore:r}=e,o=r.id,a=r.getEmail();try{P.j({message:B.convertingGuest});const e=[{type:"user_permission",role:i,user_id:o}],{serverCommitResult:r}=q.createAndCommit({userAction:"spacePerimssionGuestActions.convertGuestToMember",environment:t,perform:i=>{F.ep({environment:t,store:s,permissionItems:e,transaction:i,from:"convert_to_member"})}});await r,k.trackConvertGuestToMember(t,{member_user_id:o}),k.trackEmailInvite(t,{role:i,is_space:!0,invite_targets:[{type:"existingUser",value:{id:o,version:0,email:""},spaceRole:"none"}],is_onboarding:!1,invite_origin:"convert_to_member",permission_items:e,invite_message_length:0,domainType:(0,_.JF)()})}catch(l){G.oV({label:n()(w.FormattedMessage,{id:"spacePermissionsSettings.externalTab.userThreeDotMenu.convertToMember.snackbar.failure",defaultMessage:"Failed to convert {email} to workspace member",description:"Snackbar message shown after failing to convert a page guest or teamspace guest into a workspace member.",values:{email:a}})})}finally{await x.bi(t),P.x()}}async function U(e){const{environment:t,store:s,guestUserStore:i}=e,r=i.id,o=i.getEmail();try{P.j({message:B.removingGuest});if("success"!==(await I.removeUsersFromSpace(t,{userIds:[r],spaceId:s.id,removePagePermissions:!0,revokeUserTokens:!1})).type)throw new Error("Failed to remove guest");k.trackRemoveGuest(t)}catch(a){G.oV({label:n()(w.FormattedMessage,{id:"spacePermissionsSettings.externalTab.userThreeDotMenu.removeFromWorkspace.snackbar.failure",defaultMessage:"Failed to remove {email} from workspace",description:"Snackbar message shown after failing to remove a page guest or teamspace guest.",values:{email:o}})})}finally{await x.bi(t),P.x()}}var E=s(4708),L=s(60709),D=s(67669),O=s(33665),V=s(38755),K=s(21115),N=s(8323),W=s(23537),z=s(77907),H=s(79315),Q=s(88632),j=s(3815),J=s(72087),Y=s(64404),$=s(92083),X=s(78291),ee=s(98905),te=s(12318),se=s(21752),ie=s(42922),re=s(64921),oe=s(52275),ne=s(31945),ae=s(61519),le=s(73063),de=s(74194),ue=s(68785),me=s(78140),ce=s(9342),pe=s(63296),ge=s(77137),he=s(72495),ve=s(62385),be=s(24006),fe=s(58032),Se=s(64369),ye=s(24405),Me=s(16639),we=s(31278),Te=s(53695);function ke(e){let{spaceStore:t,groups:s,onGroupClick:i}=e;window.__c={n:"GroupsDowndownForMember"};const o=(0,w.useIntl)(),a=s.length,l=(0,ye.yK)((e=>({title:{marginRight:8,color:0===a?e.lightTextColor:void 0},defaultGroupIconPill:{height:14,width:14,color:e.mediumTextColor,fill:"currentColor"},untitled:{color:e.lightTextColor}})),[a]),u=s.map((e=>({key:e.id,render:s=>{var i;const a=Me.kF({intl:o,group:e});return d.createElement(oe.Z,r()({icon:n()(we.Z,{disabled:!0,icon:e.icon&&t?{pointer:t.pointer,icon:e.icon}:void 0,size:18,isEmptyPage:!1,title:a,defaultIcon:p.Z.typesPerson(l.defaultGroupIconPill)}),title:n()(Se.Z,{style:e.name?void 0:l.untitled},void 0,a),caption:n()(w.FormattedMessage,{defaultMessage:"{numMembers} {numMembers, plural, one {member} other {members}}",id:"groupsDropdownForMember.numMembers",description:"Number of members in a permission group, displayed in a popup showing the permission groups that this member is part of.",values:{numMembers:(null===(i=e.user_ids)||void 0===i?void 0:i.length)||0}}),inline:!0},s))},action:i})));return n()(Te.N,{title:n()(Se.Z,{style:l.title},void 0,n()(w.FormattedMessage,0===a?{id:"groupsDropdownForMember.groupsCountNone.label",defaultMessage:"None",description:"Message to show a member is not part of any groups."}:{id:"groupsDropdownForMember.groupsCount.label",defaultMessage:"{numberOfGroups, plural, one {{numberOfGroups} group} other {{numberOfGroups} groups}}",description:"Number of groups that a member is part of.",values:{numberOfGroups:a}})),items:u,disabled:0===a})}var Ie=s(21202),Ce=s(5978),Ze=s(84210),Pe=s(61766),Fe=s(28992),Re=s(43765),_e=s(89728),Ge=s(11470);class xe extends u.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:Pe.Z},this.renderPopup=()=>{const{device:e}=this.environment,{store:t,guest:s,hideActionButtons:i}=this.props,o=t.canEditMembership(),a=s.guestPageIds.map((e=>{const s=j.G.createChildStore(t,{table:Ie.iU,id:e});return{key:e,render:e=>d.createElement(Ge.Z,r()({},e,{store:s,placeholder:n()(w.FormattedMessage,{id:"guestPagesPopup.privatePagePlaceholder",defaultMessage:"Private page"})})),action:()=>{const s=j.G.createChildStore(t,{table:Ie.iU,id:e}),i=(0,Ze.ZP)({store:s,fullyQualified:!1});Ce.navigate({environment:this.environment,url:i,openInNew:"tab"})}}}));let l,u;l=e.isMobile?{menuType:L.og.ActionSheet}:{menuType:L.og.Popup,width:300},(0,K.qF)(this.environment)&&(u=n()(fe.Z,{renderTooltip:()=>this.isSubscribed()?n()(w.FormattedMessage,{id:"guestPagesPopup.addMemberPermissionButton.tooltip",defaultMessage:"This guest will become a member of this workspace."}):n()(w.FormattedMessage,{id:"guestPagesPopup.addAdminPermissionButton.tooltip",defaultMessage:"This guest will become an admin of this workspace."}),render:e=>d.createElement(pe.Z,r()({isLarge:!0,onClick:this.handleConvertToMemberClick},e),this.isSubscribed()?n()(w.FormattedMessage,{id:"guestPagesPopup.addMemberPermissionButton.label",defaultMessage:"Convert to member"}):n()(w.FormattedMessage,{id:"guestPagesPopup.addAdminPermissionButton.label",defaultMessage:"Convert to admin"}))}));const m=!i&&o;return d.createElement(me.Z,l,m&&n()(Fe.Z,{title:n()("div",{style:{paddingTop:12,paddingBottom:8,display:"flex",alignItems:"flex-start"}},void 0,u,n()(fe.Z,{renderTooltip:()=>n()(w.FormattedMessage,{id:"guestPagesPopup.removeGuestButton.tooltip",defaultMessage:"This guest will be removed from all pages in this Workspace."}),render:e=>d.createElement(pe.Z,r()({isLarge:!0,isRed:!0,style:{marginLeft:u?8:0},onClick:this.handleRemoveClick},e),n()(w.FormattedMessage,{id:"guestPagesPopup.removeGuestButton.label",defaultMessage:"Remove"}))}))}),m&&n()(Re.Z,{title:n()(w.FormattedMessage,{id:"guestPagesPopup.guestAccessiblePagesCaption",defaultMessage:"This guest can access these pages"})}),n()(ce.Z,{type:ce.i.Vertical,initialFocus:0,sections:[{key:"pages",render:e=>d.createElement(he.Z,e),items:a}]}))},this.handleRemoveClick=()=>{Z.showDialog({showCancel:!0,keepFocus:!1,message:n()(w.FormattedMessage,{id:"guestPagesPopup.removeGuestModal.confirmationMessage",defaultMessage:"Are you sure you want to remove this person? They will lose access to all shared pages."}),items:[{label:n()(w.FormattedMessage,{id:"guestPagesPopup.removeGuestModal.removeButton.label",defaultMessage:"Remove"}),color:"red",onAccept:async()=>{const{store:e,guestStore:t}=this.props;this.stores.buttonPopupStore.setState({...this.stores.buttonPopupStore.state,open:!1}),await U({environment:this.environment,guestUserStore:t,store:e})}}]})},this.handleConvertToMemberClick=async()=>{const{store:e,guestStore:t,isSubscribed:s}=this.props,i=s?"read_and_write":"editor";this.stores.buttonPopupStore.setState({...this.stores.buttonPopupStore.state,open:!1}),await A({environment:this.environment,guestUserStore:t,role:i,store:e})}}renderComponent(){const{device:e}=this.environment,{buttonPopupStore:t}=this.stores,{store:s,guest:i}=this.props;return i.guestPageIds.map((e=>{j.G.createChildStore(s,{table:Ie.iU,id:e}).load()})),0===i.guestPageIds.length?n()(_e.Z,{disabled:!0},void 0,n()(w.FormattedMessage,{id:"guestPagesPopup.permissionsForUserGuest.label",defaultMessage:"Guest"})):n()(ne.Z,{popupType:e.isMobile?ne.Z.PopupType.SlideUp:ne.Z.PopupType.Popup,renderOrigin:e=>d.createElement(_e.Z,e,n()(w.FormattedMessage,{id:"guestPagesButton.label",defaultMessage:"{numberOfAccessiblePages, plural, one {{numberOfAccessiblePages} page} other {{numberOfAccessiblePages} pages}}",values:{numberOfAccessiblePages:i.guestPageIds.length}}),p.Z.chevronDown({width:10,marginLeft:4,fill:this.theme.lightIconColor})),buttonPopupStore:t,render:this.renderPopup})}isSubscribed(){const{data:e}=X.default.state;return Boolean(e&&(0,K.YK)(e))}}xe.displayName="GuestPagesPopup";const qe=(0,w.injectIntl)(xe);var Be=s(74523),Ae=s(42402),Ue=s(7567),Ee=s(480),Le=s(81954),De=s(5851),Oe=s(53680),Ve=s(93963),Ke=s(40235),Ne=s(42875),We=s(61784),ze=s(89837),He=s(29302),Qe=s(45653);function je(e){window.__c={n:"SpaceSettingsRequestRow"};const{store:t,request:s}=e,{forActor:i,accessRequestStore:r}=s,o=(0,Ee.O7)(),[a,l]=(0,d.useState)(!1),u=(0,ye.yK)((e=>({actionButtons:{display:"flex",alignItems:"center",gap:12},email:{display:"flex",gap:4},requestMetadata:{minWidth:0,marginLeft:6,marginRight:6},tooltip:{marginBottom:2},tooltipHeader:{color:e.mediumInvertedTextColor,fontSize:10,textTransform:"uppercase",letterSpacing:"0.015em",marginBottom:2},viewReasonsButton:{marginLeft:28,marginTop:2,border:"none"},tooltipUserRow:{display:"flex",justifyContent:"space-between",marginBottom:4},tooltipUserRowEmail:{marginLeft:5}})),[]),m=(0,w.useIntl)(),c=(0,Le.VK)((()=>{var e;const t=[],i=new Set;return null===(e=s.createdByActorsWithReason)||void 0===e||e.forEach((e=>{i.has(e.actor.id)||t.push(e.actor),i.add(e.actor.id)})),t}),[s.createdByActorsWithReason]);if(!s||!s.forActor||!s.createdByActorsWithReason.length)return null;const p=ze.CQ(s.latestRequestTime,(0,Ne.r)()),g=(0,We.ZV)({value:p,date_format:"relative",userTimeZone:(0,Ne.r)(),intl:m,allowRelativeDates:!0}),h={environment:o,store:t,accessRequestStore:r,forActor:i},v=c.filter((e=>e.email!==s.forActor.email)),b=v.length!==c.length,f=()=>1===c.length?n()(w.FormattedMessage,b?{defaultMessage:"Guest self request",id:"spaceSettingsRequests.requestRowAction.requestedBySingularGuestSelfRequest",description:"Describes that a request came from a guest self request."}:{defaultMessage:"From {actorName}",id:"spaceSettingsRequests.requestRowAction.requestedBySingular",description:"Describes the user that a request came from",values:{actorName:c[0].name}}):n()(w.FormattedMessage,b?{defaultMessage:"{numberOfOtherActors, plural, one {Guest self request and from {secondActorName}} other {Guest self request and from {numberOfOtherActors} more}}",id:"spaceSettingsRequests.requestRowAction.requestedByPluralIncludingGuestSelfRequest",description:"Describes the guest self request and the multiple users that a request came from",values:{secondActorName:v[0].name,numberOfOtherActors:v.length}}:{defaultMessage:"{numberOfOtherActors, plural, one {From {firstActorName} and {secondActorName}} other {From {firstActorName} and {numberOfOtherActors} more}}",id:"spaceSettingsRequests.requestRowAction.requestedByPlural",description:"Describes multiple users that a request came from",values:{firstActorName:c[0].name,secondActorName:c[1].name,numberOfOtherActors:c.length-1}});return n()("div",{style:{width:"100%"}},void 0,n()("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},void 0,n()("div",{},void 0,n()("div",{style:{display:"flex",alignItems:"center"}},void 0,n()(Qe.Z,{userValue:s.forActor,size:28,borderStyle:"dashed"}),n()("div",{style:u.requestMetadata},void 0,n()("div",{style:u.email},void 0,n()(Se.Z,{className:"notranslate"},void 0,s.forActor.email)),n()(Se.Z,{isSmall:!0},void 0,n()(fe.Z,{renderTooltip:()=>n()("div",{style:u.tooltip},void 0,n()(Se.Z,{style:u.tooltipHeader},void 0,n()(w.FormattedMessage,{defaultMessage:"Requested by",id:"spaceSettingsRequests.requestRowAction.requestedByMoreThanTwo.tooltip",description:"Describes multiple user emails that a request came from"})),c.map((e=>n()("div",{style:u.tooltipUserRow},e.id,n()(He.Z,{avatarSize:18,userValue:e}),n()("div",{style:u.tooltipUserRowEmail},void 0,e.email))))),render:e=>d.createElement("span",e,n()(f,{}))})," · ",g)))),n()("div",{style:u.actionButtons},void 0,n()(_e.Z,{isGray:!0,onClick:async()=>{await T.kn({...h,status:"rejected",from:"requests_center"})}},void 0,n()(w.FormattedMessage,{defaultMessage:"Decline",id:"spaceSettingsRequests.requestRowAction.declineButton.label",description:"Label for button that allows user to reject a pending membership request"})),n()(pe.Z,{isBlue:!0,onClick:async()=>{await T.kn({...h,status:"approved",from:"requests_center"})}},void 0,n()(w.FormattedMessage,{defaultMessage:"Approve",id:"spaceSettingsRequests.requestRowAction.acceptButton.label",description:"Label for button that allows user to approve a pending membership request"})))),s.createdByActorsWithReason.some((e=>{let{reason:t}=e;return Boolean(t)}))&&n()(pe.Z,{isSmall:!0,isBlue:!0,style:u.viewReasonsButton,onClick:()=>l(!a)},void 0,n()(w.FormattedMessage,a?{id:"spaceSettingsRequests.requestRowAction.closeReasonsButton.label",defaultMessage:"Close reasons",description:"Button to collapse reasons in view for a membership request."}:{id:"spaceSettingsRequests.requestRowAction.viewReasonsButton.label",defaultMessage:"View reasons",description:"Button to expand reasons for a membership request."})),a&&n()("div",{style:{marginLeft:34,marginTop:2,fontSize:y.Z.fontSize.UIRegular.desktop}},void 0,s.createdByActorsWithReason.filter((e=>{let{reason:t}=e;return Boolean(t)})).map(((e,t)=>n()("div",{},t,e.actor.name," · ",e.reason)))))}function Je(e){const{spaceStore:t,accessRequestRenderValues:s,lastOpenedRequestCenterTime:i}=e,r=(0,Le.VK)((()=>s.filter((e=>"pending"===e.accessRequestStore.getKeyStore("status").getValue())).sort(((e,t)=>t.latestRequestTime-e.latestRequestTime))),[s]),o=(0,ye.yK)((e=>({requestColumn:{width:"100%"},zeroStateContainer:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",padding:40,color:e.mediumTextColor,borderStyle:"solid",borderColor:e.regularDividerColor,borderWidth:1,borderRadius:3},mailIcon:{height:12,width:17,color:e.mediumIconColor,marginRight:6}})),[]),a={key:"request",header:void 0,style:o.requestColumn};return 0===r.length?n()("div",{style:o.zeroStateContainer},void 0,p.Z.mailRound(o.mailIcon),n()(w.FormattedMessage,{id:"spaceSettingsRequests.emptyRequests.message",defaultMessage:"No invite requests yet",description:"Message in requests inbox telling user there are no requests yet."})):n()(Ke.Z,{hideHeader:!0,columns:[a],rows:r.map(((e,s)=>({key:`request${s.toString()}`,columns:[n()("div",{style:{display:"flex",alignItems:"center"}},e.accessRequest.id,i<e.accessRequest.created_time&&n()("div",{style:{marginLeft:-18,marginRight:10}},void 0,n()(Ve.z,{size:8})),n()(je,{store:t,request:e}))]})))})}function Ye(e){const{spaceStore:t,accessRequestsStore:s}=e,i=(0,Ee.O7)(),[r,o]=(0,d.useState)(Date.now()),[,,a]=(0,Le.AF)(void 0,Oe.Z),l=(0,Le.VK)((()=>a.getValueForSpace(t)),[t,a]),u=Boolean(null==l?void 0:l.disableMembershipRequests),m=Boolean(null==l?void 0:l.disableGuestMembershipRequests),c=(0,Le.VK)((()=>t.getKeyStore("settings").getKeyStore("seen_guest_membership_requests").getValue()&&(0,E.Ye)(i)),[i,t]),[p,,]=(0,Le.AF)(s),g=(0,ye.yK)((e=>({errorContainer:{display:"flex",justifyContent:"center",alignItems:"center",padding:40,color:e.mediumTextColor}})),[]);(0,d.useEffect)((()=>{const{currentSpaceViewStore:e}=H.default.state;if(!e)return;const t=e.getKeyStore("settings").getKeyStore("last_opened_request_center").getValue();t&&o(t),q.createAndCommit({userAction:"SpaceSettingsRequests.updateLastOpened",environment:i,perform:t=>{q.applyOperation({store:e,operation:{pointer:e.pointer,path:["settings","last_opened_request_center"],command:"set",args:Date.now()},transaction:t})}})}),[]);return h=p.error,v=p.result,p.ready?h||!v?n()("div",{style:g.errorContainer},void 0,n()(w.FormattedMessage,{defaultMessage:"Something went wrong.",id:"notificationUpdates.unknownErrorMessage"})):d.createElement(d.Fragment,null,n()($e,{spaceStore:t,securitySettingsStoreState:l,disabled:u}),c&&n()(Xe,{spaceStore:t,securitySettingsStoreState:l,disabled:m}),n()(Je,{spaceStore:t,accessRequestRenderValues:v,lastOpenedRequestCenterTime:r})):n()("div",{style:g.errorContainer},void 0,n()(ue.Z,{}));var h,v}function $e(e){window.__c={n:"AllowMembershipRequestsToggle"};const t=(0,Ee.O7)(),{spaceStore:s,securitySettingsStoreState:i,disabled:r}=e,o=(0,ye.yK)((()=>({toggleContainer:{display:"flex",alignItems:"center",cursor:"pointer",marginBottom:14},titleDescription:{fontSize:14,marginRight:8,flexGrow:1},description:{marginTop:2,width:"80%"}})),[]);return n()("div",{style:o.toggleContainer,onClick:function(){i&&De.n(t,{securitySettingsState:{...i,disableMembershipRequests:!i.disableMembershipRequests},spaceStore:s})}},void 0,n()("div",{style:o.titleDescription},void 0,n()(w.FormattedMessage,{id:"spaceSettingsRequests.allowMembersToRequestMembers.title",description:"Title for a setting that, when on, will allow workspace members to request users to become workspace members.",defaultMessage:"Allow members to request adding other members"}),n()(Se.Z,{isSmall:!0,isMultiline:!0,style:o.description},void 0,n()(w.FormattedMessage,{id:"spaceSettingsRequests.allowMembersToRequestMembers.description",description:"Description for a setting that, when on, will allow workspace members to request users to become workspace members.",defaultMessage:"Members can submit requests to admins to add more members"}))),n()(be.Z,{on:!r}))}function Xe(e){window.__c={n:"AllowGuestMembershipRequestsToggle"};const t=(0,Ee.O7)(),{spaceStore:s,securitySettingsStoreState:i,disabled:r}=e,o=(0,ye.yK)((()=>({toggleContainer:{display:"flex",alignItems:"center",cursor:"pointer",marginBottom:14},titleDescription:{fontSize:14,marginRight:8,flexGrow:1},description:{marginTop:2,width:"80%"}})),[]);return n()("div",{style:o.toggleContainer,onClick:function(){i&&De.n(t,{securitySettingsState:{...i,disableGuestMembershipRequests:!i.disableGuestMembershipRequests},spaceStore:s})}},void 0,n()("div",{style:o.titleDescription},void 0,n()(w.FormattedMessage,{id:"spaceSettingsRequests.allowGuestsToSelfRequest.title",description:"Title label for workspace toggle that enables guest self-request membership feature.",defaultMessage:"Allow page guests to request to be added as members to the workspace"}),n()(Se.Z,{isSmall:!0,isMultiline:!0,style:o.description},void 0,n()(w.FormattedMessage,{id:"spaceSettingsRequests.allowGuestsToSelfRequest.description",description:"Description of label for workspace toggle that enables guest self-request membership feature.",defaultMessage:"Guests of the workspace can submit requests to admins to be added as members"}))),n()(be.Z,{on:!r}))}var et=s(95209),tt=s(79817),st=s(75472),it=s(52878),rt=s(1743),ot=s(9019),nt=s(44532),at=s(24145),lt=s(43579);const dt=(0,w.defineMessages)({reason_placeholder:{id:"RequestMembersModal.reason.placeholder",defaultMessage:"Add a reason (optional)",description:"The message that's used in an input placeholder asking the inviter to provide a reason why the invitee should be added."}});const ut=function(e){window.__c={n:"RequestMembersModal"};const t=(0,Ee.O7)(),{store:s,origin:i,analyticsFrom:o}=e,[a,l]=(0,d.useState)(!1),[u,c]=(0,d.useState)("none"),p=(0,Le.qz)(void 0,it.Z),g=(0,w.useIntl)(),h=(0,ye.yK)((()=>({modalStyle:{alignSelf:"center",overflow:"visible",top:0,width:420},container:{padding:20},title:{fontWeight:y.Z.fontWeight.medium,marginBottom:10},reasonTitle:{color:m.ZP.mediumTextColor,marginTop:10,marginBottom:5},footer:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:15},requestInvitesButton:{marginLeft:20}})),[]),v=e=>{e.currentTarget===e.target&&c("none")},b=async()=>{k.trackClickMembershipRequest(t,{...tt.Oh(t,p.state.contextualInviteStore),from:o}),et.eH({permissionsInviteStore:p.state.permissionsInviteStore,contextualInviteStore:p.state.contextualInviteStore}),p.state.contextualInviteStore.startRequestMembership("control");const e=p.state.contextualInviteStore.state.invitedUsers;l(!1);const i=await tt.fC({environment:t,spaceStore:s,originId:void 0,originType:o,reasonMessage:p.state.permissionsInviteStore.state.emailMessage,contextualInviteStore:p.state.contextualInviteStore,intl:g});f({success:i,intl:g,users:e}),p.reset()},f=e=>{const{success:t,intl:s,users:i}=e;0!==i.length&&(t?G.oV({label:s.formatMessage({id:"requestMembersModal.requestSuccess.toast",defaultMessage:"Successfully requested membership for {users} to your workspace admins.",description:"Client side message shown when the membership request succeeds on the server side."},{users:tt.uJ(i,s)})}):G.oV({label:s.formatMessage({id:"requestMembersModal.requestFail.toast",defaultMessage:"Failed to invite {users} to the workspace.",description:"Client side message shown when the membership request fails on the server side."},{users:tt.uJ(i,s)})}))};return n()(ot.Z,{modalStyle:h.modalStyle,open:a,onDismiss:async()=>{await(0,st.Aw)({environment:t,permissionsInviteStoreState:p.state.permissionsInviteStore.state,from:"space_settings_add_members"})||(l(!1),p.reset()),c("none")},renderContent:()=>n()("div",{style:h.container,onClick:v},void 0,n()("div",{style:h.title,onClick:v},void 0,n()(w.FormattedMessage,{id:"requestMembersModal.title",defaultMessage:"Request to invite members",description:"Title for form where you are prompted to input emails to request to be members."})),n()(nt.ZP,{popupType:nt.kQ.Popup,alignmentToOrigin:nt.ZP.Alignment.Start,placementToOrigin:nt.ZP.Placement.Bottom,open:"invites"===u,sameWidthAsOrigin:!0,originGap:10,disableMouseCapture:!0,origin:n()(at.Z,{permissionsInviteStore:p.state.permissionsInviteStore,store:s,handleClickRemoveToken:e=>{et.PV({targetToRemove:e,permissionsInviteStore:p.state.permissionsInviteStore,defaultRoleForNonBot:"read_and_write"})},handleInputChange:async e=>{c("invites"),await et.jC({environment:t,event:e,permissionsInviteStore:p.state.permissionsInviteStore})},handleInputSubmit:async()=>{},origin:"add_members",defaultRoleForNonBot:"read_and_write",isTeamsEnabled:!1,right:n()("div",{}),focus:"invites"===u,handleFocus:()=>c("invites")}),onDismiss:()=>c("none"),render:()=>{const e=n()(lt.Z,{permissionsInviteStore:p.state.permissionsInviteStore,store:s,defaultRoleForSpaceBot:"editor",shouldShowBots:!1,shouldShowGroups:!1,sectionRenderLimit:10,membersOnly:!1}),t={menuType:L.og.Popup,disableScroller:!1};return n()("div",{},void 0,d.createElement(me.Z,r()({},t,{width:380}),e))},style:{width:"100%"}}),n()("div",{style:h.reasonTitle,onClick:v},void 0,n()(w.FormattedMessage,{id:"requestMembersModal.reasonForRequest.title",defaultMessage:"Reason for request",description:"Title for the reason section of the form."})),n()(rt.Z,{capture:!0,allowEsc:!0},void 0,n()(de.Z,{textarea:!0,style:{padding:8},value:p.state.permissionsInviteStore.state.emailMessage,focus:"reason"===u,onFocus:()=>c("reason"),onChange:e=>{p.state.permissionsInviteStore.setState({...p.state.permissionsInviteStore.state,emailMessage:e.target.value})},placeholder:g.formatMessage(dt.reason_placeholder)})),n()("div",{style:h.footer,onClick:v},void 0,n()(Se.Z,{isSecondaryColor:!0,isSmall:!0,isMultiline:!0},void 0,n()(w.FormattedMessage,{id:"RequestMembersModal.caption",defaultMessage:"Your admins will approve or decline your request.",description:"Caption explaining the user will get notified once the invite they requested is resolved."})),n()(ie.Z,{isLarge:!0,style:h.requestInvitesButton,onClick:b},void 0,n()(w.FormattedMessage,{id:"requestMembersModal.requestInvitesButton.label",defaultMessage:"Request invites",description:"Button to request admin to send invites to the users selected."})))),origin:n()("div",{onClick:()=>{k.trackClickInvitePeople(t,{...tt.Oh(t,p.state.contextualInviteStore)}),l(!0)}},void 0,i)})};var mt=s(83890),ct=s(98707),pt=s(27386),gt=s(23189),ht=s(40394),vt=s(57688),bt=s(33929),ft=s(33846),St=s(31194),yt=s(48690),Mt=s(30397),wt=s(48019),Tt=s(68894),kt=s(93686);const It=(0,w.defineMessages)({filterTeams:{defaultMessage:"Filter teamspaces…",id:"teamsDropdownForGroupMenu.filterForTeams.placeholder",description:"Placeholder text for filtering teamspaces within a group."}});function Ct(e){window.__c={n:"TeamsPopup"};const t=(0,Ee.O7)(),s=(0,ye.yK)((()=>({teamMenuItem:{fontWeight:400}})),[]),[i,o]=(0,Le.AF)(void 0,ft.Z),a=(0,d.useCallback)((e=>vt.RF({environment:t,teamId:e,tab:yt.a.Members,from:"teams_dropdown_for_group"})),[t]),l=(0,Le.VK)((()=>[{key:"teams for group",render:e=>d.createElement(he.Z,e),actions:e.teamStores.map((e=>({key:e.id,displayName:e.getName(),analyticsName:e.getName()||"team_unknown",searchName:e.getName(),render:t=>d.createElement(oe.Z,r()({icon:n()(kt.p,{disabled:!0,store:e}),title:n()(Se.Z,{style:s.teamMenuItem},void 0,e.getName()),right:n()(w.FormattedMessage,{defaultMessage:"{numMembers} {numMembers, plural, one {member} other {members}}",id:"teamsInGroupMenu.filterForTeams.numMembers",description:"Number of members in a teamspace, displayed in a popup showing teamspaces connected to a group.",values:{numMembers:e.getUserIdsInTeam().length}})},t)),action:()=>{a(e.id)},closeParentMenu:!0})))}]),[s,e.teamStores,a]),u=i.inputValue,m=n()(wt.Z,{filter:u,context:{blocks:[],environment:t,publicEditMode:void 0},sections:l,initialFocus:0}),c=n()(he.Z,{isInput:!0},void 0,n()(Tt.ZP,{value:u,onChange:(0,d.useCallback)((e=>{o({inputValue:e.target.value,focus:!1})}),[o]),focus:!0,focusAfterAnimation:!0,placeholder:bt.default.formatMessage(It.filterTeams)})),p={menuType:L.og.Popup,width:280,maxHeight:"50vh",header:e.teamStores.length>5?c:void 0};return d.createElement(me.Z,p,m)}const Zt=function(e){window.__c={n:"TeamsDropdownForGroup"};const t=(0,Le.qz)(void 0,Pe.Z),[s]=(0,Le.AF)(Mt.Z),i=(0,ye.yK)((e=>({button:{marginRight:8},noTeams:{marginRight:8,color:e.lightTextColor},chevron:{width:10,marginLeft:4,fill:e.lightIconColor}})),[]),o=(0,Le.VK)((()=>s.teams.filter((t=>t.getMembers().some((t=>"group"===t.entity_type&&t.group_id===e.group.id))))),[s,e.group]);return n()(ne.Z,{popupType:ne.Z.PopupType.Popup,renderOrigin:e=>d.createElement(_e.Z,r()({disabled:0===o.length,style:0===o.length?i.noTeams:i.button},e),0===o.length?n()(w.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.userGroup.teamsCountNone",defaultMessage:"None",description:"Button for displaying that this group is not part of any teamspaces."}):n()(w.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.userGroup.teamsCount",defaultMessage:"{numberOfTeams, plural, one {{numberOfTeams} teamspace} other {{numberOfTeams} teamspaces}}",description:"Button for displaying how many teamspaces this group is a part of.",values:{numberOfTeams:o.length}}),o.length>0&&p.Z.chevronDown(i.chevron)),buttonPopupStore:t,placementToOrigin:St.Iw.Bottom,render:e=>n()(Ct,{parent:e,teamStores:o}),onClose:(0,d.useCallback)((()=>{t.reset()}),[t])})};var Pt=s(19522),Ft=s(93405);function Rt(e){window.__c={n:"GroupActionMenu"};const{group:t,spaceStore:s,settingsStore:i}=e,o=(0,Le.qz)(void 0,Pe.Z);return n()(ne.Z,{popupType:nt.kQ.Popup,render:()=>n()(_t,{group:t,spaceStore:s,popupStore:o,settingsStore:i}),buttonPopupStore:o,renderOrigin:e=>d.createElement(le.Z,r()({icon:p.Z.dots},e))})}function _t(e){window.__c={n:"ActionMenu"};const{group:t,spaceStore:s,popupStore:i,settingsStore:o}=e,a=(0,W.Gc)(),u=(0,Le.VK)((()=>s.canAdmin()),[s]),m=(0,Ee.O7)(),c=(0,ye.yK)((e=>({deleteButton:{color:e.redBadgeBackground}})),[]),p=(0,d.useCallback)((async()=>{i.setState({open:!1});await Z.confirmUserAction({message:n()(w.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.deleteGroupModal.confirmationMessage",defaultMessage:"Are you sure you want to delete this group? Any pages that are private to this group will be transferred to you."}),acceptLabel:n()(w.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.deleteGroupModal.confirmationButton.label",defaultMessage:"Yes"})})&&(await q.createAndCommitAsync({environment:m,userAction:"SpacePermissionGroup.handleDelete",waitForServerCommit:!1,perform:async e=>{await R.Xv({environment:m,spaceStore:s,group:t,transaction:e})}}),k.trackPermissionGroupDelete(m))}),[t,m,s,i]),g=(0,d.useCallback)((()=>{o.setState({...o.state,editingNameGroupId:t.id,groupNameInputValue:t.name||""}),i.setState({open:!1}),k.trackPermissionGroupRename(m)}),[t,m,i,o]),h=(0,d.useCallback)((()=>{Pt.Z.setState({...Pt.Z.state,name:t.name||"",defaultInviteTargets:[{type:"group",value:t}]}),vt.lo("group_settings")}),[t]),v={key:"action_menu",render:e=>d.createElement(he.Z,e),items:l().compact([{key:"rename",render:e=>d.createElement(Ft.Z,r()({},e,{title:n()(w.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.groupList.actionMenu.renameItem",defaultMessage:"Rename"})})),action:g},a?{key:"create_team_from_group",render:e=>d.createElement(Ft.Z,r()({},e,{title:n()(w.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.groupList.actionMenu.createTeamFromGroup",defaultMessage:"Create teamspace from group",description:"Button text shown when you click on the three-dot menu of a group in group settings. Clicking on it allows you to create a teamspace using the group's information."})})),action:h}:void 0,u&&{key:"delete",render:e=>d.createElement(Ft.Z,r()({},e,{title:n()("div",{style:c.deleteButton},void 0,n()(w.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.groupList.actionMenu.deleteItem",defaultMessage:"Delete"}))})),action:p}])};return n()(me.Z,{menuType:L.og.Popup},void 0,n()(ce.Z,{type:ce.i.Vertical,initialFocus:0,sections:[v],onAccept:()=>{i.setState({open:!1})}}))}var Gt=s(49085);class xt extends Gt.Z{getInitialState(){return{userInputValue:"",temporaryUserIds:[],limitUsers:!0}}}const qt=xt;var Bt=s(86125),At=s(66897),Ut=s(33728),Et=s(31299),Lt=s(92864),Dt=s(47082),Ot=s(97680);function Vt(e){window.__c={n:"GroupAddMembersButton"};const{group:t,spaceStore:s,groupStore:i}=e,o=(0,Le.qz)(void 0,Pe.Z),a=(0,ye.yK)((()=>({popup:{width:400},button:{marginTop:4}})),[]);return n()(ne.Z,{popupType:nt.kQ.Popup,render:()=>n()(Kt,{spaceStore:s,group:t,popupStore:o,groupStore:i}),buttonPopupStore:o,onClose:()=>i.setState({userInputValue:"",temporaryUserIds:[],limitUsers:!0}),style:a.popup,renderOrigin:e=>n()("div",{},void 0,d.createElement(_e.Z,r()({isGray:!0,icon:p.Z.plus,style:a.button},e),n()(w.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.groupList.addMemberButton.label",defaultMessage:"Add members"})))})}function Kt(e){window.__c={n:"AddMemberMenu"};const t=(0,Ee.O7)(),s=(0,w.useIntl)(),{group:i,spaceStore:r,popupStore:o,groupStore:a}=e,u=(0,Le.VK)((()=>a.state.temporaryUserIds.map((e=>{const t=r.getRecordValue({table:v.KJ,id:e});return n()(Lt.vw,{userValue:t,format:Lt.vw.Format.Medium,showRemoveButton:!0,onClickRemove:()=>{const t=a.state.temporaryUserIds.filter((t=>t!==e));a.setState({...a.state,temporaryUserIds:t})},shouldShrink:!0,isSingle:!1},e)}))),[r,a]),m=(0,Le.VK)((()=>()=>{const{temporaryUserIds:e}=a.state,s=i.user_ids||[],n=l().union(s,e),d={...i,user_ids:n,last_edited_time:Date.now()};q.createAndCommit({userAction:"SpacePermissionGroup.handleAddDoneClick",environment:t,perform:e=>{R.jF({spaceStore:r,group:d,transaction:e})}}),a.setState({userInputValue:"",temporaryUserIds:[],limitUsers:!0}),o.setState({open:!1}),k.trackPermissionGroupAddMembers(t,{add_member_count:e.length})}),[i,t,a,o,r]),c=(0,d.useCallback)((()=>{const{temporaryUserIds:e}=a.state,t=e.slice(0,e.length-1);a.setState({...a.state,temporaryUserIds:t})}),[a]),p=(0,d.useCallback)((e=>{const t=e.target.value,{extractedEmails:s,newInputValue:i}=(0,Ut.zI)(t),{currentSpaceStore:r}=H.default.state,{data:o}=X.default.state;if(!o||!r)return;const n=(0,K.CM)(o).map((e=>e.userId)),d=l().compact(n.map((e=>j.U6.createChildStore(r,{table:v.KJ,id:e}).getValue()))).filter((e=>s.includes(e.email)&&!a.state.temporaryUserIds.includes(e.id)));a.setState({...a.state,temporaryUserIds:[...a.state.temporaryUserIds,...d.map((e=>e.id))],userInputValue:i})}),[a]),g=(0,Le.VK)((()=>a.state.userInputValue),[a]),h=(0,Le.VK)((()=>a.state.temporaryUserIds),[a]);return n()(me.Z,{menuType:L.og.Popup,tokenInputHeader:!0,header:n()(Dt.Z,{focus:!0,disabled:!1,focusAfterAnimation:!0,format:Dt.Z.Format.Group,tokens:u,placeholder:s.formatMessage({id:"spacePermissionsSettings.groupsTab.userGroup.userSearchInput.placeholder",defaultMessage:"Search for a person…"}),onRemoveLastToken:c,value:g,onChange:p,inputAndTokenWrapRightStyle:{paddingTop:t.device.isMobile?0:6,paddingBottom:t.device.isMobile?0:6},right:n()(ie.Z,{isLarge:!0,onClick:m},void 0,n()(w.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.userGroup.addUserButton.label",defaultMessage:"Add"}))})},void 0,n()(ge.Z,{request:{query:g,temporaryUserIds:h},performRequest:async s=>{let{query:i,temporaryUserIds:r}=s;const o=e.group.user_ids||[];return(await Et.Yu({environment:t,query:i,membersOnly:!0})).filter((e=>o.indexOf(e.id)<0&&r.indexOf(e.id)<0)).slice(0,20)},render:(e,t)=>n()(Nt,{results:t,spaceStore:r,groupStore:a})}))}function Nt(e){const{spaceStore:t,groupStore:s}=e,[i,o]=(0,Le.AF)(s,qt),a=(e.results||[]).map((e=>{let{id:t}=e;return t})),l=(0,Le.VK)((()=>a.map((e=>{const s=j.U6.createChildStore(t,{table:v.KJ,id:e}).getValue();return{key:e,render:e=>d.createElement(Ot.Z,r()({},e,{actor:(0,At.m3)(s),useEmailAsTooltip:!0})),action:()=>{const t=[...i.temporaryUserIds,e];o({...i,temporaryUserIds:t,userInputValue:""})}}}))),[t,o,i,a]);if(0===a.length)return n()(he.Z,{},void 0,n()(Re.Z,{title:n()(w.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.userGroup.searchUserDropdown.noResultsMessage",defaultMessage:"No results"})}));{const e={key:"user_menu",render:e=>d.createElement(he.Z,e),items:l};return n()(ce.Z,{type:ce.i.Vertical,initialFocus:0,sections:[e]})}}function Wt(e){window.__c={n:"GroupMembers"};const{group:t,canEdit:s,spaceStore:i,settingsStore:o}=e,a=(0,Le.qz)(void 0,qt),{groupMembers:l,remainingMembers:u}=(0,Le.VK)((()=>{const{countRemainingUsers:e,totalNumberMembers:s,limitedUserValues:r}=(0,Me.rm)({group:t,spaceStore:i,limit:a.state.limitUsers&&!o.state.groupsFilter?10:void 0});return{groupMembers:(0,Me.N5)({userValues:r,spaceValue:{permissions:i.getPermissionItems()}}),remainingMembers:e,totalMembers:s}}),[t,i,o,a]);return n()("div",{style:{padding:"4px 42px 8px"}},void 0,l.map((t=>d.createElement(zt,r()({key:t.id,userValue:t},e)))),u>0&&n()(_e.Z,{isGray:!0,style:{marginTop:4},onClick:()=>{a.setState({...a.state,limitUsers:!1})}},void 0,n()(w.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.showMoreUsersButton.label",defaultMessage:"{numberOfHiddenUsers, plural, one {Show {numberOfHiddenUsers} more} other {Show {numberOfHiddenUsers} more}}",values:{numberOfHiddenUsers:u}})),s?n()(Vt,{group:t,spaceStore:i,groupStore:a}):l.length<1&&n()(_e.Z,{disabled:!0,isGray:!0},void 0,n()(w.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.groupList.noMembersInside",defaultMessage:"No members inside",description:"A label saying that there are no members inside this group."})))}function zt(e){window.__c={n:"GroupMember"};const{spaceStore:t,userValue:s,group:i,canEdit:r}=e,o=(0,Ee.O7)(),a=(0,Le.VK)((()=>t.isDefined()?(0,D.su)({permissions:t.getPermissionItems()},s.id):"none"),[t,s]);return n()("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},s.id,n()("div",{style:{display:"flex"}},void 0,n()(He.Z,{userValue:s,style:{fontSize:14,fontWeight:400,lineHeight:"17px",paddingRight:6,minHeight:34,width:"100%"},avatarSize:22}),(0,g.Bc)(a)&&n()(Bt.Z,{role:"membership_admin"===a?"membership_admin":"admin"})),r&&n()(_e.Z,{isGray:!0,hoveredStyle:{color:m.ZP.red},onClick:async()=>{if(await Z.confirmUserAction({message:n()(w.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.removeMemberFromGroupDialog.confirmationMessage",defaultMessage:"Are you sure you want to remove this member?"}),acceptLabel:n()(w.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.removeMemberFromGroupDialog.confirmationButton.label",defaultMessage:"Yes"})})){const e=(i.user_ids||[]).filter((e=>e!==s.id)),r={...i,user_ids:e,last_edited_time:Date.now()};q.createAndCommit({userAction:"SpacePermissionGroup.renderUser",environment:o,perform:e=>{R.jF({spaceStore:t,group:r,transaction:e})}}),k.trackPermissionGroupRemoveMember(o)}}},void 0,n()(w.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.removeMemberFromGroupButton.label",defaultMessage:"Remove"})))}var Ht=s(13991),Qt=s(22808),jt=s(49312),Jt=s(12793),Yt=s(3386),$t=s(5210);function Xt(e){window.__c={n:"GroupNameToggle"};const{row:t,canEdit:s,open:i,toggleOpenState:o,spaceStore:a,settingsStore:l}=e,u=t.group,m=(0,w.useIntl)(),c=(0,ye.Fg)(),g=(0,Ee.O7)(),h=Me.kF({intl:m,group:u}),v=(0,ye.yK)((e=>({container:{display:"flex",justifyContent:"flex-start",alignItems:"center",width:"100%"},toggle:{flexShrink:0,marginRight:2},chevron:{width:12,height:12,transition:"transform 200ms ease-out",transform:`rotateZ(${i?0:-90}deg)`,fill:"inherit",opacity:.5,marginRight:4},name:{fontFamily:y.Z.getCompositeFontFamily(Ht.SP).sans,fontSize:14,lineHeight:"17px",marginRight:4},input:{fontWeight:y.Z.fontWeight.medium,padding:"4px 6px",background:e.contentBackgroundTransparent},icon:{marginRight:9}})),[i]),b=(0,d.useCallback)((e=>{const t={...u,icon:e,last_edited_time:Date.now()};q.createAndCommit({userAction:"SpacePermissionGroup.handleIconChange",environment:g,perform:e=>{R.jF({spaceStore:a,group:t,transaction:e})}}),k.trackPermissionGroupSetIcon(g,{is_emoji:(0,Qt.Z)(e)})}),[u,a,g]),f=(0,d.useCallback)((()=>{l.setState({...l.state,editingNameGroupId:void 0,groupNameInputValue:""})}),[l]),S=(0,d.useCallback)((e=>{l.setState({...l.state,groupNameInputValue:e.target.value})}),[l]),M=(0,d.useCallback)((()=>{const{editingNameGroupId:e,groupNameInputValue:t}=l.state,s=t.trim();if(e===u.id){if(s!==u.name){const e={...u,name:s,last_edited_time:Date.now()};q.createAndCommit({userAction:"SpacePermissionGroup.handleNameAccept",environment:g,perform:t=>{R.jF({spaceStore:a,group:e,transaction:t})}})}l.setState({...l.state,editingNameGroupId:void 0,groupNameInputValue:""})}}),[u,g,a,l]),T=(0,Le.VK)((()=>l.state.editingNameGroupId===u.id),[u,l]),I=(0,Le.VK)((()=>l.state.groupNameInputValue),[l]);function C(e){const t={width:e-4,height:e-4,fill:c.mediumIconColor},s={width:12,height:12,fill:c.mediumIconColor};return n()("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center"}},void 0,p.Z.random(t),p.Z.plusThick(s))}return n()("div",{style:v.container},void 0,n()($t.Z,{isSidebar:!1,fill:!0,icon:"chevron",open:i,color:c.mediumIconColor,onClick:()=>o(u.id),style:v.toggle}),n()(Jt.Z,{size:28,style:v.icon}),T?n()(Yt.Z,{capture:!0,onEsc:f},void 0,n()(de.Z,{disabled:!s,type:jt.Z.Type.Inline,style:v.input,placeholder:m.formatMessage({id:"spacePermissionsSettings.groupsTab.userGroup.groupNameInput.placeholder",defaultMessage:"Untitled"}),focus:!0,value:I,onChange:S,onBlur:M,onSubmit:M})):n()(Se.Z,{style:v.name,showTooltipWhenTruncated:!0},void 0,h),(Z=t.isRowHovered,u.icon?n()(we.Z,s?{disabled:!1,bucket:"public",icon:u.icon?{pointer:a.pointer,icon:u.icon}:void 0,size:18,isEmptyPage:!1,title:h,onChange:b,style:v.icon}:{disabled:!0,bucket:"public",icon:u.icon?{pointer:a.pointer,icon:u.icon}:void 0,size:18,isEmptyPage:!1,title:h,style:v.icon}):Z&&s?n()(fe.Z,{renderTooltip:()=>n()(w.FormattedMessage,{defaultMessage:"Add icon",id:"spacePermissionsSettings.groupsTab.userGroup.groupIcon.tooltip",description:"Tooltip explaining that user can add an icon for a group"}),render:e=>d.createElement(we.Z,r()({disabled:!1,bucket:"public",icon:u.icon?{pointer:a.pointer,icon:u.icon}:void 0,size:18,isEmptyPage:!1,title:h,onChange:b,style:{...v.icon,width:30},defaultIcon:C(18)},e))}):void 0));var Z}function es(e){let{groups:t,canEdit:s,spaceStore:i,permissionsSettingsStore:r}=e;window.__c={n:"SpaceGroupsTable"};const[o,a]=(0,d.useState)([]),l=(0,ye.Fg)(),u=(0,W.Gc)(),m=(0,Le.VK)((()=>(0,c.ZP)(r.state.groupsFilter,t,(e=>e.name||""))),[r,t]),p=(0,d.useCallback)((e=>{a((t=>t.includes(e)?t.filter((t=>t!==e)):t.concat(e)))}),[a]),g=(0,d.useMemo)((()=>function(e){return e.map((e=>({id:e.id,group:e,isClickable:!1})))}(m)),[m]),h=(0,d.useMemo)((()=>function(e){let{openRowIds:t,toggleOpenRowId:s,canEdit:i,spaceStore:r,settingsStore:o,isTeamEnabled:a}=e;const l={id:"title",headerTitle:n()(w.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.spaceGroupsTable.groups",defaultMessage:"Group",description:"Title of the groups column of the groups table."}),renderCell:e=>n()(Xt,{row:e,open:t.includes(e.id),toggleOpenState:s,canEdit:i,spaceStore:r,settingsStore:o}),widthData:{width:120},hasClickableContents:!1,sortable:!1},d={id:"teams",headerTitle:n()("div",{style:{paddingLeft:8}},void 0,n()(w.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.spaceGroupsTable.teams",defaultMessage:"Teamspaces",description:"Title of the teamspaces column of the groups table."})),renderCell:e=>n()("div",{style:y.Z.textOverflowStyle},void 0,n()(Zt,{group:e.group})),widthData:{width:40},hasClickableContents:!1,sortable:!1},u={id:"members",headerTitle:n()(w.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.spaceGroupsTable.member",defaultMessage:"Members",description:"Title of the members column of the groups table."}),renderCell:e=>{var t;return n()("div",{style:y.Z.textOverflowStyle},void 0,n()(w.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.userGroup.memberCount",defaultMessage:"{numberOfGroupMembers, plural, one {{numberOfGroupMembers} member} other {{numberOfGroupMembers} members}}",values:{numberOfGroupMembers:(null===(t=e.group.user_ids)||void 0===t?void 0:t.length)||0}}))},widthData:{width:40},hasClickableContents:!1,sortable:!1},m={id:"menu",headerTitle:null,renderCell:e=>n()(Rt,{group:e.group,spaceStore:r,settingsStore:o}),widthData:{width:20},hasClickableContents:!0,sortable:!1};return[l,...a?[d]:[],u,...i?[m]:[]]}({openRowIds:o,toggleOpenRowId:p,canEdit:s,spaceStore:i,settingsStore:r,isTeamEnabled:u})),[o,p,s,i,r,u]),v=(0,ht.b)({columnRenderInfo:h,theme:l});return n()(ht.D,{showRowBorders:!0,hideHeaderRowPadding:!0,columnRenderInfo:h,rows:g,styles:v,renderNoRowsComponent:()=>n()(Se.Z,{isSmall:!0,style:{marginLeft:5,marginTop:10,marginBottom:20}},void 0,n()(w.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.spaceGroupsTable.noGroupsFound",defaultMessage:"No groups found.",description:"Message displayed on the groups table in space settings when there are no groups matching the user's search query."})),renderRowChild:e=>o.includes(e.id)?n()(Wt,{group:e.group,canEdit:s,spaceStore:i,settingsStore:r}):void 0})}var ts=s(66957);const ss=(0,w.defineMessages)({filterTeams:{defaultMessage:"Filter teamspaces…",id:"teamsDropdownForMember.filterForTeams.placeholder",description:"Placeholder text for filtering teamspaces within a group."}});function is(e){window.__c={n:"TeamGuestPageContent"};const{teamGuest:t}=e,s=(0,Ee.O7)(),i=(0,Le.VK)((()=>H.default.state.currentSpaceStore),[]);if(!i)return null;if(0===t.guestPageIds.length)return null;const o=[{key:"pages",render:e=>d.createElement(he.Z,e),items:t.guestPageIds.map((e=>{const t=j.G.createChildStore(i,{table:Ie.iU,id:e});return{key:e,render:e=>d.createElement(Ge.Z,r()({},e,{store:t,placeholder:n()(w.FormattedMessage,{id:"guestPagesPopup.privatePagePlaceholder",defaultMessage:"Private page"})})),action:()=>{const t=j.G.createChildStore(i,{table:Ie.iU,id:e}),r=(0,Ze.ZP)({store:t,fullyQualified:!1});Ce.navigate({environment:s,url:r,openInNew:"tab"})}}}))}],a={menuType:L.og.Popup,minWidth:300,maxWidth:350,maxHeight:300,header:t.guestPageIds.length>0&&n()(Se.Z,{isSmall:!0,style:{color:m.ZP.regularTextColor,marginLeft:15,marginRight:15,paddingTop:6}},void 0,n()(w.FormattedMessage,{id:"guestpagesforteamguest.header",defaultMessage:"Pages",description:"Title for section of popup of pages the teamspace guest has access to."}))};return d.createElement(me.Z,a,n()(ce.Z,{type:ce.i.Vertical,initialFocus:void 0,sections:o}))}function rs(e){window.__c={n:"TeamGuestTeamContent"};const t=(0,Ee.O7)(),s=(0,Le.qz)(void 0,ft.Z),i=(0,Le.VK)((()=>s.state.inputValue),[s]),o=(0,d.useCallback)((e=>vt.RF({environment:t,teamId:e,tab:yt.a.Members,from:"teams_dropdown_for_team_guest"})),[t]),a=(0,ye.yK)((()=>({teamMenuItem:{fontWeight:400,maxWidth:180}})),[]),l=(0,Le.VK)((()=>[{key:"teams for team guest",render:e=>d.createElement(he.Z,e),actions:e.teamStores.map((e=>({key:e.id,displayName:e.getName(),analyticsName:e.getName()||"team_unknown",searchName:e.getName(),render:t=>d.createElement(oe.Z,r()({icon:n()(kt.p,{disabled:!0,store:e}),title:n()(Se.Z,{style:a.teamMenuItem},void 0,e.getName()),caption:n()(w.FormattedMessage,{defaultMessage:"{numMembers} {numMembers, plural, one {member} other {members}}",id:"teamsDropdownForMember.numMembers",description:"Number of members in a teamspace, displayed in a popup showing teamspaces that a member is part of.",values:{numMembers:e.getUserIdsInTeam().length}}),inline:!0},t)),action:()=>{o(e.id)},closeParentMenu:!1})))}]),[e.teamStores,a.teamMenuItem,o]),u=n()(he.Z,{isInput:!0},void 0,n()(Tt.ZP,{value:i,onChange:(0,d.useCallback)((e=>{s.setState({inputValue:e.target.value,focus:!1})}),[s]),focus:!0,focusAfterAnimation:!0,placeholder:bt.default.formatMessage(ss.filterTeams)})),m={menuType:L.og.Popup,maxWidth:350,maxHeight:300,header:e.teamStores.length>5?u:void 0};return d.createElement(me.Z,m,n()(wt.Z,{filter:i,context:{blocks:[],environment:t,publicEditMode:void 0},initialFocus:0,sections:l}))}const os=function(e){window.__c={n:"TeamsAndPagesDropdownForTeamGuest"};const{teamGuest:t}=e,s=(0,Le.VK)((()=>Mt.Z.state.teams),[]),i=(0,Le.VK)((()=>s.filter((e=>e.getMembers().some((e=>"user"===e.entity_type&&e.user_id===t.userId))))),[s,t]),o=(0,ye.yK)((e=>({button:{marginRight:8},noTeams:{marginRight:8,color:e.lightTextColor},chevron:{width:10,marginLeft:4,fill:e.lightIconColor}})),[]),a=i.length??0;return n()(ne.Z,{popupType:ne.Z.PopupType.Popup,renderOrigin:e=>d.createElement(_e.Z,r()({disabled:0===a,style:0===a?o.noTeams:o.button},e),0===a?n()(w.FormattedMessage,{id:"teamsDropdownForTeamGuest.teamsCountNone.label",defaultMessage:"No access",description:"Message to show a member is not part of any teamspaces."}):d.createElement(d.Fragment,null,n()(w.FormattedMessage,{id:"teamsDropdownForMember.teamsCount.label",defaultMessage:"{numberOfTeams, plural, one {{numberOfTeams} teamspace} other {{numberOfTeams} teamspaces}}",description:"Number of teamspaces that a member is part of.",values:{numberOfTeams:a}}),p.Z.chevronDown(o.chevron))),render:()=>d.createElement(d.Fragment,null,n()(rs,{teamGuest:t,teamStores:i}),n()(ae.Z,{size:"100%"}),n()(is,{teamGuest:t}))})};var ns=s(88775),as=s(69435);class ls extends u.Z{constructor(){super(...arguments),this.storeTypes={spacePermissionsSettingsStore:Y.Z,getRecoverableSpaceUserContentRequestStore:J.Z,accessRequestsStore:J.Z,isPageGuestsOpen:te.default.of(!0),isTeamGuestsOpen:te.default.of(!0)},this.userIdsWithContentBeingReprovisioned=new te.default([]),this.isTeamGuestsEnabled=this.createComputedStore((()=>(0,E.F$)())),this.renderReprovisioningData=(e,t,s)=>t?n()(Ke.Z,{columns:[{key:"user",header:n()(w.FormattedMessage,{id:"spacePermissionsSettings.userTable.userColumn.header",defaultMessage:"User"}),style:{width:"50%"}},{key:"count",header:n()(w.FormattedMessage,{id:"spacePermissionsSettings.userTable.pageCountColumn.header",defaultMessage:"Private pages",description:"Column header for number of private pages each user has"}),style:{width:"25%"}},{key:"action",header:n()(w.FormattedMessage,{id:"spacePermissionsSettings.userTable.actionLevelColumn.header",defaultMessage:"Action"}),style:{width:"25%"}}],rows:this.getSpaceRecoverRows(t.recentSpaceRecoverPages)}):!s&&n()(ue.Z,{}),this.handleUpdateClick=()=>{const e=(0,w.defineMessages)({updatingPermissions:{id:"spacePermissionsSettings.updatePermissionsMessage",defaultMessage:"Updating…"}});P.j({message:e.updatingPermissions})},this.handleUpdateComplete=()=>{P.x()},this.handleTabClick=(e,t)=>{const s=this.getCurrentTabs(t)[e];switch(s){case Y.Q.Members:k.trackPermissionsSettingsTabClick(this.environment,{tab:"members"});break;case Y.Q.Groups:k.trackPermissionsSettingsTabClick(this.environment,{tab:"groups"});break;case Y.Q.Guests:k.trackPermissionsSettingsTabClick(this.environment,{tab:"guests"});break;case Y.Q.Reprovisioning:k.trackPermissionsSettingsTabClick(this.environment,{tab:"reprovisioning"});break;case Y.Q.Requests:k.trackPermissionsSettingsTabClick(this.environment,{tab:"requests"});break;default:(0,S.t1)(s)}this.stores.spacePermissionsSettingsStore.state.currentTab===Y.Q.Requests&&s!==Y.Q.Requests&&ee.Z.reset(),this.navigateToTab(s)},this.navigateToTab=e=>{this.stores.spacePermissionsSettingsStore.setState({...this.stores.spacePermissionsSettingsStore.state,currentTab:e})},this.handleCreateGroupClick=()=>{q.createAndCommit({userAction:"SpacePermissionsSettings.handleCreateGroupClick",environment:this.environment,perform:e=>{const t=R.mo({environment:this.environment,spaceStore:this.props.store,transaction:e});t&&this.stores.spacePermissionsSettingsStore.setState({...this.stores.spacePermissionsSettingsStore.state,editingNameGroupId:t.id,groupNameInputValue:""})}}),k.trackPermissionGroupCreate(this.environment)},this.handleFilterChange=e=>{this.stores.spacePermissionsSettingsStore.setState({...this.stores.spacePermissionsSettingsStore.state,groupsFilter:e.target.value})},this.handleMembersShowMoreClick=()=>{this.stores.spacePermissionsSettingsStore.setState({...this.stores.spacePermissionsSettingsStore.state,limitMembers:!1})},this.handleGuestsShowMoreClick=()=>{this.stores.spacePermissionsSettingsStore.setState({...this.stores.spacePermissionsSettingsStore.state,limitGuests:!1})},this.handleTeamGuestsShowMoreClick=()=>{this.stores.spacePermissionsSettingsStore.setState({...this.stores.spacePermissionsSettingsStore.state,limitTeamGuests:!1})},this.handleInviteLinkClick=()=>{const e=!this.getInviteLinkEnabled();k.trackInviteLinkUpdated(this.environment,{enabled:e}),q.createAndCommit({userAction:"SpacePermissionsSettings.handleInviteLinkClick",environment:this.environment,perform:t=>{R.ys({transaction:t,spaceStore:this.props.store,inviteLinkEnabled:Boolean(e)})}})},this.handleSortClick=(e,t)=>{const s=this.stores.spacePermissionsSettingsStore.state.sorts[e];let i;i=!(!s||s.by!==t)&&s.asc,this.stores.spacePermissionsSettingsStore.update((s=>({...s,sorts:{...s.sorts,[e]:{by:t,asc:!i}}})))},this.handleMemberPermissionRoleChange=async(e,t,s)=>{const{store:i}=this.props,r=this.environment.currentUser.id;if(e.userId!==r||"none"!==t)this.handleUpdateClick(),"none"===t?(await I.removeUsersFromSpace(this.environment,{userIds:[e.userId],spaceId:i.id,removePagePermissions:!0,revokeUserTokens:!0}),await x.bi(this.environment)):q.createAndCommit({userAction:"SpacePermissionsSettings.handleMemberPermissionRoleChange",environment:this.environment,perform:s=>F.ep({environment:this.environment,store:i,permissionItems:[{type:"user_permission",role:t,user_id:e.userId}],transaction:s,from:"space_permission_setting_table"})}),this.handleUpdateComplete();else{await R.bf({environment:this.environment,spaceId:i.id,userSettingsStore:s})&&$.Z.setState({...$.Z.state,open:!1})}},this.handleReprovisionToUserChange=async(e,t)=>{if(!(await Z.confirmUserAction({message:n()("span",{},void 0,n()(w.FormattedMessage,{id:"spacePermissionsSettings.reprovisionPrivatePagesConfirmationDialog.confirmationMessage",defaultMessage:"Are you sure you want to transfer their private pages? This action cannot be undone."})),acceptLabel:n()(w.FormattedMessage,{id:"spacePermissionsSettings.reprovisionPrivatePagesConfirmationDialog.confirmButton.label",defaultMessage:"Transfer private pages"})})))return;this.userIdsWithContentBeingReprovisioned.setState([...this.userIdsWithContentBeingReprovisioned.state,e]);const s=await I.transferSpaceUserContent(this.environment,{spaceId:this.props.store.id,fromUserId:e,toUserId:t});"failed"===s.type&&Z.showError(s),await this.stores.getRecoverableSpaceUserContentRequestStore.refresh(),this.userIdsWithContentBeingReprovisioned.setState(this.userIdsWithContentBeingReprovisioned.state.filter((t=>t!==e)))}}willMount(){this.setInitialSubtabOnMount()}renderComponent(){const{store:e,isMobile:t}=this.props;if(!Q.Z.state.online)return this.renderOfflineMessage();const{data:s}=X.default.state;if(!s)return this.renderLoadingSpinner();const i=K.CM(s);if(!l().every(i.map((t=>j.U6.createChildStore(e,{table:v.KJ,id:t.userId}).isReady()))))return this.renderLoadingSpinner();const r=i.filter(b.CF),o=i.filter(b.du),a=this.isTeamGuestsEnabled.state?o.length:o.filter((e=>!e.isTeamGuest&&e.isPageGuest)).length,{currentTab:u}=this.stores.spacePermissionsSettingsStore.state;if(t)return n()(d.Fragment,{},void 0,this.canEditMembership()&&n()(he.Z,{shouldShowBottomDivider:!0},void 0,this.renderMobileInviteButton(),n()("div",{style:this.mobileMenuItemStyle()},void 0,this.renderInviteLink())),n()(he.Z,{},void 0,this.renderSpaceMembers(r)));const m={[Y.Q.Members]:d.createElement(d.Fragment,null,n()(w.FormattedMessage,{id:"spacePermissionsSettings.membersTab.title",defaultMessage:"Members"}),n()("span",{},void 0," "),n()("span",{style:{color:this.theme.lightTextColor}},void 0,r.length)),[Y.Q.Groups]:n()(w.FormattedMessage,{id:"spaceBasicSettings.groupsTab.title",defaultMessage:"Groups"}),[Y.Q.Guests]:d.createElement(d.Fragment,null,this.isTeamGuestsEnabled.state?n()(w.FormattedMessage,{id:"spacePermissionsSettings.externalTab.title",defaultMessage:"External",description:"External tab in People section of settings title."}):n()(w.FormattedMessage,{id:"spacePermissionsSettings.guestsTab.title",defaultMessage:"Guests",description:"Guests tab in Members section of settings title."}),n()("span",{},void 0," "),n()("span",{style:{color:this.theme.lightTextColor}},void 0,a)),[Y.Q.Reprovisioning]:n()(w.FormattedMessage,{id:"spaceBasicSettings.reprovisioningTab.title",defaultMessage:"Recently left"}),[Y.Q.Requests]:d.createElement(d.Fragment,null,n()(w.FormattedMessage,{id:"spaceBasicSettings.requestsTab.title",defaultMessage:"Requests",description:"Label for a tab that shows a list of requests waiting for approval"}),n()("span",{},void 0," "),n()("span",{style:{color:this.theme.lightTextColor}},void 0,this.renderNumberOfRequests()),this.renderUnreadRequestDot())},c=this.getCurrentTabs(o),p=c.map((e=>m[e]));return n()(pt.Z,{},void 0,this.isTeamGuestsEnabled.state&&n()("div",{style:{display:"flex",flexDirection:"column",gap:8,marginBottom:20}},void 0,n()("div",{style:{display:"flex",alignItems:"center",gap:7}},void 0,n()(Se.Z,{style:{fontWeight:y.Z.fontWeight.medium,fontSize:17}},void 0,n()(w.FormattedMessage,{id:"spaceBasicSettings.people.title",defaultMessage:"People",description:"People tab title."})),n()(Be.Z,{href:(0,O.UY)("guides.members"),analyticsFrom:"members_settings"})),n()(Se.Z,{isSecondaryColor:!0,style:{fontSize:15}},void 0,n()(w.FormattedMessage,{id:"spaceBasicSettings.people.subtitle",defaultMessage:"Manage members, external guests, groups and permissions.",description:"subtitle for section explaining what this section of the settings tab covers."}))),n()(ts.Z,{tabs:p,selectedIndex:c.indexOf(u),onChange:e=>this.handleTabClick(e,o),style:{paddingLeft:0,paddingRight:0,marginTop:-6,marginBottom:14},tabTitleStyle:{fontSize:16}}),this.renderTab(u,r,o))}renderLoadingSpinner(){return n()(ue.Z,{style:{margin:"calc(50% - 1em) auto"}})}renderOfflineMessage(){return n()(pt.Z,{},void 0,n()(Se.Z,{isSmall:!0,style:{textAlign:"center"}},void 0,n()(w.FormattedMessage,{id:"spacePermissionsSettings.offlineMessage",defaultMessage:"Please go online to manage members."})))}renderHelp(){return n()("div",{style:{marginTop:24,marginBottom:24}},void 0,n()(Be.Z,{title:n()(w.FormattedMessage,{id:"spacePermissionsSettings.helpButton.caption",defaultMessage:"Learn about adding members to your workspace"}),href:(0,O.UY)("guides.members"),analyticsFrom:"members_settings"}))}renderTab(e,t,s){return e===Y.Q.Members?n()(d.Fragment,{},void 0,this.renderSpaceMembers(t)):e===Y.Q.Guests?d.createElement(d.Fragment,null,this.isTeamGuestsEnabled.state?this.renderExternalTab(s):this.renderSpaceGuests(s)):e===Y.Q.Groups?this.renderGroupsTab():e===Y.Q.Reprovisioning?this.renderReprovisioning():e===Y.Q.Requests?this.renderRequestsTab():void(0,S.t1)(e)}renderExternalTab(e){const{store:t}=this.props,s=!Boolean(t.getSettingsStore().getKeyStore("disable_team_guests").getValue());return n()("div",{style:{display:"flex",flexDirection:"column",gap:8}},void 0,s&&d.createElement(d.Fragment,null,n()("div",{style:{display:"flex"}},void 0,n()($t.Z,{open:this.stores.isTeamGuestsOpen.state,onClick:()=>this.stores.isTeamGuestsOpen.setState(!this.stores.isTeamGuestsOpen.state),isSidebar:!1,fill:!0,style:{marginLeft:-27}}),n()("div",{style:{marginLeft:3}},void 0,n()("div",{style:{display:"flex",alignItems:"center",height:24}},void 0,n()(Se.Z,{style:{fontSize:15}},void 0,n()(w.FormattedMessage,{id:"spacePermissionSettings.teamGuests.title",defaultMessage:"Teamspace guests",description:"Title for dropdown header for team guests members table."})),n()("span",{},void 0," "),n()(Se.Z,{isSecondaryColor:!0,style:{fontSize:15}},void 0,e.filter((e=>e.isTeamGuest)).length)),n()(Se.Z,{isSecondaryColor:!0,style:{fontSize:15}},void 0,n()(w.FormattedMessage,{id:"spacePermissionSettings.teamGuests.subtitle",defaultMessage:"Teamspace guests are billed as members and can access all pages in teamspaces they've been invited to.",description:"Subtitle for dropdown header for teamspace guests table explaining what page guests are."})))),this.stores.isTeamGuestsOpen.state&&this.renderTeamGuests(e)),n()("div",{style:{display:"flex"}},void 0,n()($t.Z,{open:this.stores.isPageGuestsOpen.state,onClick:()=>this.stores.isPageGuestsOpen.setState(!this.stores.isPageGuestsOpen.state),isSidebar:!1,fill:!0,style:{marginLeft:-27}}),n()("div",{style:{marginLeft:3}},void 0,n()("div",{style:{display:"flex",alignItems:"center",height:24}},void 0,n()(Se.Z,{style:{fontSize:15}},void 0,n()(w.FormattedMessage,{id:"spacePermissionSettings.pageGuests.title",defaultMessage:"Page guests",description:"Title for dropdown header for page guests members table."})),n()("span",{},void 0," "),n()(Se.Z,{isSecondaryColor:!0,style:{fontSize:15}},void 0,e.filter((e=>e.isPageGuest&&!e.isTeamGuest)).length)),n()(Se.Z,{isSecondaryColor:!0,style:{fontSize:15}},void 0,n()(w.FormattedMessage,{id:"spacePermissionSettings.pageGuests.subtitle",defaultMessage:"Page guests are free but can only access pages they've been invited to.",description:"Subtitle for dropdown header for page guests table explaining what page guests are."})))),this.stores.isPageGuestsOpen.state&&this.renderSpaceGuests(e))}renderUnreadRequestDot(){if(this.props.unreadAccessRequests&&this.props.unreadAccessRequests>0)return n()(Ve.z,{color:this.theme.redBadgeBackground,style:{marginLeft:6}})}renderGroupsTab(){const{store:e}=this.props,{groupsFilter:t}=this.stores.spacePermissionsSettingsStore.state,s=this.canUseGroups(),i=this.canAdmin(),o=n()(w.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.workspaceOwnersOnly",defaultMessage:"Only workspace owners can add a permission group.",description:"Caption that restricts groups creation to workspace owners"});if(e.isDefined()){const a=e.getPermissionGroups();return n()("div",{},void 0,s?n()(Se.Z,{isMultiline:!0,style:{width:"80%"}},void 0,(0,W.bq)()?n()(w.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.captionWithTeamsV2",defaultMessage:"Set up groups to streamline page permissions from the share menu and manage teamspace members in bulk.",description:"Describes the purpose of groups with the context of teamspaces."}):n()(w.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.caption",defaultMessage:"Set up groups to conveniently control page permissions from the share menu.",description:"Describes the purpose of groups."})):n()(as.Z,{for:f.$M,from:"permission_groups",icon:p.Z.group,title:n()(w.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.upgradeTitle",defaultMessage:"Upgrade to create groups"}),caption:n()(w.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.upgradeCaption.plus",defaultMessage:"Upgrade to the Plus Plan to set up groups and control permissions from the share menu.",description:"Shown as an upsell if user wants more permission control from the share menu."}),learnMoreRoute:"guides.groups"}),n()(ae.Z,{size:24,isHidden:!0}),n()("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},void 0,s&&n()(fe.Z,{renderTooltip:()=>!i&&o,render:e=>d.createElement(ie.Z,r()({isLarge:!0,onClick:this.handleCreateGroupClick,disabled:!i},i?void 0:e),n()(w.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.createGroupButton.label",defaultMessage:"Create a group"}))}),a.length>0&&n()(de.Z,{placeholder:this.props.intl.formatMessage({id:"spacePermissionsSettings.groupsTab.filterGroupNamesInput.placeholder",defaultMessage:"Filter by group name…",description:"Search input placeholder shown above a table that displays all groups."}),left:p.Z.searchThick(this.getSearchIconStyle()),showClearButton:!0,format:de.Z.Format.Small,value:t,style:{...ls.filterStyle,marginRight:0},onChange:this.handleFilterChange})),a.length>0&&n()(es,{spaceStore:e,permissionsSettingsStore:this.stores.spacePermissionsSettingsStore,groups:a,canEdit:this.canEditGroups()}))}}renderSpaceMembers(e){return this.props.isMobile?this.renderMobileMemberList(e):n()("div",{},void 0,this.renderHelp(),this.renderInviteLink(),this.renderDesktopMemberList(e))}renderInviteLink(){if(!this.canUseInviteLink())return;const e=this.getInviteLink(),t=this.getInviteLinkEnabled();if(!e)return;const{spacePermissionsSettingsStore:s}=this.stores;return n()("div",{},void 0,n()("div",{style:{display:"flex",alignItems:"flex-start",cursor:"pointer"}},void 0,n()("div",{style:{marginRight:8,flexGrow:1}},void 0,n()(gt.Z,{},void 0,n()(w.FormattedMessage,{id:"spacePermissionsSettings.spaceMembers.inviteLink.title",defaultMessage:"Invite link"})),n()(Se.Z,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"85%"}},void 0,n()(w.FormattedMessage,{id:"spacePermissionSettings.spaceMembers.inviteLink.caption",defaultMessage:"Share this secret link to invite people to this workspace. Only users who can invite members can see this.",description:"Label that is shown above the invite link."})," ",!this.props.isMobile&&this.renderInviteLinkReset())),n()("div",{style:{marginTop:5}},void 0,n()(be.Z,{on:t,onClick:this.handleInviteLinkClick}))),s&&t&&e&&this.renderInviteLinkUrl(e),n()(ae.Z,{size:40}))}renderInviteLinkReset(){const{store:e}=this.props;if(e.isDefined())return n()(w.FormattedMessage,{id:"spacePermissionSettings.spaceMembers.inviteLink.resetLink",defaultMessage:"You can <resetlink>reset the link</resetlink> for all space members to generate a new invite link.",values:{resetlink:t=>n()(Ae.Z,{onClick:()=>{Z.showDialog({message:n()(w.FormattedMessage,{id:"spacePermissionsSettings.inviteLinkRefreshModal.description",defaultMessage:"Are you sure you want to reset the invite link for all space members? Your old one will no longer be able to be used."}),showCancel:!0,keepFocus:!1,handleCancel:Z.dismissDialog,items:[{label:n()(w.FormattedMessage,{id:"spacePermissionsSettings.inviteLinkRefreshModal.accept",defaultMessage:"Reset"}),color:"red",onAccept:async()=>{await I.refreshInviteLink(this.environment,{spaceId:e.id}),x.bi(this.environment)}}]})}},void 0,t)}})}renderInviteLinkUrl(e){const{mobileNative:t}=this.environment,s=n()(w.FormattedMessage,{id:"spacePermissionsSettings.spaceMembers.inviteLink.copyButton",defaultMessage:"Copy link"}),i=()=>{C.RD({environment:this.environment,stringValue:e,copiedMessage:C.tq.copiedLinkToClipboard}),k.trackWorkspaceInviteCopyLink(this.environment)},r=()=>{t&&t.share(e),k.trackWorkspaceInviteCopyLink(this.environment)};return this.props.isMobile?n()("div",{},void 0,n()(de.Z,{type:"text",format:de.B.Default,value:e,disabled:!0}),t?n()(pe.Z,{onClick:r,style:{marginTop:10,width:"100%"}},void 0,n()(w.FormattedMessage,{id:"spacePermissionsSettings.spaceMembers.inviteLink.shareButton",defaultMessage:"Share link"})):n()(pe.Z,{onClick:i,style:{marginTop:10,width:"100%"}},void 0,s)):n()("div",{},void 0,n()("div",{style:{display:"flex",alignItems:"flex-start",marginTop:12}},void 0,n()(de.Z,{type:"text",format:de.B.Default,value:e,disabled:!0,style:{borderTopRightRadius:0,borderBottomRightRadius:0,width:"calc(100% - 90px)",height:32}}),n()(ie.Z,{onClick:i,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0},isLarge:!0},void 0,s)))}renderMobileMemberList(e){const{store:t}=this.props;return n()(d.Fragment,{},void 0,e.map((e=>{const s=j.U6.createChildStore(t,{table:v.KJ,id:e.userId});return n()("div",{style:{display:"flex",alignItems:"center",padding:10,borderBottom:`1px solid ${this.theme.lightDividerColor}`,background:this.theme.cardContentBackground}},e.userId,this.renderMember(s),n()("div",{style:{textAlign:"center",marginLeft:"auto"}},void 0,this.renderUserPermission("members",e,s)))})))}renderDesktopMemberList(e){const{spacePermissionsSettingsStore:t}=this.stores,{membersFilter:s,limitMembers:i}=t.state,r=this.getFilteredMembers(e,s),o=this.sortUsers("members",r),a=i?o.slice(0,ls.defaultLimit):o;return n()(d.Fragment,{},void 0,n()("div",{style:{marginRight:8,flexGrow:1}},void 0,n()(gt.Z,{},void 0,n()(w.FormattedMessage,{id:"spacePermissionsSettings.spaceMembers.members.title",defaultMessage:"Members"}))),this.renderInviteViaDomainCaption(),n()(ae.Z,{size:16,isHidden:!0}),n()("div",{},void 0,n()("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16}},void 0,this.renderInviteButton(),n()(de.Z,{placeholder:this.props.intl.formatMessage({id:"spacePermissionsSettings.membersTab.filterMembersInput.placeholder",defaultMessage:"Filter by email or name…"}),left:p.Z.searchThick(this.getSearchIconStyle()),showClearButton:!0,format:de.Z.Format.Small,value:s,style:ls.filterStyle,onChange:e=>{t.setState({...t.state,membersFilter:e.target.value,limitMembers:!0})}})),this.renderUserTable("members",a),o.length>ls.defaultLimit&&i&&n()(ve.Z,{style:ls.showMoreButtonStyle,onClick:this.handleMembersShowMoreClick},void 0,n()(w.FormattedMessage,{defaultMessage:"Show {moreMembersCount} more",id:"spacePermissionsSettings.membersTab.showMore.message",values:{moreMembersCount:o.length-ls.defaultLimit}}))))}renderTeamGuests(e){const{spacePermissionsSettingsStore:t}=this.stores,{teamGuestsFilter:s,limitTeamGuests:i}=t.state,r=e.filter((e=>e.isTeamGuest)),o=this.getFilteredMembers(r,s),a=this.sortUsers("team_guests",o),l=i?a.slice(0,5):a;return n()("div",{style:{marginBottom:5}},void 0,n()("div",{},void 0,n()("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16}},void 0,n()(de.Z,{placeholder:this.props.intl.formatMessage({id:"spacePermissionsSettings.membersTab.filterTeamGuestsInput.placeholder",defaultMessage:"Filter by email or name…",description:"Placeholder in the search bar for teamspace guests."}),left:p.Z.searchThick(this.getSearchIconStyle()),showClearButton:!0,format:de.Z.Format.Small,value:s,style:ls.filterStyle,onChange:e=>{t.setState({...t.state,teamGuestsFilter:e.target.value,limitTeamGuests:!0})}})),this.renderUserTable("team_guests",l),a.length>5&&i&&n()(ve.Z,{style:ls.showMoreButtonStyle,onClick:this.handleTeamGuestsShowMoreClick},void 0,n()(w.FormattedMessage,{id:"spacePermissionsSettings.membersTab.showMoreGuestsButton.label",defaultMessage:"{numberOfHiddenGuests, plural, one {Show {numberOfHiddenGuests} more} other {Show {numberOfHiddenGuests} more}}",values:{numberOfHiddenGuests:a.length-5}}))))}renderSpaceGuests(e){const{spacePermissionsSettingsStore:t}=this.stores,{guestsFilter:s,limitGuests:i}=t.state,r=e.filter((e=>!e.isTeamGuest&&e.isPageGuest)),o=this.getFilteredMembers(r,s),a=this.sortUsers("guests",o),l=this.isTeamGuestsEnabled.state?5:ls.defaultLimit,d=i?a.slice(0,l):a;return n()("div",{},void 0,n()("div",{},void 0,n()("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16}},void 0,n()(de.Z,{placeholder:this.props.intl.formatMessage({id:"spacePermissionsSettings.membersTab.filterGuestsInput.placeholder",defaultMessage:"Filter by email or name…"}),left:p.Z.searchThick(this.getSearchIconStyle()),showClearButton:!0,format:de.Z.Format.Small,value:s,style:ls.filterStyle,onChange:e=>{t.setState({...t.state,guestsFilter:e.target.value,limitGuests:!0})}})),this.renderUserTable("guests",d),a.length>l&&i&&n()(ve.Z,{style:ls.showMoreButtonStyle,onClick:this.handleGuestsShowMoreClick},void 0,n()(w.FormattedMessage,{id:"spacePermissionsSettings.membersTab.showMoreGuestsButton.label",defaultMessage:"{numberOfHiddenGuests, plural, one {Show {numberOfHiddenGuests} more} other {Show {numberOfHiddenGuests} more}}",values:{numberOfHiddenGuests:a.length-l}}))))}renderMobileInviteButton(){return n()(d.Fragment,{},void 0,n()("div",{style:this.mobileMenuItemStyle()},void 0,this.renderInviteButton({flex:1})),n()("div",{style:{borderBottom:`1px solid ${this.theme.regularDividerColor}`}}))}renderInviteButton(e){const{store:t}=this.props;return t.canEditMembership()||t.getDisableMembershipRequests()||!(0,E.p1)()?n()(z.LazyPermissionsInviteWithModal,{disabled:!this.canEditMembership(),store:t,onInviteClick:this.handleUpdateClick,onInviteComplete:this.handleUpdateComplete,isSubscribed:this.isSubscribed(),membersOnly:!1,upgradeButtonName:"space_permission_settings",shouldGrow:!1,buttonStyle:e}):n()(ut,{store:t,analyticsFrom:"space_settings_add_members",origin:n()(ie.Z,{isLarge:!0},void 0,n()(w.FormattedMessage,{id:"inviteUserButton.requestMemberLabel",defaultMessage:"Add members",description:"Button to invite new users to the workspace."}))})}renderInviteViaDomainCaption(){const{store:e}=this.props;return R.LV(e)?n()(Se.Z,{isSmall:!0,isMultiline:!0,style:{width:"80%"}},void 0,n()(w.FormattedMessage,{id:"spaceBasicSettings.membersTab.manageMembersWithLinkCaption",defaultMessage:"Manage members here."})):n()("div",{},void 0,n()(Se.Z,{isSmall:!0,isMultiline:!0,style:{width:"80%",marginBottom:6}},void 0,n()(w.FormattedMessage,{id:"spaceBasicSettings.membersTab.manageMembersWithoutLinkCaption",defaultMessage:"Manage members here, or <setupdomainlink>set up a domain</setupdomainlink>, so everyone with allowed email domains can join the workspace automatically.",values:{setupdomainlink:e=>n()(Ae.Z,{onClick:()=>{$.Z.setState({...$.Z.state,currentTab:"settings",defaultSubtab:void 0})}},void 0,e)}})),n()(Se.Z,{isSmall:!0,isMultiline:!0,style:{width:"80%"}},void 0,n()(w.FormattedMessage,{id:"spaceBasicSettings.membersTab.payPerMemberCaption",defaultMessage:"You will be charged for each member added. Visit <billingguidelink>our guide</billingguidelink> for more information on how we bill.",values:{billingguidelink:e=>n()(Ae.Z,{href:(0,O.UY)("guides.billingGuide")},void 0,e)}})))}getFilteredMembers(e,t){const{store:s,intl:i}=this.props;return t&&t.length>0?(0,c.ZP)(t,e,(e=>{const t=j.U6.createChildStore(s,{table:v.KJ,id:e.userId});return t.isDefined()?(0,M.of)({name:t.getFullName(i),email:t.getEmail()}):""})):e}sortUsers(e,t){const s=this.stores.spacePermissionsSettingsStore.state.sorts[e];if(!s)return t;const{store:i}=this.props;switch(s.by){case"role":return t.sort(((e,t)=>(g.xm[t.role]-g.xm[e.role])*(s.asc?-1:1)));case"name":return t.map((e=>({user:e,store:j.U6.createChildStore(i,{table:v.KJ,id:e.userId})}))).sort(((e,t)=>{const i=e.store.getValue(),r=t.store.getValue(),o=(0,M.Nz)(this.props.intl,i),n=(0,M.Nz)(this.props.intl,r);return o.localeCompare(n)*(s.asc?1:-1)})).map((e=>e.user))}}renderSmallArrow(e){const{up:t}=e,s={width:10,height:10,marginLeft:4};return t?p.Z.arrowDownSmall({...s,transform:"rotate(180deg)"}):p.Z.arrowDownSmall(s)}renderUserTable(e,t){const{store:s}=this.props,i=this.stores.spacePermissionsSettingsStore.state.sorts[e],r=s.getPermissionGroups().reduce(((e,t)=>{const s=t.user_ids||[];for(const i of s)e[i]=e[i]?e[i].concat(t):[t];return e}),{}),o={key:"user",header:n()(re.Z,{disabled:!1,ignoreLocalHoverState:!0,onClick:()=>{this.handleSortClick(e,"name")},style:{display:"flex",alignItems:"center"}},void 0,n()(w.FormattedMessage,{id:"spacePermissionsSettings.userTable.userColumn.header",defaultMessage:"User"}),i&&"name"===i.by&&this.renderSmallArrow({up:i.asc})),style:{width:"45%"}},a={key:"groups",header:n()(re.Z,{disabled:!0,ignoreLocalHoverState:!0,style:{display:"flex",alignItems:"center",paddingLeft:8}},void 0,n()(w.FormattedMessage,{id:"spacePermissionsSettings.userTable.groupsColumn.header",description:"Label for a column shows the groups that a user is part of.",defaultMessage:"Groups"})),style:{width:"15%"}},l={key:"teams",header:n()(re.Z,{disabled:!1,ignoreLocalHoverState:!0,style:{display:"flex",alignItems:"center",paddingLeft:8}},void 0,n()(w.FormattedMessage,{id:"spacePermissionsSettings.userTable.teamsColumn.header",defaultMessage:"Teamspaces",description:"Label for a column shows the teamspaces that a user is part of."})),style:{width:"20%",textAlign:"center"}},u={key:"access_level",header:n()(re.Z,{disabled:!1,ignoreLocalHoverState:!0,onClick:()=>{this.handleSortClick(e,"role")},style:{display:"flex",alignItems:"center",paddingLeft:8}},void 0,n()(w.FormattedMessage,{id:"spacePermissionsSettings.userTable.accessLevelColumn.header",defaultMessage:"Access level"}),i&&"role"===i.by&&this.renderSmallArrow({up:i.asc})),style:{width:"20%",textAlign:"center"}},m={key:"three_dot",header:n()(re.Z,{disabled:!0,ignoreLocalHoverState:!0})},c=this.canUseGroups()&&"team_guests"!==e&&"guests"!==e,p=("team_guests"===e||"guests"===e)&&this.isTeamGuestsEnabled.state&&this.canEditMembership();let g="members"===e&&(0,W.bq)()?[o,l,u]:p?[o,u,m]:[o,u];return c&&(g=[...g.slice(0,1),a,...g.slice(1)]),n()(Ke.Z,{columns:g,rows:t.map((e=>({member:e,store:j.U6.createChildStore(s,{table:v.KJ,id:e.userId})}))).filter((e=>void 0!==e.store.getValue())).map((t=>{const{member:s,store:i}=t,o=r[s.userId]?r[s.userId]:[],n=[this.renderMember(i)];return c&&n.push(d.createElement(d.Fragment,null,this.renderGroups(o))),"members"===e&&(0,W.bq)()&&n.push(d.createElement(d.Fragment,null,this.renderTeams(s))),n.push(d.createElement(d.Fragment,null,this.renderUserPermission(e,s,i))),p&&n.push(d.createElement(d.Fragment,null,this.renderPageGuestOrTeamGuestThreeDotMenu(e,s,i))),{key:s.userId,columns:n}}))})}renderMember(e){return n()(se.Z,{actorStore:e})}renderGroups(e){return n()(ke,{spaceStore:this.props.store,groups:e,onGroupClick:()=>{this.navigateToTab(Y.Q.Groups)}})}renderTeams(e){if("none"!==e.role)return n()(ns.Z,{member:e})}renderUserPermission(e,t,s){return"none"===t.role?this.isTeamGuestsEnabled.state&&"team_guests"===e?n()(os,{teamGuest:t}):n()(qe,{store:this.props.store,guest:t,guestStore:s,isSubscribed:this.isSubscribed(),hideActionButtons:this.isTeamGuestsEnabled.state}):this.renderMemberRoleSelect(t)}renderPageGuestOrTeamGuestThreeDotMenu(e,t,s){return n()(ne.Z,{popupType:ne.Z.PopupType.Popup,renderOrigin:e=>d.createElement(le.Z,r()({},e,{icon:p.Z.dots,iconStyle:{height:14,width:14}})),render:i=>{const o=[{key:"team section",render:e=>d.createElement(he.Z,e),items:[{key:"convertToMember",render:t=>d.createElement(oe.Z,r()({},t,{icon:p.Z.settingsUpgrade({height:17,width:17}),title:n()(w.FormattedMessage,{id:"spacePermissionsSettings.externalTab.userThreeDotMenu.convertToMember.title",defaultMessage:"Convert to member",description:"Title for button to convert a page guest or teamspace guest to a workspace member."}),shouldWrapCaption:!0,caption:"team_guests"===e&&n()(w.FormattedMessage,{id:"spacePermissionsSettings.externalTab.userThreeDotMenu.convertToMember.caption",defaultMessage:"Workspace members are not restricted to specific teamspaces",description:"Explains teamspace guests are limited to specific teamspaces."})})),action:()=>this.handleConvertGuestToMember({user:t,userStore:s,parent:i})},{key:"removeFromWorkspace",render:e=>d.createElement(oe.Z,r()({},e,{icon:p.Z.handWave({height:17,width:17,color:m.ZP.red}),title:n()("span",{style:{color:m.ZP.red}},void 0,n()(w.FormattedMessage,{id:"spacePermissionsSettings.externalTab.userThreeDotMenu.removeFromWorkspace.title",defaultMessage:"Remove from workspace",description:"Button that when clicked removes the user from the workspace entirely."}))})),action:()=>this.handleRemoveGuestFromWorkspace({user:t,userStore:s,parent:i})}]}];return n()(me.Z,{menuType:L.og.Popup},void 0,n()(ce.Z,{type:ce.i.Vertical,sections:o,initialFocus:void 0,style:{minWidth:265}}))}})}renderMemberRoleSelect(e){const t=this.environment.currentUser.id,{currentUserSettingsStore:s}=H.default.state;if(!s)return;const i=this.getAvailableRoleItems();let r=!0;return(this.canAdmin()||this.canEditMembership()&&(g.RN(e.role)||e.userId===t))&&(r=!1),n()(Ue.Z,{role:e.role,table:h.bx,type:"user_permission",disabled:r,isUserPermission:e.userId===t,upgradeButtonName:"space_permission_item",onChange:t=>this.handleMemberPermissionRoleChange(e,t,s),availableRoleItems:i})}renderReprovisioning(){return d.createElement(d.Fragment,null,n()(Se.Z,{isMultiline:!0,style:{width:"80%"}},void 0,n()(w.FormattedMessage,{id:"spacePermissionsSettings.reprovisioningTab.workspaceOwner.caption",defaultMessage:"View users that were previously part of the workspace in the past 30 days. Only workspace owners can see this.",description:"Description that shows on the transfer content tab in settings"})),n()(Se.Z,{isMultiline:!0,style:{width:"80%"}},void 0,n()(w.FormattedMessage,{id:"spacePermissionsSettings.reprovisioningTab.workspaceOwner.caption.disclaimer",defaultMessage:"Only users who had private pages will appear here.",description:"Disclaimer that shows under the caption describing the reprovisioning tab in the members panel in settings."})),n()(ae.Z,{size:24,isHidden:!0}),n()(ge.Z,{requestStore:this.stores.getRecoverableSpaceUserContentRequestStore,request:{spaceId:this.props.store.id},performRequest:async e=>{const t=await I.getRecoverableSpaceUserContent(this.environment,{spaceId:e.spaceId});if("failed"===t.type)throw Z.showError(t),t;return t.data},render:this.renderReprovisioningData}))}renderRequestsTab(){return n()(Ye,{spaceStore:this.props.store,accessRequestsStore:this.stores.accessRequestsStore})}renderNumberOfRequests(){return n()(ge.Z,{throttle:1e3,request:{parentTable:"space",parentId:this.props.store.id,size:100,status:"pending"},requestStore:this.stores.accessRequestsStore,performRequest:async e=>{const t=await I.getAccessRequests(this.environment,e);if("failed"===t.type)throw t.error;const s=t.data.accessRequestIds;return T.Tr(this.props.store,s)},render:(e,t,s)=>e||!t?n()("span",{}):t?n()("span",{},void 0,t.filter((e=>"pending"===e.accessRequestStore.getKeyStore("status").getValue())).length):void 0})}handleConvertGuestToMember(e){const{userStore:t,parent:s}=e,{store:i}=this.props,r=this.isSubscribed()?"read_and_write":"editor";Z.showDialog({message:n()(w.FormattedMessage,{id:"spacePermissionsSettings.externalTab.userThreeDotMenu.convertToMember.confirmationDialog.message",defaultMessage:"Are you sure you want to convert this user into a workspace member?",description:"Message to confirm converting user into a workspace member."}),description:n()(w.FormattedMessage,{id:"spacePermissionsSettings.externalTab.userThreeDotMenu.convertToMember.confirmationDialog.description",defaultMessage:"This is a billable event.",description:"Additional description explaining this user will be charged after this conversion."}),showCancel:!0,keepFocus:!1,handleCancel:()=>{Z.dismissDialog(),s.close()},items:[{label:n()(w.FormattedMessage,{id:"spacePermissionsSettings.externalTab.userThreeDotMenu.convertToMember.confirmationDialog.confirm",defaultMessage:"Convert to workspace member",description:"Label for button to confirm converting the teamspace or page guest into a workspace member."}),color:"blue",onAccept:async()=>{s.close(),await A({environment:this.environment,guestUserStore:t,role:r,store:i})}}]})}handleRemoveGuestFromWorkspace(e){const{userStore:t,parent:s}=e;Z.showDialog({message:n()(w.FormattedMessage,{id:"spacePermissionsSettings.externalTab.userThreeDotMenu.removeFromWorkspace.confirmationDialog.message",defaultMessage:"Are you sure you want to remove this user from the workspace?",description:"Message to confirm removal of user from the workspace."}),description:n()(w.FormattedMessage,{id:"spacePermissionsSettings.externalTab.userThreeDotMenu.removeFromWorkspace.confirmationDialog.description",defaultMessage:"This action will completely remove the user from the workspace, including any teamspaces and pages they have access to.",description:"Additional description explaining the action will completely remove the user from the space."}),showCancel:!0,keepFocus:!1,handleCancel:()=>{Z.dismissDialog(),s.close()},items:[{label:n()(w.FormattedMessage,{id:"spacePermissionsSettings.externalTab.userThreeDotMenu.removeFromWorkspace.confirmationDialog.confirm",defaultMessage:"Remove from workspace",description:"Label for button to confirm removal of user from the workspace."}),color:"red",onAccept:async()=>{s.close(),await U({environment:this.environment,guestUserStore:t,store:this.props.store})}}]})}getSpaceRecoverRows(e){const t=[];for(const{userId:s,privatePagesCount:i}of e){if(i<1)continue;const e=j.U6.createChildStore(this.props.store,{table:v.KJ,id:s});t.push({key:s,columns:[this.renderMember(e),i,this.userIdsWithContentBeingReprovisioned.state.includes(s)?n()(ue.Z,{}):n()("div",{style:{marginLeft:-4}},void 0,n()(mt.Z,{mode:ct.z.Button,focused:!1,title:n()(w.FormattedMessage,{id:"spacePermissionsSettings.reprovision.toUser.title",defaultMessage:"Transfer private pages"}),parentStore:this.props.store,userIds:this.userIdsWithContentBeingReprovisioned.state,onChange:e=>{let[t]=e;this.handleReprovisionToUserChange(s,t)}}))]})}return t}setInitialSubtabOnMount(){$.Z.state.open&&"members"===$.Z.state.currentTab&&$.Z.state.defaultSubtab&&(this.stores.spacePermissionsSettingsStore.setState({...this.stores.spacePermissionsSettingsStore.state,currentTab:$.Z.state.defaultSubtab}),$.Z.setState({...$.Z.state,defaultSubtab:void 0}))}getAvailableRoleItems(){const e=this.props.intl.formatMessage({id:"spacePermissionSettings.memberRoleSelect.permissionitem.roleUpgradeDisabled",defaultMessage:"Cannot upgrade to a higher role than member",description:"Tooltip shown over disabled role upgrades"}),t=(0,D.U7)();return l().compact(g.an.map((s=>{if(t||"membership_admin"!==s)return{role:s,disabledInfo:!this.canAdmin()&&g.Bc(s)?{isDisabled:!0,disabledMessage:e}:void 0}})))}getCurrentTabs(e){return[Y.Q.Members,Y.Q.Groups,...e.length>0?[Y.Q.Guests]:[],...this.canReprovisionContent()?[Y.Q.Reprovisioning]:[],...this.shouldShowRequestsTab()?[Y.Q.Requests]:[]]}isSubscribed(){const{data:e}=X.default.state;return Boolean(e&&K.YK(e))}canAdmin(){return this.props.store.canAdmin()}canEditMembership(){return this.props.store.canEditMembership()}canUseGroups(){return K.qF(this.environment)&&this.isSubscribed()}canEditGroups(){return this.canUseGroups()&&this.canEditMembership()}canUseInviteLink(){return this.canEditMembership()&&K.qF(this.environment)}canReprovisionContent(){return this.canAdmin()&&N.wP()}shouldShowRequestsTab(){return this.canEditMembership()&&(0,E.p1)()}getInviteLinkEnabled(){return Boolean(this.props.store.getKeyStore("invite_link_enabled").getValue())}getInviteLink(){if(!this.canEditMembership())return;const e=X.default.state.data,t=this.props.store.id,s=e&&("subscribed_admin"===e.type||"unsubscribed_admin"===e.type||"subscribed_membership_admin"===e.type)&&e.inviteLinkCode;return s?(0,V.cJ)(this.environment,t,s):void 0}getSearchIconStyle(){return{width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,fill:this.theme.mediumIconColor}}mobileMenuItemStyle(){const{WindowSizeStore:e}=this.environment;return{display:"flex",paddingTop:14,paddingBottom:14,paddingLeft:14,paddingRight:e.getSafePaddingRightCSS(14),background:this.theme.cardContentBackground}}}ls.displayName="SpacePermissionsSettings",ls.defaultLimit=50,ls.filterStyle={maxWidth:275,borderRadius:30},ls.showMoreButtonStyle={marginTop:8};const ds=(0,w.injectIntl)(ls)},88775:(e,t,s)=>{s.d(t,{Z:()=>R});var i=s(97464),r=s.n(i),o=s(77094),n=s.n(o),a=s(67294),l=s(480),d=s(81954),u=s(24405),m=s(3779),c=s(5366),p=s(57688),g=s(33929),h=s(60709),v=s(33846),b=s(48690),f=s(30397),S=s(48019),y=s(52275),M=s(31945),w=s(68894),T=s(78140),k=s(89728),I=s(72495),C=s(64369),Z=s(93686);const P=(0,c.defineMessages)({filterTeams:{defaultMessage:"Filter teamspaces…",id:"teamsDropdownForMember.filterForTeams.placeholder",description:"Placeholder text for filtering teamspaces within a group."}});function F(e){window.__c={n:"MemberTeamContent"};const t=(0,l.O7)(),s=(0,u.yK)((()=>({teamMenuItem:{fontWeight:400,maxWidth:180}})),[]),[i,o]=(0,d.AF)(void 0,v.Z),m=(0,a.useCallback)((e=>p.RF({environment:t,teamId:e,tab:b.a.Members,from:"teams_dropdown_for_team_member"})),[t]),f=(0,d.VK)((()=>[{key:"teams for member",render:e=>a.createElement(I.Z,e),actions:e.teamStores.map((e=>({key:e.id,displayName:e.getName(),analyticsName:e.getName()||"team_unknown",searchName:e.getName(),render:t=>a.createElement(y.Z,r()({icon:n()(Z.p,{disabled:!0,store:e}),title:n()(C.Z,{style:s.teamMenuItem},void 0,e.getName()),caption:n()(c.FormattedMessage,{defaultMessage:"{numMembers} {numMembers, plural, one {member} other {members}}",id:"teamsDropdownForMember.numMembers",description:"Number of members in a teamspace, displayed in a popup showing teamspaces that a member is part of.",values:{numMembers:e.getUserIdsInTeam().length}}),inline:!0},t)),action:()=>{m(e.id)},closeParentMenu:!1})))}]),[e.teamStores,s.teamMenuItem,m]),M=i.inputValue,k=n()(I.Z,{isInput:!0},void 0,n()(w.ZP,{value:M,onChange:(0,a.useCallback)((e=>{o({inputValue:e.target.value,focus:!1})}),[o]),focus:!0,focusAfterAnimation:!0,placeholder:g.default.formatMessage(P.filterTeams)})),F={menuType:h.og.Popup,maxWidth:350,maxHeight:300,header:e.teamStores.length>5?k:void 0};return a.createElement(T.Z,F,n()(S.Z,{filter:M,context:{blocks:[],environment:t,publicEditMode:void 0},initialFocus:0,sections:f}))}const R=function(e){window.__c={n:"TeamsDropdownForMember"};const[t]=(0,d.AF)(f.Z),s=(0,u.yK)((e=>({button:{marginRight:8},noTeams:{marginRight:8,color:e.lightTextColor},chevron:{width:10,marginLeft:4,fill:e.lightIconColor}})),[]),i=(0,d.VK)((()=>t.teams.filter((t=>t.getMembers().some((t=>"user"===t.entity_type&&t.user_id===e.member.userId))))),[t,e.member]),o=i.length;return n()(M.Z,{popupType:M.Z.PopupType.Popup,renderOrigin:e=>a.createElement(k.Z,r()({disabled:0===o,style:0===o?s.noTeams:s.button},e),0===o?n()(c.FormattedMessage,{id:"teamsDropdownForMember.teamsCountNone.label",defaultMessage:"No access",description:"Message to show a member is not part of any teamspaces."}):a.createElement(a.Fragment,null,n()(c.FormattedMessage,{id:"teamsDropdownForMember.teamsCount.label",defaultMessage:"{numberOfTeams, plural, one {{numberOfTeams} teamspace} other {{numberOfTeams} teamspaces}}",description:"Number of teamspaces that a member is part of.",values:{numberOfTeams:o}}),m.Z.chevronDown(s.chevron))),render:()=>n()(F,{member:e.member,teamStores:i})})}},69435:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(77094),r=s.n(i),o=(s(67294),s(83355)),n=s(82990),a=s(5366),l=s(50906),d=s(5978),u=s(93678),m=s(33665),c=s(42922),p=s(63296);class g extends o.Z{constructor(){super(...arguments),this.handleUpgradeClick=e=>{const{from:t,for:s,onUpgradeClick:i}=this.props;u.y(this.environment,{from:t,for:s}),i&&i(e)},this.handleLearnMoreClick=()=>{const{from:e,learnMoreRoute:t}=this.props;d.navigateToExternalURL({environment:this.environment,url:(0,m.UY)(t)}),l.trackClickHelpButton(this.environment,{from:e})}}renderComponent(){return r()("section",{style:this.getWrapStyle()},void 0,this.renderIcon(),this.renderTitle(),this.renderCaption(),this.renderActions())}renderIcon(){const{icon:e}=this.props;if(e)return e(this.getIconStyle())}renderTitle(){const{title:e}=this.props;return r()("header",{style:this.getTitleStyle()},void 0,e)}renderCaption(){const{caption:e}=this.props;return r()("p",{style:this.getCaptionStyle()},void 0,e)}renderActions(){return r()("footer",{style:this.getFooterStyle()},void 0,this.renderUpgradeButton(),this.renderLearnMoreButton())}renderUpgradeButton(){const{upgradeMessage:e}=this.props;return r()(c.Z,{onClick:this.handleUpgradeClick,isLarge:!0},void 0,e||r()(a.FormattedMessage,{defaultMessage:"Upgrade",id:"upsellCallout.upgradeButton.text"}))}renderLearnMoreButton(){return r()(p.Z,{onClick:this.handleLearnMoreClick},void 0,r()(a.FormattedMessage,{defaultMessage:"Learn more",id:"upsellCallout.learnMoreButton.text"}))}getWrapStyle(){const{device:e}=this.environment;return{...this.props.style,fontSize:14,...!e.isMobile&&{maxWidth:340}}}getIconStyle(){return{width:32,height:"auto",fill:this.theme.mediumIconColor,marginBottom:8}}getTitleStyle(){return{fontWeight:n.Z.fontWeight.semibold}}getCaptionStyle(){return{color:this.theme.mediumTextColor,marginTop:4,marginBottom:16}}getFooterStyle(){return{display:"flex",flexWrap:"wrap",gap:"8px 12px"}}}g.displayName="UpsellCallout";const h=g},88198:(e,t,s)=>{s.d(t,{b:()=>p});var i=s(77094),r=s.n(i),o=s(67294),n=s(81954),a=s(24405),l=s(3779),d=s(26825),u=s(5366),m=s(4708),c=s(74136);function p(e){window.__c={n:"GuestPill"};const{style:t,labelType:s}=e,{label:i,icon:p}=(0,n.VK)((()=>(0,m.F$)()?"team_level_guest"===s?{label:d.mq.teamGuestLabel,icon:l.Z.openTeam}:{label:d.mq.pageGuestLabel,icon:l.Z.pageEmpty}:{label:d.mq.guestLabel,icon:l.Z.globe2}),[s]),g=(0,a.yK)((()=>({container:{display:"flex",alignItems:"center",color:"#CF8807",background:"rgba(246, 192, 80, 0.26)"}})),[]);return r()(c.Z,{innerStyle:{...g.container,...t}},void 0,p({width:9,fill:"#CF8807",display:"inline",verticalAlign:"middle",marginRight:2}),o.createElement(u.FormattedMessage,i))}},83890:(e,t,s)=>{s.d(t,{Z:()=>w});var i=s(97464),r=s.n(i),o=s(77094),n=s.n(o),a=s(67294),l=s(83355),d=s(66897),u=s(3779),m=s(19889),c=s(7928),p=s(5366),g=s(31299),h=s(3815),v=s(92864),b=s(93044),f=s(255),S=s(97680),y=s(98707);class M extends l.Z{constructor(){super(...arguments),this.renderFilterListItem=(e,t)=>{let{disabled:s,onRemove:i,onClick:r}=t;const o=this.styles,a=this.getUserValue(e),l=n()(f.Z,{disabled:s,onClick:i});return n()(S.Z,{disabled:s,focused:!1,actor:(0,d.m3)(a),right:l,style:o.menuItem,desktopTitleStyle:o.menuItemTitle,onClick:r},e)},this.renderItemForSummary=e=>(0,c.Nz)(this.props.intl,this.getUserValue(e)),this.renderToken=(e,t)=>{const{userIds:s}=this.props,i=1===s.length,r=this.getUserValue(e);if(r)return n()(v.ZP,{format:this.environment.device.isMobile?b.lP.Large:b.lP.Small,showRemoveButton:!0,isSingle:i,onClickRemove:t.onRemove,actor:(0,d.m3)(r),shouldShrink:!0,style:{background:"transparent"}},e)},this.renderResultMenuItem=(e,t)=>{const s=this.getUserValue(e);return a.createElement(S.Z,r()({},t,{key:e,actor:(0,d.m3)(s)}))},this.performRequest=async e=>{let{query:t,current:s}=e;const i=new Set(s);return(await g.Yu({environment:this.environment,query:t,membersOnly:!1})).filter((e=>!i.has(e.id))).slice(0,20).map((e=>e.id))},this.getUserValue=e=>this.createUserStore(e).getValue(),this.createUserStore=e=>{const{parentStore:t}=this.props;return h.U6.createChildStore(t,{table:m.KJ,id:e})},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},menuItemTitle:{width:"100%"},labeledMenuItemTitle:{display:"inline-flex",alignItems:"center"},menuItemLabel:{marginRight:12},recordIcon:{marginRight:2,fill:"currentColor"}}}renderComponent(){const{mode:e,title:t,userIds:s,onChange:i,disabled:r,focused:o,onMenuDismiss:a,intl:l}=this.props;return n()(y.Z,{mode:e,title:t,icon:u.Z.person,iconStyles:this.styles.recordIcon,items:s,onChange:i,disabled:r,focused:o,renderFilter:this.renderFilterListItem,renderToken:this.renderToken,renderItemForSummary:this.renderItemForSummary,addItemLabel:n()(p.FormattedMessage,{defaultMessage:"Add a person",id:"search.filterMenu.addAPersonButton.label"}),labelText:{title:t,tokenInputPlaceholder:l.formatMessage({defaultMessage:"Search people",id:"search.filterMenu.searchPeople.placeholder"}),componentDebugName:"SearchPersonFilter"},performRequest:this.performRequest,renderResultMenuItem:this.renderResultMenuItem,onMenuDismiss:a,hasItemsSelected:(null==s?void 0:s.length)>0})}}M.displayName="SearchPersonFilter";const w=(0,p.injectIntl)(M)},69507:(e,t,s)=>{s.d(t,{l:()=>m});var i=s(97464),r=s.n(i),o=s(77094),n=s.n(o),a=s(67294),l=s(83355),d=s(5366),u=s(72495);class m extends l.Z{renderComponent(){return a.createElement(u.Z,r()({title:n()(d.FormattedMessage,{id:"inviteUserModal.searchDropdown.selectPersonTitle",defaultMessage:"Select a person"})},this.props))}}m.displayName="SearchPersonDropdown"},79817:(e,t,s)=>{s.d(t,{fr:()=>f,x5:()=>M,j_:()=>w,fC:()=>T,uJ:()=>P,Oh:()=>F,Si:()=>R,$s:()=>_});var i=s(33728),r=s(65917),o=s(24211),n=s(27006),a=s(97880),l=s(54642),d=s(10279),u=s(64964),m=s(33929),c=s(85834),p=s(10161),g=s(4708),h=s(19306),v=s(21115),b=s(8323);const f=e=>{const{environment:t,spaceStore:s,contextualInviteStore:i}=e;if(S({environment:t,spaceStore:s,contextualInviteStore:i})){const e=p.default.getEligibleGroup({experimentId:"contextual_invite_v2",defaultGroup:"control"});i.startRequestMembership(e)}else if(y({environment:t,spaceStore:s,contextualInviteStore:i})){const e=p.default.getEligibleGroup({experimentId:"contextual_invite_v2",defaultGroup:"control"});i.startWorkspaceInvite(e)}else i.setState({...i.state,inviteStage:c.TG.closed})},S=e=>{const{spaceStore:t,contextualInviteStore:s}=e,i=t.getRole();return!(!i||!(0,n.RN)(i))&&(!!s.hasGuests()&&(!t.getDisableMembershipRequests()&&(0,g.p1)()))},y=e=>{const{spaceStore:t,contextualInviteStore:s}=e,i=t.getRole();return!(!i||!(0,n.dy)(i))&&(!!s.hasGuests()&&(0,b.Mk)())},M=e=>{const{success:t,intl:s,contextualInviteStore:i}=e,r=i.state.invitedUsers;0!==r.length&&(t?u.oV({label:s.formatMessage({id:"contextual_invite.permission_invite_success3",defaultMessage:"Successfully sent invites to {users}",description:"Client side message shown when the page invite succeeds on the server side."},{users:P(r,s)})}):(u.oV({label:s.formatMessage({id:"contextual_invite.permission_invite_failure",defaultMessage:"Failed to send invites to {users}",description:"Client side message shown when the page invite fails on the server side."},{users:P(r,s)})}),i.reset()))},w=async e=>{const{environment:t,spaceStore:s,contextualInviteStore:i,from:o,intl:n}=e,{selection:a,flowId:l}=i.state;if("page_guest"===a||!i.hasGuests())return i.reset(),!1;const{inviteTargets:u,unknownEmails:m}=await k({environment:t,contextualInviteStore:i}),c={...i.state};i.reset();const p=(0,b.zt)(),g=p&&(0,v.o9)(p)?"editor":e.inviteRole??"read_and_write";try{await d.n_({environment:t,store:s,inviteTargets:u,inviteRole:g,isOnboarding:!1,invite:{inviteOrigin:o,inviteFlowId:l}})}catch(h){return Z(n,c.invitedUsers),r.log({level:"error",from:"contextualInviteHelpers",type:"inviteMembers.inviteTargets",data:{miscDataToConvertToString:{...c,inviteTargets:u}}}),!1}finally{m.length&&r.log({level:"error",from:"contextualInviteHelpers",type:"inviteMembers.unknownUserId",data:{miscDataToConvertToString:{...c,unknownEmails:m}}})}return!0},T=async e=>{const{environment:t,spaceStore:s,originId:i,originType:o,reasonMessage:n,contextualInviteStore:a,intl:d}=e,{selection:u}=a.state;if("page_guest"===u||!a.hasGuests())return a.reset(),!1;const{inviteTargets:m,unknownEmails:c}=await k({environment:t,contextualInviteStore:a}),p={...a.state};a.reset();const g=[];try{const e=m.map((e=>l.requestAccess(t,{type:"actor-to-space",forActorId:e.value.id,spaceId:s.id,message:n,attributes:{origin_id:i,origin_type:o,origin_table:"share_menu"===o?"block":"space",add_permissions_on_approval:!1}}).catch((()=>g.push(e)))));await Promise.all(e)}catch(h){return C(d,p.invitedUsers),r.log({level:"error",from:"contextualInviteHelpers",type:"requestMembers.inviteTargets",data:{miscDataToConvertToString:{...p,inviteTargetsWithErrors:g}}}),!1}finally{c.length&&r.log({level:"error",from:"contextualInviteHelpers",type:"requestMembers.unknownUserId",data:{miscDataToConvertToString:{...p,unknownEmails:c}}})}return!0},k=async e=>{const{environment:t,contextualInviteStore:s}=e,{invitedEmailToUserIdMap:i}=s.state,r=[],o=[];for(const n of s.state.invitedUsers){if(!n.isGuest)continue;const e=await I(t,n,i);e?r.push({type:"existingUser",value:{id:e,email:n.email,version:1}}):o.push(n.email)}return{inviteTargets:r,unknownEmails:o}},I=async(e,t,s)=>{const i=await(async(e,t,s)=>{let i=t.id;if(i||(i=s[t.email]),!i){const s=await l.findUser(e,{email:t.email});if("failed"!==s.type){const e=s.data;e.value&&(i=e.value.value.id)}}return i})(e,t,s);if(i)return i;const r=(0,o.E2)(m.default.getIntl()),n=await l.createEmailUser(e,{email:t.email,preferredLocaleOrigin:"inferred_from_inviter",preferredLocale:r});return"failed"!==n.type?n.data.userId:void 0},C=(e,t)=>{0!==t.length&&u.oV({label:e.formatMessage({id:"contextual_invite.request_members_failure",defaultMessage:"Failed to request {users} to become members",description:"Client side message shown when the request invitees to become members fails on the server side."},{users:P(t,e)})})},Z=(e,t)=>{0!==t.length&&u.oV({label:e.formatMessage({id:"contextual_invite.contextual_invite_failure",defaultMessage:"Failed to invite to {users} as members",description:"Client side message shown when the invite guests as members fails on the server side."},{users:P(t,e)})})},P=(e,t)=>(0,h.W)(e.flatMap((e=>e.email||[]))),F=(e,t)=>{const{state:s}=t,i=(0,b.zt)(),r=t.getGuestEmails();return{invite_flow_id:s.flowId,user_count:r.length,user_emails:r,invite_space_role_selection:s.selection,is_bot:!1,subscription_tier:i}};function R(e){const{type:t}=e;switch(t){case"newUser":return{email:e.value.email,isGuest:!0};case"existingUser":return{...e.value,email:e.value.email,isGuest:"none"===e.spaceRole||"not_in_space"===e.spaceRole};case"group":return;default:(0,a.t1)(t)}}function _(e){const{contextualInviteUser:t,allowedDomains:s}=e,{email:r,isGuest:o}=t;if(o){const e=(0,i.Gd)(r);if(!e)return!1;if(s.has(e))return!0}return!1}},53353:(e,t,s)=>{s.d(t,{Z:()=>n});var i=s(81954),r=s(98165),o=s(65598);const n=function(e){return(0,i.VK)((()=>{if(!(0,o.NZ)(e))return{isStoreInTeam:!1,spaceAllowsGuests:!0};const t=(0,r.VP)(e),s=(0,r.Pj)(e),i=!(null!=s&&s.getDisableGuests());return t?{isStoreInTeam:!0,teamAllowsGuests:!t.getDisableGuests(),spaceAllowsGuests:i}:{isStoreInTeam:!1,spaceAllowsGuests:i}}),[e])}},26781:(e,t,s)=>{s.d(t,{i:()=>l});var i=s(77094),r=s.n(i),o=s(67294),n=s(5366),a=s(53353);function l(e){const t=(0,a.Z)(e);return t.isStoreInTeam?t.teamAllowsGuests?void 0:o.createElement(o.Fragment,null,r()("div",{},void 0,r()(n.FormattedMessage,{id:"contextualInvite.buttonAndTokenTooltip.teamDisablesGuestsAlertLine1",defaultMessage:"This teamspace doesn't allow guests.",description:"Tooltip message shown when hovering above the guest invitee or invite button when guests are disabled on the teamspace"})),r()("div",{},void 0,r()(n.FormattedMessage,{id:"contextualInvite.buttonAndTokenTooltip.teamDisablesGuestsAlertLine2",defaultMessage:"Remove any guests to continue.",description:"Tooltip message telling the user the action needed to continue with invite form."}))):t.spaceAllowsGuests?void 0:o.createElement(o.Fragment,null,r()("div",{},void 0,r()(n.FormattedMessage,{id:"contextualInvite.buttonAndTokenTooltip.spaceDisablesGuestsAlertLine1",defaultMessage:"This workspace doesn't allow guests.",description:"Tooltip message shown when hovering above the guest invitee or invite button when guests are disabled on the teamspace"})),r()("div",{},void 0,r()(n.FormattedMessage,{id:"contextualInvite.buttonAndTokenTooltip.spaceDisablesGuestsAlertLine2",defaultMessage:"Remove any guests to continue.",description:"Tooltip message telling the user the action needed to continue with invite form."})))}},53680:(e,t,s)=>{s.d(t,{Z:()=>o});var i=s(49085);class r extends i.Z{getInitialState(){return{disablePublicAccess:!1,disableGuests:!1,disableMoveToSpace:!1,disableExport:!1,disableSpacePageEdits:!1,disablePublicAccessRequests:!1,disableTeamCreation:!1,disableMembershipRequests:!1,disableGuestMembershipRequests:!1,enableAiFeature:!1,disableTeamGuests:!1}}getValueForSpace(e){if(e.isDefined())return{disablePublicAccess:Boolean(e.getDisablePublicAccess()),disableGuests:Boolean(e.getDisableGuests()),disableMoveToSpace:Boolean(e.getDisableMoveToSpace()),disableExport:Boolean(e.getDisableExport()),disableSpacePageEdits:Boolean(e.getDisableSpacePageEdits()),disablePublicAccessRequests:Boolean(e.getDisablePublicAccessRequests()),disableTeamCreation:Boolean(e.getDisableTeamCreation()),disableMembershipRequests:Boolean(e.getKeyStore("settings").getKeyStore("disable_membership_requests").getValue()),disableGuestMembershipRequests:Boolean(e.getKeyStore("settings").getKeyStore("disable_guest_membership_requests").getValue()),enableAiFeature:Boolean(e.getKeyStore("settings").getKeyStore("enable_ai_feature").getValue()),disableTeamGuests:Boolean(e.getKeyStore("settings").getKeyStore("disable_team_guests").getValue())}}}const o=r},98905:(e,t,s)=>{s.d(t,{Z:()=>o});var i=s(49085);class r extends i.Z{getInitialState(){return{count:0}}}const o=new r}}]);